/*
 MIT License <http://www.opensource.org/licenses/mit-license.php>
*/
window.qlib=window.qlib||{};(function(){var f=function(){},c=f.prototype;c.type="GeometricShape";c.intersect=function(a){return qlib.Intersection.intersect(this,a)};c.draw=function(a){throw"draw() not implented yet in "+this.type;};c.scale=function(a,b,d){throw"scale() not implented yet in "+this.type;};c.clone=function(a){throw"clone() not implented yet in "+this.type;};c.toString=function(){return this.type};qlib.GeometricShape=f})();window.qlib=window.qlib||{};
(function(){var f=function(){},c=f.prototype;f.initialize=function(a){a.addEventListener=c.addEventListener;a.on=c.on;a.removeEventListener=a.off=c.removeEventListener;a.removeAllEventListeners=c.removeAllEventListeners;a.hasEventListener=c.hasEventListener;a.dispatchEvent=c.dispatchEvent;a._dispatchEvent=c._dispatchEvent};c._listeners=null;c._captureListeners=null;c.initialize=function(){};c.addEventListener=function(a,b,d){var h;h=d?this._captureListeners=this._captureListeners||{}:this._listeners=
this._listeners||{};var g=h[a];g&&this.removeEventListener(a,b,d);(g=h[a])?g.push(b):h[a]=[b];return b};c.on=function(a,b,d,h,g,e){b.handleEvent&&(d=d||b,b=b.handleEvent);d=d||this;return this.addEventListener(a,function(a){b.call(d,a,g);h&&a.remove()},e)};c.removeEventListener=function(a,b,d){if(d=d?this._captureListeners:this._listeners){var h=d[a];if(h)for(var g=0,e=h.length;g<e;g++)if(h[g]==b){1==e?delete d[a]:h.splice(g,1);break}}};c.off=c.removeEventListener;c.removeAllEventListeners=function(a){a?
(this._listeners&&delete this._listeners[a],this._captureListeners&&delete this._captureListeners[a]):this._listeners=this._captureListeners=null};c.dispatchEvent=function(a,b){if("string"==typeof a){var d=this._listeners;if(!d||!d[a])return!1;a=new qlib.Event(a)}a.target=b||this;if(a.bubbles&&this.parent){for(var h=this,d=[h];h.parent;)d.push(h=h.parent);for(var g=d.length,h=g-1;0<=h&&!a.propagationStopped;h--)d[h]._dispatchEvent(a,1+(0==h));for(h=1;h<g&&!a.propagationStopped;h++)d[h]._dispatchEvent(a,
3)}else this._dispatchEvent(a,2);return a.defaultPrevented};c.hasEventListener=function(a){var b=this._listeners,d=this._captureListeners;return!!(b&&b[a]||d&&d[a])};c.toString=function(){return"[EventDispatcher]"};c._dispatchEvent=function(a,b){var d,h=1==b?this._captureListeners:this._listeners;if(a&&h&&(h=h[a.type])&&(d=h.length)){a.currentTarget=this;a.eventPhase=b;a.removed=!1;for(var h=h.slice(),g=0;g<d&&!a.immediatePropagationStopped;g++){var e=h[g];e.handleEvent?e.handleEvent(a):e(a);a.removed&&
(this.off(a.type,e,1==b),a.removed=!1)}}};qlib.EventDispatcher=f})();window.qlib=window.qlib||{};
(function(){var f=function(){this.initialize(arguments)},c=f.prototype;c.x=0;c.y=0;c.initialize=function(a){0==a.length?this.x=this.y=0:"number"==typeof a[0]?(this.x=null==a[0]?0:a[0],this.y=null==a[1]?0:a[1]):2==a.length&&null!=a[0].x&&null!=a[0].y&&null!=a[1].x&&null!=a[1].y?(this.x=a[1].x-a[0].x,this.y=a[1].y-a[0].y):(this.x=a[0].x,this.y=a[0].y)};c.setValue=function(){0==arguments.length?this.x=this.y=0:"number"==typeof arguments[0]?(this.x=null==arguments[0]?0:arguments[0],this.y=null==arguments[1]?
0:arguments[1]):(this.x=arguments[0].x,this.y=arguments[0].y)};c.squaredDistanceToVector=function(a){if(null==a)throw"Vector2.squaredDistanceToVector: null passed in";var b=this.x-a.x;a=this.y-a.y;return b*b+a*a};c.distanceToVector=function(a){return Math.sqrt(this.squaredDistanceToVector(a))};c.getLerp=function(a,b){return new qlib.Vector2(this.x+(a.x-this.x)*b,this.y+(a.y-this.y)*b)};c.lerp=function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this};c.snaps=function(a,b){return this.squaredDistanceToVector(a)<
(null==b?1E-8:b)};c.equals=function(a){return this.x==a.x&&this.y==a.y};c.__defineGetter__("length",function(){return this.getLength()});c.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};c.getSquaredLength=function(){return this.x*this.x+this.y*this.y};c.getAngle=function(){return Math.atan2(this.y,this.x)};c.getAngleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)};c.newLength=function(a){var b=this.getLength();if(0==b)return this;this.x*=a/b;this.y*=a/b;return this};c.getNewLength=
function(a){var b=this.getLength();return new qlib.Vector2(this.x/b*a,this.y/b*a)};c.plus=function(a){this.x+=a.x;this.y+=a.y;return this};c.getPlus=function(a){return new qlib.Vector2(this.x+a.x,this.y+a.y)};c.plusXY=function(a,b){this.x+=a;this.y+=b;return this};c.getPlusXY=function(a,b){return new qlib.Vector2(this.x+a,this.y+b)};c.minus=function(a){this.x-=a.x;this.y-=a.y;return this};c.getMinus=function(a){return new qlib.Vector2(this.x-a.x,this.y-a.y)};c.multiply=function(a){this.x*=a;this.y*=
a;return this};c.getMultiply=function(a){return new qlib.Vector2(this.x*a,this.y*a)};c.multiplyXY=function(a,b){this.x*=a;this.y*=b;return this};c.getMultiplyXY=function(a,b){return new qlib.Vector2(this.x*a,this.y*b)};c.divide=function(a){this.x/=a;this.y/=a;return this};c.getDivide=function(a){return new qlib.Vector2(this.x/a,this.y/a)};c.getAddCartesian=function(a,b){return new qlib.Vector2(this.x+Math.cos(a)*b,this.y+Math.sin(a)*b)};c.addCartesian=function(a,b){this.x+=Math.cos(a)*b;this.y+=Math.sin(a)*
b;return this};c.dot=function(a){return this.x*a.x+this.y*a.y};c.cross=function(a){return this.x*a.y-this.y*a.x};c.angleBetween=function(a){return Math.acos(this.dot(a)/(this.getLength()*a.getLength()))};c.cornerAngle=function(a,b){if(null==a||null==b)throw"Vector2.cornerAngle needs two vectors";return a.getMinus(this).angleBetween(b.getMinus(this))};c.windingDirection=function(a,b){var d=(a.x-b.x)*(b.y-this.y)-(a.y-b.y)*(b.x-this.x);return 0>d?-1:0<d?1:0};c.reset=function(){this.x=this.y=0;return this};
c.reflect=function(a){var b=2*this.dot(a);this.x-=a.x*b;this.y-=a.y*b;return this};c.getReflect=function(a){var b=2*this.dot(a);return new qlib.Vector2(this.x-a.x*b,this.y-a.y*b)};c.mirror=function(a){this.x=2*a.x-this.x;this.y=2*a.y-this.y;return this};c.getMirror=function(a){return new qlib.Vector2(2*a.x-this.x,2*a.y-this.y)};c.getProject=function(a,b){var d=a.distanceToVector(b),d=((a.y-this.y)*(a.y-b.y)-(a.x-this.x)*(b.x-a.x))/(d*d);return new qlib.Vector2(a.x+d*(b.x-a.x),a.y+d*(b.y-a.y))};c.project=
function(a,b){var d=a.distanceToVector(b),d=((a.y-this.y)*(a.y-b.y)-(a.x-this.x)*(b.x-a.x))/(d*d);this.x=a.x+d*(b.x-a.x);this.y=a.y+d*(b.y-a.y);return this};c.negate=function(){this.x*=-1;this.y*=-1;return this};c.getNegate=function(){return new qlib.Vector2(-this.x,-this.y)};c.orth=function(){var a=-this.y;this.y=this.x;this.x=a;return this};c.getOrth=function(){return new qlib.Vector2(-this.y,this.x)};c.normalize=function(){var a=this.getLength();0!=a?(this.x/=a,this.y/=a):this.x=this.y=0;return this};
c.getNormalize=function(){var a=this.getLength();return 0!=a?new qlib.Vector2(this.x/a,this.y/a):new qlib.Vector2};c.normal=function(){var a=this.getLength();if(0!=a){var b=-this.y/a;this.y=this.x/a;this.x=b}else this.x=this.y=0;return this};c.getNormal=function(){var a=this.getLength();return 0!=a?new qlib.Vector2(-this.y/a,this.x/a):new qlib.Vector2};c.rotateAround=function(a,b){this.minus(b);this.rotateBy(a);this.plus(b);return this};c.getRotateAround=function(a,b){var d=this.getMinus(b);d.rotateBy(a);
d.plus(b);return d};c.rotateBy=function(a){var b=Math.cos(a);a=Math.sin(a);var d=this.x*b-this.y*a;this.y=this.x*a+this.y*b;this.x=d;return this};c.rotateByCosSin=function(a,b){var d=this.x*a-this.y*b;this.y=this.x*b+this.y*a;this.x=d;return this};c.getRotateBy=function(a){var b=Math.cos(a);a=Math.sin(a);return new qlib.Vector2(this.x*b-this.y*a,this.x*a+this.y*b)};c.isLower=function(a){return this.x<a.x&&this.y<a.y};c.isLowerOrEqual=function(a){return this.x<=a.x&&this.y<=a.y};c.isGreater=function(a){return this.x>
a.x&&this.y>a.y};c.isGreaterOrEqual=function(a){return this.x>=a.x&&this.y>=a.y};c.isLessOrEqual=function(a){return this.x<=a.x&&this.y<=a.y};c.isLeft=function(a,b){return(b.x-a.x)*(this.y-a.y)-(this.x-a.x)*(b.y-a.y)};c.min=function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);return this};c.minXY=function(a,b){this.x=Math.min(this.x,a);this.y=Math.min(this.y,b);return this};c.getMin=function(a){return new qlib.Vector2(Math.min(this.x,a.x),Math.min(this.y,a.y))};c.max=function(a){this.x=
Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);return this};c.maxXY=function(a,b){this.x=Math.max(this.x,a);this.y=Math.max(this.y,b);return this};c.getMax=function(a){return new qlib.Vector2(Math.max(this.x,a.x),Math.max(this.y,a.y))};c.clone=function(){return new qlib.Vector2(this)};c.draw=function(a,b,d){b=null==b?2:b;null==d?(a.moveTo(this.x-b,this.y),a.lineTo(this.x+b,this.y),a.moveTo(this.x,this.y-b),a.lineTo(this.x,this.y+b)):(a.moveTo(this.x-b+d.x,this.y+d.y),a.lineTo(this.x+b+d.x,this.y+
d.y),a.moveTo(this.x+d.x,this.y-b+d.y),a.lineTo(this.x+d.x,this.y+b+d.y))};c.drawCircle=function(a,b,d){b=null==b?2:b;null==d?(a.drawRect(this.x-.5,this.y-.5,1,1),a.moveTo(this.x+b,this.y),a.drawCircle(this.x,this.y,b)):(a.drawRect(this.x-.5+d.x,this.y-.5+d.y,1,1),a.moveTo(this.x+b+d.x,this.y+d.y),a.drawCircle(this.x+d.x,this.y+d.y,b))};c.drawRect=function(a,b,d){b=null==b?2:b;null==d?a.drawRect(this.x-b,this.y-b,b+b,b+b):a.drawRect(this.x-b+d.x,this.y-b+d.y,b+b,b+b)};c.toString=function(){return"[Vector2 (x="+
this.x+" y="+this.y+")]"};qlib.Vector2=f})();window.qlib=window.qlib||{};
(function(){var f=function(a,b,d,h){this.initialize(a,b,d,h)},c=f.prototype=new qlib.GeometricShape;c.type="Rectangle";c.initialize=function(a,b,d,h){this.x=null==a?0:a;this.y=null==b?0:b;this.width=null==d?0:d;this.height=null==h?0:h;this.fixValues()};c.fixValues=function(){0>this.width&&(this.x+=this.width,this.width*=-1);0>this.height&&(this.y+=this.height,this.height*=-1)};c.scale=function(a,b,d){null==d&&(d=new qlib.Vector2(this.x+.5*this.width,this.y+.5*this.height));d=(new qlib.Vector2(this.x,
this.y)).minus(d).multiplyXY(a,b).plus(d);this.x=d.x;this.y=d.y;this.width*=a;this.height*=b;this.fixValues();return this};c.union=function(a){if(0==this.width||0==this.height)return a.clone();if(0==a.width||0==a.height)return this.clone();var b=Math.min(this.x,a.x),d=Math.min(this.y,a.y),h=Math.max(this.x+this.width,a.x+a.width);a=Math.max(this.y+this.height,a.y+a.height);return new qlib.Rectangle(b,d,h-b,a-d)};c.intersection=function(a){if(0==this.width||0==this.height)return a.clone();if(0==a.width||
0==a.height)return this.clone();this.fixValues();a.fixValues();var b=this.x>a.x?this.x:a.x,d=this.y>a.y?this.y:a.y,h=Math.min(this.x+this.width,a.x+a.width);a=Math.min(this.y+this.height,a.y+a.height);return b>=h||d>=a?new qlib.Rectangle:new qlib.Rectangle(b,d,h-b,a-d)};c.getCenter=function(){return new qlib.Vector2(this.x+.5*this.width,this.y+.5*this.height)};c.__defineGetter__("topLeft",function(){return new qlib.Point(this.x,this.y)});c.clone=function(a){return new f(this.x,this.y,this.width,this.height)};
c.draw=function(a){a.drawRect(this.x,this.y,this.width,this.height)};c.toString=function(){return"qlib.Rectangle("+this.x+","+this.y+","+this.width+","+this.height+")"};qlib.Rectangle=f})();window.qlib=window.qlib||{};
(function(){for(var f=function(a,b,g,e,p){this.initialize(a,b,g,e,p)},c=f.prototype,a=new Uint8Array(new ArrayBuffer(256)),b=0;256>b;b++)a[b]=b;f.defaultPalette=a;c.initialize=function(a,b,g,e,p){this.width=a|0;this.height=b|0;this.rect=new qlib.Rectangle(0,0,this.width,this.height);this.transparent=g||!0;this.canvas=p||document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.setAttribute("width",this.width);this.canvas.setAttribute("height",this.height);this.imagedata=
this.context.createImageData(this.width,this.height);this.__defineGetter__("data",function(){return this.imagedata});this.__defineSetter__("data",function(a){this.imagedata=a});void 0==qlib.isLittleEndian&&(a=new ArrayBuffer(4),b=new Uint8ClampedArray(a),(new Uint32Array(a))[0]=255,qlib.isLittleEndian=255===b[3]);this.isLittleEndian=qlib.isLittleEndian;qlib.isLittleEndian||(this.setPixel=this._setPixel,this.setPixel32=this._setPixel32,this.getPixel=this._getPixel,this.getPixel32=this._getPixel32);
e?this.fillRect(this.rect,e):this.fillRect(this.rect,this.transparent?0:4278190080);this.buf8=new Uint8ClampedArray(this.imagedata.data.buffer);this.buf32=new Uint32Array(this.imagedata.data.buffer);return this};c.updateView=function(){this.context.putImageData(this.imagedata,0,0)};c.setPixel=function(a,b,g){this.buf32[a+b*this.width|0]=255|(g&16777215)<<8};c.setPixel32=function(a,b,g){this.buf32[a+b*this.width|0]=(g&16777215)<<8|g>>>24};c.getPixel=function(a,b){return this.buf32[a+b*this.width|0]>>
8};c.getPixel32=function(a,b){return this.buf32[a+b*this.width|0]};c._setPixel=function(a,b,g){this.buf32[a+b*this.width|0]=4278190080|(g&16711680)>>16|g&65280|(g&255)<<16};c._setPixel32=function(a,b,g){this.buf32[a+b*this.width|0]=g&4278190080|(g&16711680)>>16|g&65280|(g&255)<<16};c._getPixel=function(a,b){var g=this.buf32[a+b*this.width|0];return(g&16711680)>>16|g&65280|(g&255)<<16};c._getPixel32=function(a,b){var g=this.buf32[a+b*this.width|0];return(g&4278190080|(g&16711680)>>16|g&65280|(g&255)<<
16)>>>0};c.clear=function(a){a=a||this.rect;this.context.clearRect(a.x,a.y,a.width,a.height);this.imagedata=this.context.getImageData(0,0,this.width,this.height);this.buf8=new Uint8ClampedArray(this.imagedata.data.buffer);this.buf32=new Uint32Array(this.imagedata.data.buffer)};c.clone=function(){this.updateView();var a=new qlib.BitmapData(this.width,this.height,this.transparent);a.imagedata=this.context.getImageData(0,0,this.width,this.height);a.buf8=new Uint8ClampedArray(a.imagedata.data.buffer);
a.buf32=new Uint32Array(a.imagedata.data.buffer);a.updateView();return a};c.colorTransform=function(a,b){a=a||this.rect;a=this.rect.intersection(a);b=b||new qlib.ColorTransform;for(var g=this.buf8,e=a.x+a.width,p=a.y+a.height,c=b.redMultiplier,k=b.greenMultiplier,l=b.blueMultiplier,m=b.alphaMultiplier,r=b.redMultiplier,q=b.greenMultiplier,n=b.blueMultiplier,f=b.alphaMultiplier,B=a.y;B<p;B++)for(var D=a.x;D<e;D++){var s=4*(B*this.width+D),t=s+1,x=s+2,A=s+3;g[s]=g[s]*c+r;g[t]=g[t]*k+q;g[x]=g[x]*l+n;
g[A]=g[A]*m+f}this.updateView()};c.applyFilter=function(a,b,g,e){b=null!=b?b.intersection(a.rect):a.rect;null==g&&(g=new qlib.Point);g.x+b.width>this.width&&(b.width=this.width-g.x);g.y+b.height>this.height&&(b.height=this.height-g.y);0!=b.width&&0!=b.height&&(a=a.context.getImageData(b.x,b.y,b.width,b.height),b=this.context.getImageData(g.x,g.y,b.width,b.height),e.run(b,a),this.context.putImageData(b,g.x,g.y),this.imagedata=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.buf8=
new Uint8ClampedArray(this.imagedata.data.buffer),this.buf32=new Uint32Array(this.imagedata.data.buffer))};c.compare=function(a){if(this.width!=a.width)return-3;if(this.height!=a.height)return-4;if(this.imagedata===a.data)return 0;for(var b,g,e=new qlib.BitmapData(this.width,this.height),p=0;p<this.height;p++)for(var c=0;c<this.width;c++)b=a.getPixel(c,p),g=this.getPixel(c,p),e.setPixel(c,p,b^g);return e};c.copyCanvas=function(a,b,g,e,p){b=null!=b?b.intersection(new qlib.Rectangle(0,0,a.width,a.height)):
new qlib.Rectangle(0,0,a.width,a.height);null==g&&(g=new qlib.Point);g.x+b.width>this.width&&(b.width=this.width-g.x);g.y+b.height>this.height&&(b.height=this.height-g.y);if(0!=b.width&&0!=b.height){this.updateView();var c=0>this.canvas.width-b.width-g.x?b.width+(this.canvas.width-b.width-g.x):b.width,k=0>this.canvas.height-b.height-g.y?b.height+(this.canvas.height-b.height-g.y):b.height,l,m;if(e&&e!=qlib.BlendMode.NORMAL){var r=this.width;a=a instanceof f?a.buf8:a.getContext("2d").getImageData(b.x,
b.y,c,k).data;b=this.buf8;switch(e){case qlib.BlendMode.REPLACE:for(var q=0;q<k;q++)for(var n=0;n<c;n++)p=4*(n+q*c),e=4*(n+g.x+(q+g.y)*r),b[e]=a[p],b[e+1]=a[p+1],b[e+2]=a[p+2],b[e+3]=a[p+3];break;case qlib.BlendMode.ADD:for(q=0;q<k;q++)for(n=0;n<c;n++)p=4*(n+q*c),e=4*(n+g.x+(q+g.y)*r),b[e]+=a[p],b[e+1]+=a[p+1],b[e+2]+=a[p+2];break;case qlib.BlendMode.SUBTRACT:for(q=0;q<k;q++)for(n=0;n<c;n++)p=4*(n+q*c),e=4*(n+g.x+(q+g.y)*r),b[e]=a[p]-b[e],b[e+1]=a[p+1]-b[e+1],b[e+2]=a[p+2]-b[e+2];break;case qlib.BlendMode.ADD_SUBTRACT:l=
null==p||null==p.blendFactor?1:p.blendFactor;m=null==p||null==p.threshold?128:p.threshold;for(q=0;q<k;q++)for(n=0;n<c;n++)p=4*(n+q*c),e=4*(n+g.x+(q+g.y)*r),b[e]+=(a[p]-m)*l,b[e+1]+=(a[p+1]-m)*l,b[e+2]+=(a[p+2]-m)*l;break;case qlib.BlendMode.INVERT:for(q=0;q<k;q++)for(n=0;n<c;n++)p=4*(n+q*c),e=4*(n+g.x+(q+g.y)*r),b[e]=255-a[p],b[e+1]=255-a[p+1],b[e+2]=255-a[p+1];break;case qlib.BlendMode.MULTIPLY:for(q=0;q<k;q++)for(n=0;n<c;n++)p=4*(n+q*c),e=4*(n+g.x+(q+g.y)*r),b[e]=a[p]*b[e]/255|0,b[e+1]=a[p+1]*b[e+
1]/255|0,b[e+2]=a[p+2]*b[e+2]/255|0;break;case qlib.BlendMode.LIGHTEN:for(q=0;q<k;q++)for(n=0;n<c;n++)p=4*(n+q*c),e=4*(n+g.x+(q+g.y)*r),a[p]>b[e]&&(b[e]=a[p]),a[p+1]>b[e+1]&&(b[e+1]=a[p+1]),a[p+2]>b[e+2]&&(b[e+2]=a[p+2]);break;case qlib.BlendMode.DARKEN:for(q=0;q<k;q++)for(n=0;n<c;n++)p=4*(n+q*c),e=4*(n+g.x+(q+g.y)*r),a[p]<b[e]&&(b[e]=a[p]),a[p+1]<b[e+1]&&(b[e+1]=a[p+1]),a[p+2]<b[e+2]&&(b[e+2]=a[p+2]);break;case qlib.BlendMode.DIFFERENCE:for(q=0;q<k;q++)for(n=0;n<c;n++)p=4*(n+q*c),e=4*(n+g.x+(q+g.y)*
r),b[e]=Math.abs(a[p]-b[e]),b[e+1]=Math.abs(a[p+1]-b[e+1]),b[e+2]=Math.abs(a[p+2]-b[e+2]);break;case qlib.BlendMode.SCREEN:for(q=0;q<k;q++)for(n=0;n<c;n++)p=4*(n+q*c),e=4*(n+g.x+(q+g.y)*r),b[e]=255-((255-b[e])*(255-a[p])>>8),b[e+1]=255-((255-b[e+1])*(255-a[p+1])>>8),b[e+2]=255-((255-b[e+2])*(255-a[p+2])>>8);break;case qlib.BlendMode.OVERLAY:for(q=0;q<k;q++)for(n=0;n<c;n++)p=4*(n+q*c),e=4*(n+g.x+(q+g.y)*r),m=b[e],128>(l=a[p])?(l=2*l*m+128,b[e]=(l>>8)+l>>8):(l=2*(255-l)*(255-m)+128,b[e]=255-((l>>8)+
l>>8)),m=b[e+1],128>(l=a[p+1])?(l=2*l*m+128,b[e+1]=(l>>8)+l>>8):(l=2*(255-l)*(255-m)+128,b[e+1]=255-((l>>8)+l>>8)),m=b[e+2],128>(l=a[p+2])?(l=2*l*m+128,b[e+2]=(l>>8)+l>>8):(l=2*(255-l)*(255-m)+128,b[e+2]=255-((l>>8)+l>>8));break;case qlib.BlendMode.HARDLIGHT:for(q=0;q<k;q++)for(n=0;n<c;n++)p=4*(n+q*c),e=4*(n+g.x+(q+g.y)*r),b[e]=128>b[e]?b[e]*a[p]*.00784313725:255-(255-b[e])*(255-a[p])*.00784313725,b[e+1]=128>b[e+1]?b[e+1]*a[p+1]*.00784313725:255-(255-b[e+1])*(255-a[p+1])*.00784313725,b[e+2]=128>b[e+
2]?b[e+2]*a[p+2]*.00784313725:255-(255-b[e+2])*(255-a[p+2])*.00784313725;break;case qlib.BlendMode.ALPHA:for(q=0;q<k;q++)for(n=0;n<c;n++)p=4*(n+q*c),e=4*(n+g.x+(q+g.y)*r),b[e+3]=b[e+3]*a[p+3]/255;break;case qlib.BlendMode.ERASE:for(q=0;q<k;q++)for(n=0;n<c;n++)p=4*(n+q*c),e=4*(n+g.x+(q+g.y)*r),b[e+3]*=1-a[p+3]/255}}else a instanceof f?this.context.drawImage(a.canvas,g.x,g.y):this.context.drawImage(a,g.x,g.y),this.imagedata=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),this.buf8=
new Uint8ClampedArray(this.imagedata.data.buffer),this.buf32=new Uint32Array(this.imagedata.data.buffer);this.updateView()}};c.copyChannel=function(a,b,g,e,p){var c,k,l,m,r,q=b.width,n=b.height;switch(e){case qlib.BitmapDataChannel.ALPHA:k=4278190080;l=24;break;case qlib.BitmapDataChannel.RED:k=16711680;l=16;break;case qlib.BitmapDataChannel.GREEN:k=65280;l=8;break;case qlib.BitmapDataChannel.BLUE:k=255,l=0}switch(p){case qlib.BitmapDataChannel.ALPHA:m=16777215;r=24;break;case qlib.BitmapDataChannel.RED:m=
4278255615;r=16;break;case qlib.BitmapDataChannel.GREEN:m=4294902015;r=8;break;case qlib.BitmapDataChannel.BLUE:m=4294967040,r=0}var f;for(e=0;e<n;e++)for(p=0;p<q;p++)c=a.getPixel32(b.x+p,b.y+e),f=(c&k)>>>l,c=this.getPixel32(g.x+p,g.y+e),c=c&m|f<<r,this.setPixel32(g.x+p,g.y+e,c);this.updateView()};c.copyPixels=function(a,b,g){this.copyCanvas(a.canvas,b,g,qlib.BlendMode.REPLACE)};c.draw=function(a,b,g,e,p,c,k){a instanceof qlib.BitmapData&&(a=a.canvas);var l=document.createElement("canvas");l.setAttribute("width",
this.width);l.setAttribute("height",this.height);var m=l.getContext("2d"),r=0,q=0;b&&b instanceof qlib.Matrix?m.transform(b.a,b.b,b.c,b.d,b.tx,b.ty):b&&b instanceof Array&&(m.translate(.5*this.width,.5*this.height),m.transform(b[0],b[1],b[2],b[3],0,0),r=-b[4],q=-b[5]);m.globalAlpha=g?g.alphaMultiplier:1;try{m.drawImage(a,r,q)}catch(n){if("NS_ERROR_NOT_AVAILABLE"==n.name)return console.log(n),setTimeout(draw,0,a,b,g,e,p,c),!1;throw n;}sourceRect=p||this.rect;this.copyCanvas(l,sourceRect,sourceRect.topLeft,
e,k);return!0};c.fillRect=function(a,b){null==a?a=this.rect:(a=a.intersection(this.rect),this.updateView());this.context.fillStyle="rgba("+((b&16711680)>>16)+","+((b&65280)>>8)+","+(b&255)+","+((b&4278190080)>>>24)/255+")";this.context.fillRect(a.x,a.y,a.width,a.height);this.imagedata=this.context.getImageData(0,0,this.canvas.width,this.canvas.height);this.buf8=new Uint8ClampedArray(this.imagedata.data.buffer);this.buf32=new Uint32Array(this.imagedata.data.buffer)};c.floodFill=function(a,b,g){var e=
[];e.push(new qlib.Point(a,b));a=this.getPixel(a,b);b=0;for(var p=new qlib.BitmapData(this.width,this.height,!0,16777215),c;0<e.length;)c=e.shift(),++b,0>c.x||c.x>=this.width||0>c.y||c.y>=this.height||(p.setPixel(c.x,c.y,0),this.getPixel(c.x,c.y)==a&&(this.setPixel(c.x,c.y,g),16777215==p.getPixel(c.x+1,c.y)&&e.push(new Point(c.x+1,c.y)),16777215==p.getPixel(c.x,c.y+1)&&e.push(new Point(c.x,c.y+1)),16777215==p.getPixel(c.x-1,c.y)&&e.push(new Point(c.x-1,c.y)),16777215==p.getPixel(c.x,c.y-1)&&e.push(new Point(c.x,
c.y-1))))};c.histogram=function(a,b){a=a||this.rect;a=a.intersection(this.rect);for(var g=new Uint32Array(256),e=new Uint32Array(256),p=new Uint32Array(256),c=new Uint32Array(256),k=0>this.canvas.width-a.width-a.x?a.width+(this.canvas.width-a.width-a.x):a.width,l=0>this.canvas.height-a.height-a.y?a.height+(this.canvas.height-a.height-a.y):a.height,m=this.buf8,r=this.width,q=a.y;q<l;q++)for(var n=a.x;n<k;n++){var f=n+q*r<<2;g[m[f]]++;e[m[f+1]]++;p[m[f+2]]++;c[m[f+3]]++}m={};if(b)for(var k=1/(k*l),
B=[],D=[],s=[],t=[],l=0;256>l;l++)B[l]=g[l]*k,D[l]=e[l]*k,s[l]=p[l]*k,t[l]=c[l]*k;this.isLittleEndian?(m.r=c,m.g=p,m.b=e,m.a=g,b&&(m.r_norm=t,m.g_norm=s,m.b_norm=D,m.a_norm=B)):(m.r=g,m.g=e,m.b=p,m.a=c,b&&(m.r_norm=B,m.g_norm=D,m.b_norm=s,m.a_norm=t));return m};c.noise=function(a,b,g,e,p){this.rand=this.rand||new qlib.PRNG;this.rand.seed=a;a=qlib.BitmapDataChannel.RED;var c=qlib.BitmapDataChannel.GREEN,k=qlib.BitmapDataChannel.BLUE,l=this.imagedata.data;b=b||0;g=g||255;e=e||7;p=p||!1;for(var m,r,
q,n,f=0;f<this.height;f++)for(var B=0;B<this.width;B++)m=4*(B+f*this.width),r=this.rand.nextRange(b,g),q=this.rand.nextRange(b,g),n=this.rand.nextRange(b,g),p&&(r=q=n=r=(r+q+n)/3),l[m]=e&a?1*r:0,l[m+1]=e&c?1*q:0,l[m+2]=e&k?1*n:0};c.paletteMap=function(a,b,g,e,p,c,k){b=b.intersection(a.rect);g.x+b.width>this.width&&(b.width=this.width-g.x);g.y+b.height>this.height&&(b.height=this.height-g.y);if(0!=b.width&&0!=b.height){var l=0>this.canvas.width-b.width-g.x?b.width+(this.canvas.width-b.width-g.x):b.width,
m=0>this.canvas.height-b.height-g.y?b.height+(this.canvas.height-b.height-g.y):b.height,f=a.buf8,q;null==e&&(e=qlib.BitmapData.defaultPalette);null==p&&(p=qlib.BitmapData.defaultPalette);null==c&&(c=qlib.BitmapData.defaultPalette);null==k&&(k=qlib.BitmapData.defaultPalette);var n=b.x;b=b.y;a=a.width;for(var w=g.x,B=g.y,D=this.buf8,s=this.width,t=0;t<m;t++)for(var x=0;x<l;x++)g=x+n+(t+b)*a<<2,q=x+w+(t+B)*s<<2,D[q]=e[f[g]],D[q+1]=p[f[g+1]],D[q+2]=c[f[g+2]],D[q+3]=k[f[g+3]];this.updateView()}};c.perlinNoise=
function(a,b,g,e,p){g=g||12245589;this.rand=this.rand||new qlib.PRNG;this.rand.seed=g;var c=qlib.BitmapDataChannel.RED,k=qlib.BitmapDataChannel.GREEN,l=qlib.BitmapDataChannel.BLUE,m=qlib.BitmapDataChannel.ALPHA;e=e||7;p=p||!1;var f=0;if(c&=e){var q=this.simplexR=this.simplexR||new qlib.SimplexNoise(this.rand);this.simplexR.setSeed(g);f++}if(k&=e){var n=this.simplexG=this.simplexG||new qlib.SimplexNoise(this.rand);n.setSeed(g+1);f++}if(l&=e){var w=this.simplexB=this.simplexB||new qlib.SimplexNoise(this.rand);
w.setSeed(g+2);f++}if(e&=m){var B=this.simplexA=this.simplexA||new qlib.SimplexNoise(this.rand);B.setSeed(g+3)}g=this.buf8;for(var D,s,t,x,A,C=0;C<this.height;C++){A=C/b;for(var F=0;F<this.width;F++)x=F/a,m=4*(F+C*this.width),D=c?255*(q.noise(x,A)+1)>>1:0,s=k?255*(n.noise(x,A)+1)>>1:0,t=l?255*(w.noise(x,A)+1)>>1:0,x=e?255*(B.noise(x,A)+1)>>1:255,p&&(D=s=t=(D+s+t)/f),g[m]=D,g[m+1]=s,g[m+2]=t,g[m+3]=x}this.updateView()};c.threshold=function(a,b,g,e,p,c,k,l){c=c||0;k=k||16777215;var m=0>this.canvas.width-
b.width-g.x?b.width+(this.canvas.width-b.width-g.x):b.width,f=0>this.canvas.height-b.height-g.y?b.height+(this.canvas.height-b.height-g.y):b.height,q=a.imagedata.data,n,w=b.x;b=b.y;a=a.width;p&=k;if(l)switch(e){case "<":for(e=0;e<f;e++)for(l=0;l<m;l++)n=4*(l+w+(e+b)*a),n=q[n]<<16|q[n+1]<<8|q[n+2],(n&k)<p&&this.setPixel(l+g.x,e+g.y,n);break;case "<=":for(e=0;e<f;e++)for(l=0;l<m;l++)n=4*(l+w+(e+b)*a),n=q[n]<<16|q[n+1]<<8|q[n+2],(n&k)<=p&&this.setPixel(l+g.x,e+g.y,n);break;case ">":for(e=0;e<f;e++)for(l=
0;l<m;l++)n=4*(l+w+(e+b)*a),n=q[n]<<16|q[n+1]<<8|q[n+2],(n&k)>p&&this.setPixel(l+g.x,e+g.y,n);break;case ">=":for(e=0;e<f;e++)for(l=0;l<m;l++)n=4*(l+w+(e+b)*a),n=q[n]<<16|q[n+1]<<8|q[n+2],(n&k)<=p&&this.setPixel(l+g.x,e+g.y,n);break;case "==":for(e=0;e<f;e++)for(l=0;l<m;l++)n=4*(l+w+(e+b)*a),n=q[n]<<16|q[n+1]<<8|q[n+2],(n&k)==p&&this.setPixel(l+g.x,e+g.y,n);break;case "!=":for(e=0;e<f;e++)for(l=0;l<m;l++)n=4*(l+w+(e+b)*a),n=q[n]<<16|q[n+1]<<8|q[n+2],(n&k)!=p&&this.setPixel(l+g.x,e+g.y,n)}else switch(e){case "<":for(e=
0;e<f;e++)for(l=0;l<m;l++)n=4*(l+w+(e+b)*a),n=q[n]<<16|q[n+1]<<8|q[n+2],(n&k)<p&&this.setPixel(l+g.x,e+g.y,c);break;case "<=":for(e=0;e<f;e++)for(l=0;l<m;l++)n=4*(l+w+(e+b)*a),n=q[n]<<16|q[n+1]<<8|q[n+2],(n&k)<=p&&this.setPixel(l+g.x,e+g.y,c);break;case ">":for(e=0;e<f;e++)for(l=0;l<m;l++)n=4*(l+w+(e+b)*a),n=q[n]<<16|q[n+1]<<8|q[n+2],(n&k)>p&&this.setPixel(l+g.x,e+g.y,c);break;case ">=":for(e=0;e<f;e++)for(l=0;l<m;l++)n=4*(l+w+(e+b)*a),n=q[n]<<16|q[n+1]<<8|q[n+2],(n&k)<=p&&this.setPixel(l+g.x,e+g.y,
c);break;case "==":for(e=0;e<f;e++)for(l=0;l<m;l++)n=4*(l+w+(e+b)*a),n=q[n]<<16|q[n+1]<<8|q[n+2],(n&k)==p&&this.setPixel(l+g.x,e+g.y,c);break;case "!=":for(e=0;e<f;e++)for(l=0;l<m;l++)n=4*(l+w+(e+b)*a),n=q[n]<<16|q[n+1]<<8|q[n+2],(n&k)!=p&&this.setPixel(l+g.x,e+g.y,c)}this.updateView()};c.fillWithGradient=function(a,b,g){var e=document.createElement("canvas");e.setAttribute("width",this.width);e.setAttribute("height",this.height);var p=e.getContext("2d");a=p.createLinearGradient(a[0],a[1],a[2],a[3]);
for(var c=0;c<b.length;c++)a.addColorStop(b[c].ratio,b[c].color);p.fillStyle=a;p.fillRect(0,0,this.width,this.height);this.copyCanvas(e,null,null,g)};c.dispose=function(){this.buf32=this.buf8=this.imagedata=this.context=this.canvas=this.rect=null};qlib.BitmapData=f})();HTMLCanvasElement.prototype._bitmapData=null;HTMLCanvasElement.prototype.__defineGetter__("bitmapData",function(){this._bitmapData||(this._bitmapData=new qlib.BitmapData(this.width,this.height,!0,0,this));return this._bitmapData});
HTMLImageElement.prototype._bitmapData=null;HTMLImageElement.prototype.__defineGetter__("bitmapData",function(){this._bitmapData||(this._bitmapData=new qlib.BitmapData(this.naturalWidth,this.naturalHeight,!0,0));this._bitmapData.draw(this);return this._bitmapData});window.qlib=window.qlib||{};qlib.BitmapDataChannel={ALPHA:8,BLUE:4,GREEN:2,RED:1};window.qlib=window.qlib||{};
qlib.BlendMode={ADD:"add",ADD_SUBTRACT:"addsubtract",ALPHA:"alpha",DARKEN:"darken",DIFFERENCE:"difference",ERASE:"erase",HARDLIGHT:"hardlight",INVERT:"invert",LAYER:"layer",LIGHTEN:"lighten",HARDLIGHT:"hardlight",MULTIPLY:"multiply",NORMAL:"normal",OVERLAY:"overlay",REPLACE:"replace",SCREEN:"screen",SHADER:"shader",SUBTRACT:"subtract"};window.qlib=window.qlib||{};
(function(){var f=function(){this.initialize()},c=f.prototype;c.initialize=function(){if(void 0==qlib.isLittleEndian){var a=new ArrayBuffer(4),b=new Uint8ClampedArray(a);(new Uint32Array(a))[0]=255;qlib.isLittleEndian=255===b[3]}this.isLittleEndian=qlib.isLittleEndian;a=this.box={x:0,y:0,z:0,n:null};for(b=0;256>b;b+=8)a=a.n={x:0,y:0,z:b,n:null},a=a.n={x:255,y:0,z:b,n:null},a=a.n={x:0,y:255,z:b,n:null},a=a.n={x:255,y:255,z:b,n:null},a=a.n={x:0,y:b,z:0,n:null},a=a.n={x:255,y:b,z:0,n:null},a=a.n={x:0,
y:b,z:255,n:null},a=a.n={x:255,y:b,z:255,n:null},a=a.n={x:b,y:0,z:0,n:null},a=a.n={x:b,y:255,z:0,n:null},a=a.n={x:b,y:0,z:255,n:null},a=a.n={x:b,y:255,z:255,n:null}};c.setBitmapData=function(a){this.bitmapData=a;a=a.buf32;var b=a.length-1,d=this.sum={x:0,y:0,z:0},h=this.mean={x:0,y:0,z:0},g=this.totalColors=1,e=this.rgbValues={},p=this.colors={x:0,y:0,z:0,c:1,color:0,n:null},c,k;if(qlib.isLittleEndian)for(c=a[b]>>>8,p.x=c>>16&255,p.y=c>>8&255,p.z=c&255,e[c]=p;-1!=--b;)c=(k=a[b])>>>8,null==e[c]?(p=
p.n={x:c>>16&255,y:c>>8&255,z:c&255,color:k,c:1,n:null},e[c]=p,d.x+=p.x,d.y+=p.y,d.z+=p.z,g++):e[c].c++;else for(c=a[b]&16777215,p.x=c&255,p.y=c>>8&255,p.z=c>>16&255,e[c]=p;-1!=--b;)c=(k=a[b])>>>8,null==e[c]?(p=p.n={x:c&255,y:c>>8&255,z:c>>16&255,color:k,c:1,n:null},e[c]=p,d.x+=p.x,d.y+=p.y,d.z+=p.z,g++):e[c].c++;h.x=d.x/g;h.y=d.y/g;h.z=d.z/g};c.render=function(a,b,d,h,g){h=a.width;var e=a.height,p=this.colors,c,k,l,m,f,q,n=b.rawData[0],w=b.rawData[1],B=b.rawData[2],D=b.rawData[4],s=b.rawData[5],
t=b.rawData[6],x=b.rawData[8],A=b.rawData[9],C=b.rawData[10];b=b.rawData[14]+433.0126953125;f=h*e;for(var F=a.buf32,G=new ArrayBuffer(f),G=new Uint32Array(G),E=qlib.isLittleEndian?255:4278190080,I=.5*h,H=.5*e;-1<--f;)F[f]=0|E,G[f]=1E8;do f=g?g.transformVector(p):p,f=(c=f.x-128)*B+(k=f.y-128)*t+(l=f.z-128)*C+b,q=(m=433.0126953125/f)*(c*n+k*D+l*x)+I|0,c=m*(c*w+k*s+l*A)+H|0,0<=q&&0<=c&&q<h&&c<e&&(c=q+(c*h|0),f<G[c]&&(G[c]=f,F[c]=p.color|E)),p=p.n;while(p);if(d){p=this.box;do f=(c=p.x-128)*B+(k=p.y-128)*
t+(l=p.z-128)*C+b,q=(m=433.0126953125/f)*(c*n+k*D+l*x)+I|0,c=m*(c*w+k*s+l*A)+H|0,0<=q&&0<=c&&q<h&&c<e&&(c=q+(c*h|0),f<G[c]&&(G[c]=f,F[c]=p.color|E)),p=p.next;while(p)}a.updateView()};qlib.CloudRGB=f})();window.qlib=window.qlib||{};
(function(){var f=function(c,a,b,d,h,g,e,p){this.initialize(c,a,b,d,h,g,e,p)};f.prototype.initialize=function(c,a,b,d,h,g,e,p){this.redMultiplier=void 0==c?1:c;this.greenMultiplier=void 0==a?1:a;this.blueMultiplier=void 0==b?1:b;this.alphaMultiplier=void 0==d?1:d;this.redOffset=h||0;this.greenOffset=g||0;this.blueOffset=e||0;this.alphaOffset=p||0};qlib.ColorTransform=f})();window.qlib=window.qlib||{};
(function(){var f=function(a){this.initialize(a)},c=f.prototype;c.initialize=function(a){var b=a.indexOf("http://ns.adobe.com/xap/1.0/");if(-1<b&&255==a.charCodeAt(b-4)&&225==a.charCodeAt(b-3))for(var d=a.charCodeAt(b-2)<<8|a.charCodeAt(b-1),h=a.substr(b+29,d-32).split('"'),d=0;d<h.length;d++)-1<h[d].indexOf("xmpNote:HasExtendedXMP")?(this.extendedXMP=h[d+1],d++):-1<h[d].indexOf("GDepth:Mime")?(this.depthMapMimeType=h[d+1],d++):-1<h[d].indexOf("GDepth:Far")?(this.depthFar=parseFloat(h[d+1]),d++):
-1<h[d].indexOf("GDepth:Near")?(this.depthNear=parseFloat(h[d+1]),d++):-1<h[d].indexOf("GDepth:Format")?(this.depthFormat=h[d+1],d++):-1<h[d].indexOf("GImage:Mime")?(this.imageMapMimeType=h[d+1],d++):-1<h[d].indexOf("GFocus:FocalPointY")?(this.focalPointY=parseFloat(h[d+1]),d++):-1<h[d].indexOf("GFocus:FocalPointX")?(this.focalPointX=parseFloat(h[d+1]),d++):-1<h[d].indexOf("GFocus:FocalDistance")?(this.focalDistance=parseFloat(h[d+1]),d++):-1<h[d].indexOf("GFocus:BlurAtInfinity")&&(this.blurAtInfinity=
parseFloat(h[d+1]),d++);if(!this.extendedXMP)return this;for(h="";-1!=b;)b=a.indexOf("http://ns.adobe.com/xmp/extension/",b+1),-1<b&&255==a.charCodeAt(b-4)&&225==a.charCodeAt(b-3)&&(d=a.charCodeAt(b-2)<<8|a.charCodeAt(b-1),h+=a.substr(b+43+this.extendedXMP.length,d-this.extendedXMP.length-45));a=h.indexOf('GImage:Data="')+13;b=h.indexOf('"',a);a="data:"+this.imageMapMimeType+";base64,"+h.substring(a,b);b=h.indexOf('GDepth:Data="')+13;d=h.indexOf('"',b);h="data:"+this.depthMapMimeType+";base64,"+h.substring(b,
d);this.sourceImage=document.createElement("img");this.sourceImage.src=a;this.depthImage=document.createElement("img");this.depthImage.src=h;var g=this;this.sourceImage.onload=function(){g.renderMap=g.sourceImage.bitmapData.clone();g.renderView=g.renderMap.canvas};return this};c.calculateBlurMaps=function(a,b,d,h){var g=this.sourceImage.bitmapData.clone();this.blurMaps=[];this.blurMaps.push(g.data.data);h=new qlib.StackBlurFilter(a,a,h);for(var e=g.rect,p=new qlib.Point,c=0;c<d;c++){var k=g.clone();
k.applyFilter(g,e,p,h);this.blurMaps.push(k.data.data);g=k;a*=b;h.radiusX=h.radiusY=a}};c.renderLensBlur=function(a,b){for(var d=this.blurMaps.length-1,h=this.depthImage.bitmapData.data.data,g=this.renderMap.data.data,e=this.blurMaps,p=this.depthImage.width*this.depthImage.height;-1<--p;){var c=p<<2,k=Math.max(0,Math.abs(h[c+2]-a)-b)/255*d,l=k|0,m=e[l],l=e[l+1],k=256*(k-(k|0)),f=256-k;g[c]=m[c]*f+l[c]*k>>8;g[c+1]=m[c+1]*f+l[c+1]*k>>8;g[c+2]=m[c+2]*f+l[c+2]*k>>8}this.renderMap.updateView()};c.renderDisplacement=
function(a,b,d){for(var h=this.sourceImage.bitmapData.data.data,g=this.depthImage.bitmapData.data.data,e=this.renderMap.data.data,p=this.depthImage.width,c=this.depthImage.height,k=(p<<2)*c,l,m=c;-1<--m;)for(var f=p;-1<--f;){var k=k-4,q=255-g[k+2]-a;l=f+q*b;q=m+q*d;0>l||l>=p||0>q||q>=c?e[k]=e[k+1]=e[k+2]=e[k+3]=0:(l=(l|0)+(q|0)*p<<2,e[k]=h[l],e[k+1]=h[l+1],e[k+2]=h[l+2])}this.renderMap.updateView()};qlib.DepthMap=f})();window.qlib=window.qlib||{};
(function(){var f=function(){this.initialize()},c=f.prototype;c.MERGE_WITH_BIGGEST="MERGE_WITH_BIGGEST";c.MERGE_WITH_SMALLEST="MERGE_WITH_SMALLEST";c.MERGE_WITH_CLOSEST="MERGE_WITH_CLOSEST";c.initialize=function(){this.shapesAnalyzed=this.indicesFixed=this.shapesReady=this.neighborsReady=this.segmentsReady=this.indexMapReady=!1};qlib.ImageSegmentation=f})();window.qlib=window.qlib||{};
(function(){var f=function(a,b){this.initialize(a,b)},c=f.prototype;c.type=null;c.target=null;c.addEventListener=null;c.removeEventListener=null;c.removeAllEventListeners=null;c.dispatchEvent=null;c.hasEventListener=null;c._listeners=null;qlib.EventDispatcher.initialize(c);c.initialize=function(a,b){this.type=a;this.target=b};c.clone=function(){return new f(this.type,this.target)};c.toString=function(){return"[Event (type="+this.type+")]"};qlib.Event=f})();window.qlib=window.qlib||{};
(function(){var f=function(a){this.initialize(a)},c=f.prototype;c.initialize=function(a){this.matrix=a||[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]};c.run=function(a,b){for(var d=b.data,h=a.data,g=h.length/4,e=this.matrix,p=0,c=0;c<g;c++){var k=d[p],l=d[p+1],m=d[p+2],f=d[p+3];h[p]=e[0]*k+e[1]*l+e[2]*m+e[3]*f+e[4];h[p+1]=e[5]*k+e[6]*l+e[7]*m+e[8]*f+e[9];h[p+2]=e[10]*k+e[11]*l+e[12]*m+e[13]*f+e[14];h[p+3]=e[15]*k+e[16]*l+e[17]*m+e[18]*f+e[19];p+=4}};c.clone=function(){return new qlib.ColorMatrixFilter(this.matrix)};
qlib.ColorMatrixFilter=f})();window.qlib=window.qlib||{};
(function(){var f=function(){};f.apply=function(c,a,b,d){var h=new ArrayBuffer(4*c.buf32.length),h=new Uint32Array(h),g=c.buf32,e=b?255:0;if(qlib.isLittleEndian)for(b=h.length;-1<--b;)h[b]=0!=(g[b]&255^e)?16777215:0;else for(b=h.length;-1<--b;)h[b]=0!=(g[b]>>>24&255^e)?16777215:0;f.verticalDistance(h,c.width,c.height);f.meijster(h,c.width,c.height);d&&(c=new qlib.BitmapData(c.width,c.height,!1,0));g=c.buf32;if(qlib.isLittleEndian)if(a)for(b=h.length;-1<--b;)g[b]=255|h[b]<<8;else for(b=h.length;-1<
--b;)g[b]=255|.5+Math.sqrt(h[b])<<8;else if(a)for(b=h.length;-1<--b;)a=h[b],g[b]=4278190080|(a&16711680)>>16|a&65280|(a&255)<<16;else for(b=h.length;-1<--b;)a=.5+Math.sqrt(h[b])|0,g[b]=4278190080|(a&16711680)>>16|a&65280|(a&255)<<16;c.updateView();return c};f.verticalDistance=function(c,a,b){for(var d,h,g,e=a,p;-1<--e;){d=1;h=e;p=a+e;for(g=1;g<b;g++)c[p]>(h=c[h]+d)?(c[p]=h,d+=2):d=1,h=p,p+=a;d=1;h=(b-1)*a+e;p=h-a;for(g=b-2;0<=g;g--)c[p]>(h=c[h]+d)?(c[p]=h,d+=2):d=1,h=p,p-=a}};f.meijster=function(c,
a,b){var d,h,g,e,p,u,k=new ArrayBuffer(4*a),k=new Int32Array(k),l=new ArrayBuffer(4*a),l=new Int32Array(l);d=new ArrayBuffer(4*a);for(var m=new Uint32Array(d),f=0,q=0;q<b;q++,f+=a){d=k[0]=l[0]=0;for(e=1;e<a;++e){for(u=c[h=f+e];-1!=d&&(g=l[d]-(p=k[d]))*g+c[f+p]>(g=l[d]-e)*g+u;)--d;-1==d?(d=0,k[0]=e):(h=1+(e*e-(p=k[d])*p+c[h]-c[f+p])/(2*(e-p))|0,h<a&&(d++,k[d]=e,l[d]=h))}for(e=0;e<a;e++)m[e]=c[f+e];h=f+a-1;for(e=a-1;-1!=e;--e)c[h--]=(g=e-(p=k[d]))*g+m[p],e==l[d]&&--d}};qlib.EuclideanDistanceTransform=
f})();window.qlib=window.qlib||{};
(function(){var f=function(a,b,d){this.initialize(a,b,d)};f.EDGE_MODE_NONE=0;f.EDGE_MODE_WRAP=1;f.EDGE_MODE_CLAMP=2;f.EDGE_MODE_BLACK=3;f.EDGE_MODE_BACKGROUND=4;var c=f.prototype;c.initialize=function(a,b,d){d=d?512:1024;this.controls=[];this.mappings=[];this.sliderValues=[];this.setFilterData(a);null!=b&&(this.sliderValues=b);this.codeBase="";a=d>>1;b=a>>1;for(var h=[],g=0;1024>g;++g)h[g]=d*Math.cos(g*Math.PI/512)^0;this.codeBase+="var ct=new Int32Array(["+h.join(",")+"]);\n";h=[];for(g=0;g<a;++g)h[g]=
d*Math.tan((g-b)*Math.PI/a)^0;this.codeBase+="var tt=new Int32Array(["+h.join(",")+"]);\n";for(g=0;256>g;++g);this.codeBase+="var cell=new Int32Array(["+h.join(",")+"]);\n";switch(this.edgeMode){case f.EDGE_MODE_WRAP:g="src=function(x,y,z){return z>=0&&z<Z?sd[(w<<2)*(y<0?((y%Y)+Y)%Y:y>=Y?y%Y:y)+((x<0?((x%X)+X)%X:x>=X?x%X:x)<<2)+z]:0}";break;case f.EDGE_MODE_BLACK:case f.EDGE_MODE_BACKGROUND:g="src=function(x,y,z){return z>=0&&z<Z&&y>=0&&y<Y&&x>=0&&x<X?sd[(w<<2)*y+x<<2)+z]:0}";break;default:g="src=function(x,y,z){return z>=0&&z<Z?sd[(w<<2)*(y<0?0:y>=Y?Y-1:y)+((x<0?0:x>=X?X-1:x)<<2)+z]:0}"}this.codeBase+=
"var seed=0xbada55,mt=Math.atan2,msq=Math.sqrt,mr=Math.random,abs=function(x){return x<0?-x:x},min=function(a,b){return a<b?a:b},max=function(a,b){return a>b?a:b},rnd=function(a,b){return a+mr()*(b-a)^0},"+g+",rad=function(d,m,z){return z>=0&&z<Z?src((X>>1)+r2x(d,m),(Y>>1)+r2y(d,m),z):0},val=function(i,a,b){return i>=0&&i<8?a+sv[i]/255*(b-a)^0:0},ctl=function(i){return i>=0&&i<8?sv[i]:0},map=function(i,n){var x=ctl(i*2),y=ctl(i*2+1);return abs(n*(y-x)/255+x)^0},add=function(a,b,c){return min(a+b,c)},dif=function(a,b){return abs(a-b)},sub=function(a,b,c){return max(abs(a-b),c)},mix=function(a,b,n,d){return d==0?0:a*n/d+b*(d-n)/d^0},scl=function(a,il,ih,ol,oh){return(a-il)/(ih-il)*(oh-ol)+ol^0},sqr=function(x){return (x>0?msq(x):0)^0},sin=function(x){return cos(x-256)},cos=function(x){return ct[abs(x)%D]},tan=function(x){return tt[(x+"+
b+")%"+a+"]},put=function(v,i){return i>=0&&i<256?cell[i]=v:0},get=function(i){return i>=0&&i<256?cell[i]:0},r2x=function(d,m){return m*cos(d)/"+d+"^0},r2y=function(d,m){return m*sin(d)/"+d+"^0},c2d=function(x,y){return mt(y,x)*162.974661727^0},c2m=function(x,y){return sqr(x*x+y*y)},cnv=function(m11,m12,m13,m21,m22,m23,m31,m32,m33,d){return (d!=0&&z>=0&&z<Z?(m11*src(x-1,y-1,z)+m12*src(x,y-1,z)+m13*src(x+1,y-1,z)+m21*src(x-1,y,z)+m22*c+m23*src(x+1,y,z)+m31*src(x-1,y+1,z)+m32*src(x,y+1,z)+m33*src(x+1,y+1,z))/d:0);},rmin=gmin=bmin=amin=cmin=imin=mmin=zmin=dmin=xmin=ymin=0,rmax=gmax=bmax=amax=cmax=imax=R=G=B=A=C=255,umin=-56,vmin=-78,umax=56,vmax=78,D=1024,Z=4,zmax=Z-1,dmax=D-1;\n";
this.loopBase="var r=sd[j],g=sd[j+1],b=sd[j+2],a=sd[j+3],i=(76*r+150*g+29*b)>>8,u=(-19*r-37*g+56*b)>>8,v=(78*r-65*g-13*b)>>8,d=c2d(x-(X>>1),y-(Y>>1)),m=c2m(x-(X>>1),y-(Y>>1));\n"};c.setFilterData=function(a){this.filterData=a;this.edgeMode=f.EDGE_MODE_CLAMP;a=a.split("\n[");for(var b=0;b<a.length;b++)if(0==a[b].indexOf("Code]"))for(this.codeLines=a[b].split("\n"),this.codeLines.shift();4<this.codeLines.length;)this.codeLines.pop();else if(0==a[b].indexOf("Control")){for(var d=a[b].split("\n"),h=parseInt(d[0].charAt(8),
10),g=!1,e="",p=0,c=1,k=1;k<d.length;k++)0==d[k].indexOf("Enabled")&&(g=-1<d[k].indexOf("true")),0==d[k].indexOf("Label")&&(e=d[k].split("=")[1]),0==d[k].indexOf("Preset")&&(p=parseInt(d[k].split("=")[1],10)),0==d[k].indexOf("Step")&&(c=parseInt(d[k].split("=")[1],10));this.controls[h]={label:e,enabled:g,preset:p,step:c}}else if(0==a[b].indexOf("Map")){d=a[b].split("\n");h=parseInt(d[0].charAt(4),10);g=!1;e="";p=0;for(k=c=1;k<d.length;k++)0==d[k].indexOf("Enabled")&&(g=-1<d[k].indexOf("true")),0==
d[k].indexOf("Label")&&(e=d[k].split("=")[1]),0==d[k].indexOf("Preset")&&(p=parseInt(d[k].split("=")[1],10)),0==d[k].indexOf("Step")&&(c=parseInt(d[k].split("=")[1],10));this.mappings[h]={label:e,enabled:g,preset:p,step:c};console.log(h,e,g,p,c)}else if(0==a[b].indexOf("Gimp]"))for(h=a[b].split("\n"),k=1;k<h.length;k++)0==h[k].indexOf("EdgeMode")&&(this.edgeMode=parseInt(h[k].split("=")[1],10));for(b=0;8>b;b++)this.sliderValues[b]=this.controls[b].preset};c.run=function(a,b){for(var d=[],h=["r","g",
"b","a"],g=0;g<this.codeLines.length;g++)d[g]="z="+g+",c="+h[g]+",td[j+"+g+"]=("+this.codeLines[g].substring(2)+");";d=this.codeBase+"var sv=new Int32Array(["+this.sliderValues.join(",")+"]);var w=s.width,h=s.height,X=w,Y=h,xmax=X-1,ymax=Y-1,M=c2m(X,Y)>>1,mmax=M-1,sd=s.data,td=t.data;for(var y=0,j=0;y<h;y++){for(var x=0;x<w;x++){"+this.loopBase+d.join(";\n")+"j+=4;}}";h=Date.now();Function(["s","t"],d)(b,a);console.log(Date.now()-h)};c.clone=function(){return new qlib.FilterFactoryFilter(this.filterData,
null!=this.sliderValues?sliderValues.concat():null)};qlib.FilterFactoryFilter=f})();window.qlib=window.qlib||{};
(function(){var f=function(a){this.initialize(a)},c=f.prototype;c.initialize=function(a){if(isNaN(a)||0>a)a=0;this.blur=a|0};c.blur=0;c.getBounds=function(){var a=.5*Math.pow(this.quality,.85);return new qlib.Rectangle(-this.blurX*a,-this.blurY*a,2*this.blurX*a,2*this.blurY*a)};c.run=function(a,b){function d(a,b,d,h,g){for(var e=a.length;-1<--e;)b[e]=a[e];for(var e=1/(g+g+1),p=0;p<h;p++){for(var c=p*d,u=g+1,f=0,t=0,x=0,A=0,C=c<<2,F=c+g<<2,G=c<<2,E=0;E<g;E++)f+=b[G],t+=b[G+1],x+=b[G+2],A+=b[G+3],G+=
4;G=c<<2;for(E=0;E<=g;E++)f+=b[F],t+=b[F+1],x+=b[F+2],A+=b[F+3],u++,c=1/u,a[G]=f*c,a[G+1]=t*c,a[G+2]=x*c,a[G+3]=A*c,F+=4,G+=4;for(E=g+1;E<d-g;E++)f+=b[F]-b[C],t+=b[F+1]-b[C+1],x+=b[F+2]-b[C+2],A+=b[F+3]-b[C+3],a[G]=f*e,a[G+1]=t*e,a[G+2]=x*e,a[G+3]=A*e,F+=4,C+=4,G+=4;for(E=d-g+1;E<d;E++)f-=b[C],t-=b[C+1],x-=b[C+2],A-=b[C+3],u--,c=1/u,a[G]=f*c,a[G+1]=t*c,a[G+2]=x*c,a[G+3]=A*c,C+=4,G+=4}e=1/(g+g+1);for(p=0;p<d;p++){for(var I=p,u=g+1,A=x=t=f=0,C=I<<2,F=d<<2,G=I+g*d<<2,E=I<<2,c=0;c<g;c++)f+=a[C],t+=a[C+
1],x+=a[C+2],A+=a[C+3],C+=F;C=I<<2;for(c=0;c<=g;c++)f+=a[G],t+=a[G+1],x+=a[G+2],A+=a[G+3],u++,I=1/u,b[C]=f*I,b[C+1]=t*I,b[C+2]=t*I,b[C+3]=t*I,G+=F,C+=F;for(c=g+1;c<h-g;c++)f+=a[G]-a[E],t+=a[G+1]-a[E+1],x+=a[G+2]-a[E+2],A+=a[G+3]-a[E+3],b[C]=f*e,b[C+1]=t*e,b[C+2]=x*e,b[C+3]=A*e,E+=F,G+=F,C+=F;for(c=h-g+1;c<h;c++)f-=a[E],t-=a[E+1],x-=a[E+2],A-=a[E+3],u--,I=1/u,b[C]=f*I,b[C+1]=t*I,b[C+2]=x*I,b[C+3]=A*I,E+=F,C+=F}}for(var h=b.data,g=new Uint8ClampedArray(Array(h.length)),e=h.length;-1<--e;)g[e]=h[e];
var h=a.data,e=Math.round(.39*this.blur),p=b.width,c=b.height;d(g,h,p,c,e);d(h,g,p,c,e);d(g,h,p,c,e);return!0};c.clone=function(){return new f(this.blur)};c.toString=function(){return"[GaussianBlurFilter]"};qlib.GaussianBlurFilter=f})();window.qlib=window.qlib||{};
(function(){var f=function(a){this.initialize(a)},c=f.prototype;c.initialize=function(a){this.size=a.buf32.length;this.buffer_r=new ArrayBuffer(this.size);this.buffer_g=new ArrayBuffer(this.size);this.buffer_b=new ArrayBuffer(this.size);this.data_r=new Uint8ClampedArray(this.buffer_r);this.data_g=new Uint8ClampedArray(this.buffer_g);this.data_b=new Uint8ClampedArray(this.buffer_b);this.width=a.width;this.height=a.height};c.clear=function(){this.buffer_r=new ArrayBuffer(this.size);this.buffer_g=new ArrayBuffer(this.size);
this.buffer_b=new ArrayBuffer(this.size);this.data_r=new Uint8ClampedArray(this.buffer_r);this.data_g=new Uint8ClampedArray(this.buffer_g);this.data_b=new Uint8ClampedArray(this.buffer_b)};c.render=function(a,b,d,h,g){var e=a.values,p=a.cols,c=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],k=[Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE],l,m;d=d||[1,1,1];if(g){for(g=e.length;-1<--g;)for(var f=0;3>f;f++)(l=e[g][f])<c[f]&&(c[f]=l),l>k[f]&&(k[f]=l);d=[255*d[0]/(k[0]-c[0]),255*d[1]/(k[1]-
c[1]),255*d[2]/(k[2]-c[2])]}else d=[d[0]||1,d[1]||1,d[2]||1],c=[0,0,0];null==h&&(h=[0,0,0]);k=this.width;l=this.height;for(var f=(a.cols-1)/k,q=(a.rows-1)/l,n=this.data_r,w=this.data_g,B=this.data_b,D=g=0;D<l;D++){a=D*q;for(var s=0;s<k;s++){m=s*f;var t=m^0,x=a^0;m-=t;var A=1-m,C=a-x,F=t+1,G=(x+1)*p,E=x*p,x=e[G+t],G=e[G+F],t=e[E+t],F=e[E+F],E=x[0]*A+G[0]*m,I=t[0]*A+F[0]*m;n[g]=h[0]+(E*C+I*(1-C)-c[0])*d[0];E=x[1]*A+G[1]*m;I=t[1]*A+F[1]*m;w[g]=h[1]+(E*C+I*(1-C)-c[1])*d[1];E=x[2]*A+G[2]*m;I=t[2]*A+F[2]*
m;B[g]=h[2]+(E*C+I*(1-C)-c[2])*d[2];g++}}bmBuffer=b.buf32;if(qlib.isLittleEndian)for(g=n.length;-1<--g;)bmBuffer[g]=n[g]<<24|w[g]<<16|B[g]<<8|255;else for(g=n.length;-1<--g;)bmBuffer[g]=4278190080|B[g]<<16|w[g]<<8|n[g];b.updateView()};qlib.GradientMapGenerator=f})();window.qlib=window.qlib||{};
(function(){var f=function(a){this.initialize(a)},c=f.prototype;c.initialize=function(a){this.size=a.buf32.length;this.buffer=new ArrayBuffer(this.size);this.data=new Uint8ClampedArray(this.buffer);this.width=a.width;this.height=a.height};c.clear=function(){this.buffer=new ArrayBuffer(this.size);this.data=new Uint8ClampedArray(this.buffer)};c.render=function(a,b,d,h,g){var e=a.heights||a.values,p=a.cols,c=Number.MAX_VALUE,k=Number.MIN_VALUE,l,m,f;if(g){for(g=e.length;-1<--g;)(l=e[g])<c&&(c=l),l>k&&
(k=l);l=255*(d||1)/(k-c)}else l=d||1,c=0;null==h&&(h=0);d=this.width;var k=this.height,q=(a.cols-1)/d,n=(a.rows-1)/k;a=this.data;for(var w=g=0;w<k;w++){f=w*n;for(var B=0;B<d;B++){m=B*q;var D=a,s=g++,t=m^0,x=f^0;m-=t;var A=1-m,C=f-x,F=t+1,G=(x+1)*p,x=x*p;D[s]=h+((e[G+t]*A+e[G+F]*m)*C+(e[x+t]*A+e[x+F]*m)*(1-C)-c)*l}}bmBuffer=b.buf32;if(qlib.isLittleEndian)for(g=a.length;-1<--g;)l=a[g],bmBuffer[g]=l<<24|l<<16|l<<8|255;else for(g=a.length;-1<--g;)l=a[g],bmBuffer[g]=4278190080|l<<16|l<<8|l;b.updateView()};
qlib.HeightMapGenerator=f})();window.qlib=window.qlib||{};
(function(){var f=function(){};f.BENT_CORNERS_UP=0;f.BENT_CORNERS_DOWN=1;f.RANDOM=2;f.makeShadow=function(c,a,b){html2canvas(dDOMElement,{onrendered:function(a){hmg.render(points,heightMap,.3,128,!1);drawMatrix.tx=corners[0].x;drawMatrix.ty=corners[0].y;outputMap.clear();outputMap.copyCanvas(heightMap,null,corners[0],qlib.BlendMode.REPLACE);outputMap.clear(clearRect);qlib.ShadowAccumulator.apply(outputMap,lightSource.x,lightSource.y,1.5,-110,.3,.7,.8,.001,10,.333*Math.PI,output.bitmapData);outputMap.draw(audrey,
drawMatrix);outputMap.copyCanvas(heightMap,null,corners[0],qlib.BlendMode.ADD_SUBTRACT,{blendFactor:.8});stage.update()}})};qlib.OrganicShadow=f})();window.qlib=window.qlib||{};
(function(){var f=function(a){this.initialize(a)},c=f.prototype;c.initialize=function(a){this.size=a.buf32.length;this.buffer=new ArrayBuffer(4*this.size);this.data=new Uint32Array(this.buffer)};c.addPixels=function(a,b){b=b||1;for(var d=a.buf8,h=qlib.isLittleEndian?0:3,g=this.data,e=this.size;-1<--e;)g[e]+=d[(e<<2)+h]*b};c.clear=function(){this.buffer=new ArrayBuffer(4*this.size);this.data=new Uint32Array(this.buffer)};c.render=function(a,b,d,h,g){d=d||1;for(var e=Number.MAX_VALUE,c=0,f=this.data,
k,l=this.size;-1<--l;)(k=f[l])>c&&(c=k),k<e&&(e=k);k=c-e;e+=(h||0)*k;c=1/(c+(g||0)*k-e)*(b||1);bmBuffer=a.buf32;if(qlib.isLittleEndian)for(l=f.length;-1<--l;)k=255*Math.pow((f[l]-e)*c,d)+.5|0,0>k&&(k=0),255<k&&(k=255),bmBuffer[l]=k;else for(l=f.length;-1<--l;)k=255*Math.pow((f[l]-e)*c,d)+.5|0,0>k&&(k=0),255<k&&(k=255),bmBuffer[l]=k<<24;a.updateView()};qlib.PixelAccumulator=f})();window.qlib=window.qlib||{};
(function(){var f=function(a){this.initialize(a)},c=f.prototype;c.initialize=function(a){this.size=a.buf32.length;this.clear()};c.addPixels=function(a){a=a.buf32;for(var b=qlib.isLittleEndian?8:16,d=qlib.isLittleEndian?16:8,h=qlib.isLittleEndian?24:0,g=this.r,e=this.g,c=this.b,f=this.size;-1<--f;){var k=a[f];g[f]+=k>>b&255;e[f]+=k>>d&255;c[f]+=k>>h&255}this.count++};c.clear=function(){this.count=0;this.buffer_r=new ArrayBuffer(4*this.size);this.buffer_r=new ArrayBuffer(4*this.size);this.r=new Uint32Array(this.buffer_r);
this.buffer_g=new ArrayBuffer(4*this.size);this.g=new Uint32Array(this.buffer_g);this.buffer_b=new ArrayBuffer(4*this.size);this.b=new Uint32Array(this.buffer_b)};c.render=function(a,b){null==b&&(b=!1);var d=this.r,h=this.g,g=this.b,e;if(b){for(var c=Number.MAX_VALUE,f=0,k=Number.MAX_VALUE,l=0,m=Number.MAX_VALUE,r=0,q=this.size;-1<--q;)(e=d[q])>f&&(f=e),e<c&&(c=e),(e=h[q])>l&&(l=e),e<k&&(k=e),(e=g[q])>r&&(r=e),e<m&&(m=e);f=1/(f-c);l=1/(l-k);r=1/(r-m)}else f=l=r=1/(255*this.count),c=k=m=0;bmBuffer=
a.buf32;var n,w;if(qlib.isLittleEndian)for(q=d.length;-1<--q;)e=(d[q]-c)*f*255+.5|0,0>e?e=0:255<e&&(e=255),n=(h[q]-k)*l*255+.5|0,0>n?n=0:255<n&&(n=255),w=(g[q]-m)*r*255+.5|0,0>w?w=0:255<w&&(w=255),bmBuffer[q]=255|e<<8|n<<16|w<<24;else for(q=d.length;-1<--q;)e=(d[q]-c)*f*255+.5|0,0>e?e=0:255<e&&(e=255),n=(h[q]-k)*l*255+.5|0,0>n?n=0:255<n&&(n=255),w=(g[q]-m)*r*255+.5|0,0>w?w=0:255<w&&(w=255),bmBuffer[q]=4278190080|e<<16|n<<8|w;a.updateView()};qlib.RGBAccumulator=f})();window.qlib=window.qlib||{};
(function(){var f=function(){};f.apply=function(c,a,b,d,h,g,e,p,f,k,l,m){null==a&&(a=0);null==b&&(b=0);null==d&&(d=1);null==h&&(h=0);g=g||.25;e=e||.94;p=p||1;k=k||5;f=new ArrayBuffer(4*c.buf32.length);f=new Uint32Array(f);var r=c.buf8,q=c.width,n=c.height,w=qlib.isLittleEndian?0:3,B=qlib.isLittleEndian?1:2;if(1==k)l=[1,0];else{var D=l/(k-1),s=.5*-l;l=[];for(var t=0;t<k;t++)l.push(Math.cos(s),Math.sin(s)),s+=D}for(var x,A,C,F,G,D=0;D<n;D++)for(s=0;s<q;s++)if(t=s+D*q<<2,0<r[t+w]){var E=(r[t+B]+h)*g;
if(0<E)for(t=s-a,x=D-b,C=Math.sqrt(t*t+x*x),C=1/C,A=d*C,C=1+500*E,t*=A,x*=A,A=0;A<k;A++)for(var I=s,H=D,L=C,z=E,J=t*l[2*A]-x*l[2*A+1],y=t*l[2*A+1]+x*l[2*A];0<z&&0<L&&-1<I&&-1<H&&(F=I+.5|0)<q&&(G=H+.5|0)<n;)f[F+G*q]+=L,z--,I+=J,H+=y,L*=e}a=0;for(t=f.length;-1<--t;)f[t]>a&&(a=f[t]);a=255/a*p;null==m&&(m=new qlib.BitmapData(c.width,c.height,!1,0));r=m.buf32;if(qlib.isLittleEndian)for(t=f.length;-1<--t;)r[t]=f[t]*a&255;else for(t=f.length;-1<--t;)r[t]=(f[t]*a&255)<<24;m.updateView();return m};qlib.ShadowAccumulator=
f})();window.qlib=window.qlib||{};
(function(){var f=function(a,b,d){this.initialize(a,b,d)},c=f.prototype;c.initialize=function(a,b,d){if(isNaN(a)||0>a)a=0;this.blurX=a|0;if(isNaN(b)||0>b)b=0;this.blurY=b|0;if(isNaN(d)||1>d)d=1;this.quality=d|0};c.blurX=0;c.blurY=0;c.quality=1;c.mul_table=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265,497,469,443,421,25,191,365,349,335,161,155,149,9,278,269,261,505,245,475,231,449,437,213,415,405,395,193,377,369,361,353,345,169,331,325,319,313,307,301,37,145,285,281,69,271,267,263,259,
509,501,493,243,479,118,465,459,113,446,55,435,429,423,209,413,51,403,199,393,97,3,379,375,371,367,363,359,355,351,347,43,85,337,333,165,327,323,5,317,157,311,77,305,303,75,297,294,73,289,287,71,141,279,277,275,68,135,67,133,33,262,260,129,511,507,503,499,495,491,61,121,481,477,237,235,467,232,115,457,227,451,7,445,221,439,218,433,215,427,425,211,419,417,207,411,409,203,202,401,399,396,197,49,389,387,385,383,95,189,47,187,93,185,23,183,91,181,45,179,89,177,11,175,87,173,345,343,341,339,337,21,167,
83,331,329,327,163,81,323,321,319,159,79,315,313,39,155,309,307,153,305,303,151,75,299,149,37,295,147,73,291,145,289,287,143,285,71,141,281,35,279,139,69,275,137,273,17,271,135,269,267,133,265,33,263,131,261,130,259,129,257,1];c.shg_table=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13,14,14,14,14,10,13,14,14,14,13,13,13,9,14,14,14,15,14,15,14,15,15,14,15,15,15,14,15,15,15,15,15,14,15,15,15,15,15,15,12,14,15,15,13,15,15,15,15,16,16,16,15,16,14,16,16,14,16,13,16,16,16,15,16,13,16,15,16,14,9,16,16,16,16,
16,16,16,16,16,13,14,16,16,15,16,16,10,16,15,16,14,16,16,14,16,16,14,16,16,14,15,16,16,16,14,15,14,15,13,16,16,15,17,17,17,17,17,17,14,15,17,17,16,16,17,16,15,17,16,17,11,17,16,17,16,17,16,17,17,16,17,17,16,17,17,16,16,17,17,17,16,14,17,17,17,17,15,16,14,16,15,16,13,16,15,16,14,16,15,16,12,16,15,16,17,17,17,17,17,13,16,15,17,17,17,16,15,17,17,17,16,15,17,17,14,16,17,17,16,17,17,16,15,17,16,14,17,16,15,17,16,17,17,16,17,15,16,17,14,17,16,15,17,16,17,13,17,16,17,17,16,17,14,17,16,17,16,17,16,17,9];
c.getBounds=function(){var a=.5*Math.pow(this.quality,.85);return new qlib.Rectangle(-this.blurX*a,-this.blurY*a,2*this.blurX*a,2*this.blurY*a)};c.run=function(a,b){var d=this.blurX/2;if(isNaN(d)||0>d)return!1;var d=d|0,h=this.blurY/2;if(isNaN(h)||0>h)return!1;h|=0;if(0==d&&0==h)return!1;var g=this.quality;if(isNaN(g)||1>g)g=1;g|=0;3<g&&(g=3);1>g&&(g=1);var e=b.data,c=a.data,f,k,l,m,r,q,n,w,B,D,s,t,x,A;for(l=a.data.length;-1<--l;)c[l]=e[l];var C=d+d+1;q=h+h+1;var e=a.width,F=a.height,G=e-1,E=F-1,
I=d+1,H=h+1,L={r:0,b:0,g:0,a:0,next:null};f=L;for(l=1;l<C;l++)f=f.next={r:0,b:0,g:0,a:0,next:null};f.next=L;k=C={r:0,b:0,g:0,a:0,next:null};for(l=1;l<q;l++)k=k.next={r:0,b:0,g:0,a:0,next:null};k.next=C;for(l=null;0<g--;){n=q=0;var z=this.mul_table[d],J=this.shg_table[d];for(k=F;-1<--k;){w=I*(t=c[q]);B=I*(x=c[q+1]);D=I*(A=c[q+2]);s=I*(r=c[q+3]);f=L;for(l=I;-1<--l;)f.r=t,f.g=x,f.b=A,f.a=r,f=f.next;for(l=1;l<I;l++)m=q+((G<l?G:l)<<2),w+=f.r=c[m],B+=f.g=c[m+1],D+=f.b=c[m+2],s+=f.a=c[m+3],f=f.next;l=L;
for(f=0;f<e;f++)c[q++]=w*z>>>J,c[q++]=B*z>>>J,c[q++]=D*z>>>J,c[q++]=s*z>>>J,m=n+((m=f+d+1)<G?m:G)<<2,w-=l.r-(l.r=c[m]),B-=l.g-(l.g=c[m+1]),D-=l.b-(l.b=c[m+2]),s-=l.a-(l.a=c[m+3]),l=l.next;n+=e}z=this.mul_table[h];J=this.shg_table[h];for(f=0;f<e;f++){q=f<<2;w=H*(t=c[q]);B=H*(x=c[q+1]);D=H*(A=c[q+2]);s=H*(r=c[q+3]);k=C;for(l=0;l<H;l++)k.r=t,k.g=x,k.b=A,k.a=r,k=k.next;r=e;for(l=1;l<=h;l++)q=r+f<<2,w+=k.r=c[q],B+=k.g=c[q+1],D+=k.b=c[q+2],s+=k.a=c[q+3],k=k.next,l<E&&(r+=e);q=f;l=C;if(0<g)for(k=0;k<F;k++)m=
q<<2,c[m+3]=r=s*z>>>J,0<r?(c[m]=w*z>>>J,c[m+1]=B*z>>>J,c[m+2]=D*z>>>J):c[m]=c[m+1]=c[m+2]=0,m=f+((m=k+H)<E?m:E)*e<<2,w-=l.r-(l.r=c[m]),B-=l.g-(l.g=c[m+1]),D-=l.b-(l.b=c[m+2]),s-=l.a-(l.a=c[m+3]),l=l.next,q+=e;else for(k=0;k<F;k++)m=q<<2,c[m+3]=r=s*z>>>J,0<r?(r=255/r,c[m]=(w*z>>>J)*r,c[m+1]=(B*z>>>J)*r,c[m+2]=(D*z>>>J)*r):c[m]=c[m+1]=c[m+2]=0,m=f+((m=k+H)<E?m:E)*e<<2,w-=l.r-(l.r=c[m]),B-=l.g-(l.g=c[m+1]),D-=l.b-(l.b=c[m+2]),s-=l.a-(l.a=c[m+3]),l=l.next,q+=e}}return!0};c.clone=function(){return new f(this.blurX,
this.blurY,this.quality)};c.toString=function(){return"[StackBlurFilter]"};qlib.StackBlurFilter=f})();window.qlib=window.qlib||{};
(function(){var f=function(a,b,d){this._radius=d|200;this._center=b;this._matrix3d=a;this.init()},c=f.prototype;c.init=function(){this.startVector=new qlib.Vector3;this.startQuat=new qlib.Vector3;this.dragQuat=new qlib.Vector3;this.dragVector=new qlib.Vector3;this.newQuat=new qlib.Vector3;this.radiusVector=new qlib.Vector3;this.transformComponents=[]};c.startDrag=function(){this.transformComponents=this._matrix3d.decompose(Orientation3D.QUATERNION);var a=this.transformComponents[1];this.startQuat.x=
a.x;this.startQuat.y=a.y;this.startQuat.z=a.z;this.startQuat.w=a.w;this.dragQuat.x=this.dragQuat.y=this.dragQuat.z=this.dragQuat.w=0};c.dragTo=function(){var a=this.startVector.crossProduct(this.dragVector);this.dragQuat.x=a.x;this.dragQuat.y=a.y;this.dragQuat.z=a.z;this.dragQuat.w=this.startVector.dotProduct(this.dragVector);this.multiplyQuats(this.dragQuat,this.startQuat,this.newQuat);this.transformComponents[1]=this.newQuat;this._matrix3d.recompose(this.transformComponents,Orientation3D.QUATERNION)};
c.coordinate2DToSphere=function(a,b,d){d.x=(this._center.x-a)/this._radius;d.y=(this._center.y-b)/this._radius;d.z=0;1<d.lengthSquared?d.normalize():d.z=Math.sqrt(1-d.lengthSquared);return d};c.onMouseDown=function(a,b){this.startVector=this.coordinate2DToSphere(a,b,startVector);this.startDrag(this.startVector)};c.onMouseMove=function(a,b){this.dragVector=this.coordinate2DToSphere(a,b,this.dragVector);this.dragTo(this.dragVector)};c.multiplyQuats=function(a,b,d){d.x=a.w*b.x+a.x*b.w+a.y*b.z-a.z*b.y;
d.y=a.w*b.y+a.y*b.w+a.z*b.x-a.x*b.z;d.z=a.w*b.z+a.z*b.w+a.x*b.y-a.y*b.x;d.w=a.w*b.w-a.x*b.x-a.y*b.y-a.z*b.z};qlib.ArcBall=f})();window.qlib=window.qlib||{};
(function(){qlib.KDTreeNode=function(){this.count=1};var f=function(){this.firstNode=null},c=f.prototype;c.insertPoint=function(a,b,d){null==b&&(b=!1);null==d&&(d=.2);null==this.firstNode?(this.firstNode=new qlib.KDTreeNode,this.firstNode.depth=0,this.firstNode.point=a):(a=this.insertNode(a,this.firstNode),b&&this.checkNodeBalanceBottomUp(d,a,null))};c.insertPoints=function(a,b,d){null==b&&(b=!1);null==d&&(d=.2);if(null==this.firstNode)this.firstNode=new qlib.KDTreeNode,this.buildDepth(a.concat(),
this.firstNode,0);else{for(var h in a)this.insertPoint(a[h]);b&&this.rebalance(d)}};c.removePoint=function(a,b,d){null==b&&(b=!1);null==d&&(d=.2);if(null!=this.firstNode&&(a=this.findPoint(a,firstNode),null!=a)){var h=[];null==a.parent?firstNode=null:null==a.parent.parent?(this.getPoints(a.parent,a,h),this.firstNode=new qlib.KDTreeNode,this.firstNode.depth=0,this.firstNode.point=h[0]):(a.parent.count--,this.getPoints(a.parent.parent,a,h),this.buildDepth(h,a.parent.parent,a.parent.parent.depth),b&&
this.checkNodeBalanceBottomUp(d,a.parent.parent,null))}};c.removeNearest=function(a,b,d){if(null!=this.firstNode){null==b&&(b=!1);null==d&&(d=.2);var h=[];a=this.findNearestForNode(a,this.firstNode);null==a.parent?firstNode=null:null==a.parent.parent?(this.getPoints(a.parent,a,h),this.firstNode=new qlib.KDTreeNode,this.firstNode.depth=0,this.firstNode.point=h[0]):(a.parent.count--,this.getPoints(a.parent.parent,a,h),this.buildDepth(h,a.parent.parent,a.parent.parent.depth),b&&this.checkNodeBalanceBottomUp(d,
a.parent.parent,null))}};c.rebalance=function(a){null!=firstNode&&(null==a&&(a=.2),this.checkNodeBalanceTopDown(a,this.firstNode))};c.checkNodeBalanceTopDown=function(a,b){b.left&&b.right?Math.min(b.left.count,b.right.count)/Math.max(b.left.count,b.right.count)<a?this.rebalanceNode(b):(this.checkNodeBalanceTopDown(a,b.left),this.checkNodeBalanceTopDown(a,b.right)):b.left?1<b.left.count&&this.rebalanceNode(b):b.right&&1<b.right.count&&this.rebalanceNode(b)};c.checkNodeBalanceBottomUp=function(a,b,
d){if(null==b)null!=d&&this.rebalanceNode(d);else if(b.left&&b.right){var h=Math.min(b.left.count,b.right.count)/Math.max(b.left.count,b.right.count);this.checkNodeBalanceBottomUp(a,b.parent,h<a?b:d)}else b.left?this.checkNodeBalanceBottomUp(a,b.parent,1<b.left.count?b:d):b.right?this.checkNodeBalanceBottomUp(a,b.parent,1<b.right.count?b:d):this.checkNodeBalanceBottomUp(a,b.parent,d)};c.rebalanceNode=function(a){var b=[];null!=a.parent?(this.getPoints(a.parent,null,b),this.buildDepth(b,a.parent,a.parent.depth)):
(this.getPoints(firstNode,null,b),this.firstNode=null,this.insertPoints(b))};c.insertNode=function(a,b){var d;if(b.depth&1?a.y<b.point.y:a.x<b.point.x)if(b.left)b.count++,d=this.insertNode(a,b.left);else{if(a.x!=b.point.x||a.y!=b.point.y)b.count+=2,b.left=new qlib.KDTreeNode,b.left.parent=b,b.left.depth=b.depth+1,b.left.point=a,b.right=new qlib.KDTreeNode,b.right.parent=b,b.right.depth=b.depth+1,b.right.point=b.point,d=b.left}else if(b.right)b.count++,d=this.insertNode(a,b.right);else if(a.x!=b.point.x||
a.y!=b.point.y)b.count+=2,b.left=new qlib.KDTreeNode,b.left.parent=b,b.left.depth=b.depth+1,b.left.point=b.point,b.right=new qlib.KDTreeNode,b.right.parent=b,b.right.depth=b.depth+1,b.right.point=a,d=b.right;return d};c.buildDepth=function(a,b,d){b.depth=d;if(1==a.length)b.point=a[0];else{a.sort(d&1?this.sortY:this.sortX);var h=a.length>>1|0,h=a.splice(h,a.length-h);b.point=a[a.length-1];0<a.length&&(b.count++,b.left=new qlib.KDTreeNode,b.left.parent=b,this.buildDepth(a,b.left,d+1));0<h.length&&(b.count++,
b.right=new qlib.KDTreeNode,b.right.parent=b,this.buildDepth(h,b.right,d+1))}};c.findNearestFor=function(a){return null==this.firstNode?null:this.findNearestForNode(a,this.firstNode)};c.findNearestForNode=function(a,b){if(b.left&&b.right){var d,h,g,e;d=b.depth&1?b.point.y-a.y:b.point.x-a.x;0>=d?(h=b.right,g=b.left):(h=b.left,g=b.right);e=this.findNearestForNode(a,h);h=e.dist;if(h<d*d)return e;d=this.findNearestForNode(a,g);return d.dist<h?d:e}if(b.left)return this.findNearestForNode(a,b.left);if(b.right)return this.findNearestForNode(a,
b.right);b.dist=b.point.squaredDistanceToVector(a);return b};c.findPoint=function(a,b){if(b.left&&b.right){var d=this.findPoint(a,b.left);if(null!=d)return d;d=this.findPoint(a,b.right);if(null!=d)return d}else{if(b.left)return this.findPoint(a,b.left);if(b.right)return this.findPoint(a,b.right);if(b.point==a)return b}return null};c.sortX=function(a,b){return a.x>b.x?1:-1};c.sortY=function(a,b){return a.y>b.y?1:-1};c.getPoints=function(a,b,d){a.left&&a.right?(this.getPoints(a.left,b,d),this.getPoints(a.right,
b,d)):a!=b&&d.push(a.point)};c.draw=function(a,b){b.drawRect(a.x,a.y,a.width,a.height);null!=this.firstNode&&this.drawNode(this.firstNode,a,b)};c.drawNode=function(a,b,d){a.left&&a.right||d.drawCircle(a.point.x,a.point.y,2);a.depth&1?(d.moveTo(b.x,a.point.y),d.lineTo(b.x+b.width,a.point.y),a.left&&this.drawNode(a.left,new qlib.Rectangle(b.x,b.y,b.width,a.point.y-b.y),d),a.right&&this.drawNode(a.right,new qlib.Rectangle(b.x,a.point.y,b.width,b.y+b.height-a.point.y),d)):(d.moveTo(a.point.x,b.y),d.lineTo(a.point.x,
b.y+b.height),a.left&&this.drawNode(a.left,new qlib.Rectangle(b.x,b.y,a.point.x-b.x,b.height),d),a.right&&this.drawNode(a.right,new qlib.Rectangle(a.point.x,b.y,b.x+b.width-a.point.x,b.height),d))};qlib.BalancingKDTree=f})();window.qlib=window.qlib||{};
(function(){var f=function(){this.initialize(arguments)},c=f.prototype=new qlib.GeometricShape;f.CURVE_LENGTH_PRECISION=31;f.OFFSET_PRECISION=10;c.type="Bezier2";c.initialize=function(a){var b=0;0==a.length?(this.p1=new qlib.Vector2,this.p2=new qlib.Vector2,this.c=new qlib.Vector2):("number"==typeof a[0]?(this.p1=new qlib.Vector2(a[0],a[1]),b+=2):(this.p1=a[0],b++),"number"==typeof a[b]?(this.c=new qlib.Vector2(a[b],a[b+1]),b+=2):(this.c=a[b],b++),this.p2="number"==typeof a[b]?new qlib.Vector2(a[b],
a[b+1]):a[b]);this.dirty=!0};c.getPoint=function(a){var b=1-a;return new qlib.Vector2(b*b*this.p1.x+2*a*b*this.c.x+a*a*this.p2.x,b*b*this.p1.y+2*a*b*this.c.y+a*a*this.p2.y)};c.__defineGetter__("length",function(){if(!this.dirty)return this.__length;var a,b=0,d=f.CURVE_LENGTH_PRECISION;d&1||d++;var h=[],g=[];for(a=0;a<d;++a)h[a]=a/(d-1),g[a]=this.getPoint(h[a]);for(a=0;a<d-1;a+=2)b+=this.getSectionLength(h[a],h[a+1],h[a+2],g[a],g[a+1],g[a+2]);this.__length=b;this.dirty=!1;return b});c.getSectionLength=
function(a,b,d,h,g,e){var c,f=h.getMinus(e).length,k=h.getMinus(g).length,l=g.getMinus(e).length;c=k+l;return 1E-5>c||0==k||0==l?c+(c-f)/3:1E-5>f||1.05<c/f||1E-6>k||1.2<l/k||1E-6>l||1.2<k/l?(c=(a+b)/2,f=this.getPoint(c),a=this.getSectionLength(a,c,b,h,f,g),c=(b+d)/2,f=this.getPoint(c),b=this.getSectionLength(b,c,d,g,f,e),a+b):c+(c-f)/3};c.clone=function(a){return!0==a?new qlib.Bezier2(this.p1.clone(),this.c.clone(),this.p2.clone()):new qlib.Bezier2(this.p1,this.c,this.p2)};c.moveToStart=function(a,
b){a.moveTo(this.p1.x+(null!=b?b.x:0),this.p1.y+(null!=b?b.y:0))};c.moveToEnd=function(a,b){a.moveTo(this.p2.x+(null!=b?b.x:0),this.p2.y+(null!=b?b.y:0))};c.draw=function(a,b){this.moveToStart(a,b);this.drawTo(a,b)};c.drawExtras=function(a,b,d){b=null==b?1:b;this.moveToStart(a,d);a.lineTo(this.c.x+(null!=d?d.x:0),this.c.y+(null!=d?d.y:0));a.lineTo(this.p2.x+(null!=d?d.x:0),this.p2.y+(null!=d?d.y:0));this.p1.draw(a,b,d);this.p2.draw(a,b,d);this.c.draw(a,b,d)};c.drawTo=function(a,b){null==b?a.curveTo(this.c.x,
this.c.y,this.p2.x,this.p2.y):a.curveTo(this.c.x+b.x,this.c.y+b.y,this.p2.x+b.x,this.p2.y+b.y)};c.drawToReverse=function(a,b){null==b?a.curveTo(this.c.x,this.c.y,this.p1.x,this.p1.y):a.curveTo(this.c.x+b.x,this.c.y+b.y,this.p1.x+b.x,this.p1.y+b.y)};c.toString=function(){return"Bezier2"};qlib.Bezier2=f})();window.qlib=window.qlib||{};
(function(){var f=function(){this.initialize(arguments)};f.CURVE_LENGTH_PRECISION=31;f.OFFSET_PRECISION=10;f.MAXDEPTH=64;f.EPSILON=Math.pow(2,-f.MAXDEPTH-1);f.cubicZ=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]];var c=f.prototype=new qlib.GeometricShape;c.type="Bezier3";c.initialize=function(a){var b=0;0==a.length?(this.p1=new qlib.Vector2,this.p2=new qlib.Vector2,this.c1=new qlib.Vector2,this.c2=new qlib.Vector2):("number"==typeof a[0]?(this.p1=new qlib.Vector2(a[0],a[1]),b+=2):(this.p1=a[0],b++),"number"==
typeof a[b]?(this.c1=new qlib.Vector2(a[b],a[b+1]),b+=2):(this.c1=a[b],b++),"number"==typeof a[b]?(this.c2=new qlib.Vector2(a[b],a[b+1]),b+=2):(this.c2=a[b],b++),this.p2="number"==typeof a[b]?new qlib.Vector2(a[b],a[b+1]):a[b]);this.updateFactors()};c.updateFactors=function(){this.gx=3*(this.c1.x-this.p1.x);this.bx=3*(this.c2.x-this.c1.x)-this.gx;this.ax=this.p2.x-this.p1.x-this.bx-this.gx;this.gy=3*(this.c1.y-this.p1.y);this.by=3*(this.c2.y-this.c1.y)-this.gy;this.ay=this.p2.y-this.p1.y-this.by-
this.gy;this.pre_pt={};this.pre_seg={};this.dirty=!1;this.lengthDirty=!0};c.intersect=function(a){this.updateFactors();return qlib.Intersection.intersect(this,a)};c.getPoint=function(a){if(null==this.pre_pt[a]){var b=a*a;this.pre_pt[a]=new qlib.Vector2(this.ax*b*a+this.bx*b+this.gx*a+this.p1.x,this.ay*b*a+this.by*b+this.gy*a+this.p1.y)}return this.pre_pt[a]};c.__defineGetter__("length",function(){if(!this.lengthDirty)return this.__length;this.updateFactors();var a,b=0,d=f.CURVE_LENGTH_PRECISION;d&
1||d++;var h=[],g=[];for(a=0;a<d;++a)h[a]=a/(d-1),g[a]=this.getPoint(h[a]);for(a=0;a<d-1;a+=2)b+=this.getSectionLength(h[a],h[a+1],h[a+2],g[a],g[a+1],g[a+2]);this.__length=b;this.lengthDirty=!1;return b});c.getSectionLength=function(a,b,d,h,g,e){var c=a+"|"+b+"|"+d;if(null==this.pre_seg[c]){var f,k,l,m;f=h.getMinus(e).length;l=h.getMinus(g).length;m=g.getMinus(e).length;k=l+m;1E-5>k?this.pre_seg[c]=k+(k-f)/3:1E-5>f||1.05<k/f||1E-6>l||1.2<m/l||1E-6>m||1.2<l/m?(f=(a+b)/2,k=this.getPoint(f),a=this.getSectionLength(a,
f,b,h,k,g),f=(b+d)/2,k=this.getPoint(f),b=this.getSectionLength(b,f,d,g,k,e),this.pre_seg[c]=a+b):this.pre_seg[c]=k+(k-f)/3}return this.pre_seg[c]};c.clone=function(a){return!0==a?new qlib.Bezier3(this.p1.clone(),this.c1.clone(),this.c2.clone(),this.p2.clone()):new qlib.Bezier3(this.p1,this.c1,this.c2,this.p2)};c.moveToStart=function(a,b){a.moveTo(this.p1.x+(null!=b?b.x:0),this.p1.y+(null!=b?b.y:0))};c.moveToEnd=function(a,b){a.moveTo(this.p2.x+(null!=b?b.x:0),this.p2.y+(null!=b?b.y:0))};c.draw=function(a,
b){this.moveToStart(a,b);this.drawTo(a,b)};c.drawNicely=function(a,b,d){this.moveToStart(a,d);this.drawToNicely(a,b,d)};c.drawToNicely=function(a,b,d){b=(null==b?4:b)/this.length;if(null==d){for(var h=b;1>h;h+=b)this.getPoint(h),a.lineTo(this.p.x,this.p.y);a.lineTo(this.p2.x,this.p2.y)}else{for(h=b;1>h;h+=b)this.getPoint(h),a.lineTo(this.p.x+d.x,this.p.y+d.y);a.lineTo(this.p2.x+d.x,this.p2.y+d.y)}};c.drawExtras=function(a,b,d){b=null==b?1:b;this.moveToStart(a,d);null==d?(a.lineTo(this.c1.x,this.c1.y),
a.moveTo(this.c2.x,this.c2.y),a.lineTo(this.p2.x,this.p2.y)):(a.lineTo(this.c1.x+d.x,this.c1.y+d.y),a.moveTo(this.c2.x+d.x,this.c2.y+d.y),a.lineTo(this.p2.x+d.x,this.p2.y+d.y));this.p1.draw(a,b,d);this.p2.draw(a,b,d);this.c1.draw(a,b,d);this.c2.draw(a,b,d)};c.drawTo=function(a,b){null==b?a.bezierCurveTo(this.c1.x,this.c1.y,this.c2.x,this.c2.y,this.p2.x,this.p2.y):a.bezierCurveTo(this.c1.x+b.x,this.c1.y+b.y,this.c2.x+b.x,this.c2.y+b.y,this.p2.x+b.x,this.p2.y+b.y)};c.drawToReverse=function(a,b){null==
b?a.bezierCurveTo(this.c2.x,this.c2.y,this.c1.x,this.c1.y,this.p1.x,this.p1.y):a.bezierCurveTo(this.c2.x+b.x,this.c2.y+b.y,this.c1.x+b.x,this.c1.y+b.y,this.p1.x+b.x,this.p1.y+b.y)};c.getBoundingRect=function(){var a=this.p1.getMin(this.p2).min(this.c1).min(this.c2),b=this.p1.getMax(this.p2).max(this.c1).max(this.c2).minus(a);return new qlib.Rectangle(a.x,a.y,b.x,b.y)};c.getSplitAtT=function(a,b){null==b&&(b=!0);var d=[];0!=a&&1!=a||d.push(b?this.clone():this);if(0>=a||1<=a)return d;var h=this.p1.x+
a*(this.c1.x-this.p1.x),g=this.p1.y+a*(this.c1.y-this.p1.y),e=this.c1.x+a*(this.c2.x-this.c1.x),c=this.c1.y+a*(this.c2.y-this.c1.y),f=this.c2.x+a*(this.p2.x-this.c2.x),k=this.c2.y+a*(this.p2.y-this.c2.y),l=h+a*(e-h),m=g+a*(c-g),e=e+a*(f-e),c=c+a*(k-c),r=new qlib.Vector2(l+a*(e-l),m+a*(c-m));d.push(new qlib.Bezier3(b?this.p1.clone():this.p1,new qlib.Vector2(h,g),new qlib.Vector2(l,m),r));d.push(new qlib.Bezier3(b?r.clone():r,new qlib.Vector2(e,c),new qlib.Vector2(f,k),b?this.p2.clone():this.p2));return d};
c.getClosestPoint=function(a){for(var b=[],d=this.convertToBezierForm(a),d=this.findRoots(d,b,0),h=a.squaredDistanceToVector(this.p1),g,e=this.p1,c,f=0;f<d;f++)g=this.getPoint(b[f]),c=a.squaredDistanceToVector(g),c<h&&(h=c,e=g);c=a.squaredDistanceToVector(this.p2);c<h&&(e=this.p2);return e};c.getClosestT=function(a){for(var b=[],d=this.convertToBezierForm(a),d=this.findRoots(d,b,0),h=a.squaredDistanceToVector(this.p1),g,e=0,c=0;c<d;c++)g=this.getPoint(b[c]),g=a.squaredDistanceToVector(g),g<h&&(h=
g,e=b[c]);g=a.squaredDistanceToVector(this.p2);g<h&&(e=1);return e};c.convertToBezierForm=function(a){var b,d,h;b=[];h=[];var g=[[],[],[]],e=[];b.push(this.p1.getMinus(a));b.push(this.c1.getMinus(a));b.push(this.c2.getMinus(a));b.push(this.p2.getMinus(a));h.push(this.c1.getMinus(this.p1).multiply(3));h.push(this.c2.getMinus(this.c1).multiply(3));h.push(this.p2.getMinus(this.c2).multiply(3));for(a=0;2>=a;a++)for(d=0;3>=d;d++)g[a][d]=h[a].dot(b[d]);for(a=0;5>=a;a++)e[a]=new qlib.Vector2(a/5,0);for(h=
0;5>=h;h++)for(a=Math.max(0,h-2),b=Math.min(h,3);a<=b;a++)d=h-a,e[a+d].y+=g[d][a]*f.cubicZ[d][a];return e};c.findRoots=function(a,b,d){switch(this.crossingCount(a,5)){case 0:return 0;case 1:if(d>=f.MAXDEPTH)return b[0]=(a[0].x+a[5].x)/2,1;if(this.controlPolygonFlatEnough(a,5))return b[0]=this.computeXIntercept(a,5),1}var h=[],g=[],e=[],c=[],u=[[],[],[],[],[],[]],k;for(k=0;5>=k;k++)u[0][k]=new qlib.Vector2(a[k]);for(a=1;5>=a;a++)for(k=0;k<=5-a;k++)u[a][k]=new qlib.Vector2(.5*u[a-1][k].x+.5*u[a-1][k+
1].x,.5*u[a-1][k].y+.5*u[a-1][k+1].y);if(null!=h)for(k=0;5>=k;k++)h[k]=u[k][0];if(null!=g)for(k=0;5>=k;k++)g[k]=u[5-k][k];h=this.findRoots(h,e,d+1);d=this.findRoots(g,c,d+1);for(a=0;a<h;a++)b[a]=e[a];for(a=0;a<d;a++)b[a+h]=c[a];return h+d};c.crossingCount=function(a,b){for(var d=0,h=0>a[0].y?-1:1,g=h,e=1;e<=b;e++)h=0>a[e].y?-1:1,h!=g&&d++,g=h;return d};c.computeXIntercept=function(a,b){var d=a[b].y-a[0].y;return-1/d*((a[b].x-a[0].x)*a[0].y-d*a[0].x)};c.controlPolygonFlatEnough=function(a,b){for(var d=
a[0].y-a[b].y,h=a[b].x-a[0].x,g=a[0].x*a[b].y-a[b].x*a[0].y,e=0,c=0,u=1;u<b;u++){var k=d*a[u].x+h*a[u].y+g;k>e?e=k:k<c&&(c=k)}d=-1/d;e=(g+e)*d;g=(g+c)*d;c=Math.min(e,g);return.5*(Math.max(e,g)-c)<f.EPSILON};c.toString=function(){return"Bezier3"};qlib.Bezier3=f})();window.qlib=window.qlib||{};
(function(){var f=function(){this.initialize(arguments)},c=f.prototype=new qlib.GeometricShape;c.type="Circle";c.initialize=function(a){this.drawingSegments=6;this.endAngle=this.startAngle=0;"number"==typeof a[0]?(this.c=new qlib.Vector2(a[0],a[1]),this.r=null==a[2]?0:a[2]):(this.c=a[0],this.r=null==a[1]?0:a[1])};c.translate=function(a){this.c.plus(a);return this};c.scale=function(a,b){null==b&&(b=this.c.getClone());this.c.minus(b).multiply(a).plus(b);this.r*=a;return this};c.rotate=function(a,b){null==
b&&(b=this.c.getClone());this.c.rotateAround(a,b);return this};c.touches=function(a){return 1E-7>Math.abs(this.c.distanceToVector(a.c)-(this.r+a.r))};c.clone=function(a){return!0==a?new f(this.x,this.y,this.r):new f(this.c,this.r)};c.draw=function(a){if(!(isNaN(this.r)||0>this.r)){var b,d,h,g,e=this.startAngle;h=this.endAngle;g=this.drawingSegments;var c=Math.PI/180;if(e==h)a.moveTo(this.c.x+this.r,this.c.y),a.drawCircle(this.c.x,this.c.y,this.r);else{e>h&&(e-=360);b=this.r*Math.cos(e*c)+this.c.x;
d=this.r*Math.sin(e*c)+this.c.y;h-=e;g=h/g;a.moveTo(this.c.x,this.c.y);a.lineTo(b,d);for(var f=g+e;f<h+.1+e;f+=g){var k=this.r*Math.cos((f-g/2)*c)+this.c.x,l=this.r*Math.sin((f-g/2)*c)+this.c.y,m=this.r*Math.cos(f*c)+this.c.x,r=this.r*Math.sin(f*c)+this.c.y;a.curveTo(2*k-.5*(b+m),2*l-.5*(d+r),m,r);b=m;d=r}360!=h&&a.lineTo(this.c.x,this.c.y)}}};c.getBoundingRect=function(){return new qlib.Rectangle(this.c.x-this.r,this.c.y-this.r,2*this.r,2*this.r)};c.isInside=function(a,b){return null==b||b?a.squaredDistanceToVector(this.c)<=
this.r*this.r:a.squaredDistanceToVector(this.c)<this.r*this.r};c.circleIsInsideOrIntersects=function(a){return a.c.squaredDistanceToVector(this.c)<(a.r+this.r)*(a.r+this.r)};c.inversionPointFromPole=function(a,b){var d=this.c.getProject(a,b);return this.containsPoint(d)?d:this.inversionPoint(d)};c.toMixedPath=function(a){null==a&&(a=4);var b=2.2091389992/a*this.r,d=2*Math.PI/a,h=new qlib.Vector2(0,this.r),g=new qlib.Vector2(b,this.r),e=new qlib.Vector2(0,this.r),b=new qlib.Vector2(-b,this.r);e.rotateBy(-d);
b.rotateBy(-d);var c=new qlib.MixedPath;c.addPoint(h.getPlus(this.c));c.addControlPoint(g.getPlus(this.c));c.addControlPoint(b.getPlus(this.c));c.addPoint(e.getPlus(this.c));for(h=1;h<a;h++)e.rotateBy(-d),b.rotateBy(-d),g.rotateBy(-d),c.addControlPoint(g.getPlus(this.c)),c.addControlPoint(b.getPlus(this.c)),c.addPoint(e.getPlus(this.c));c.deletePointAt(c.pointCount-1);c.closed=!0;return c};c.inversionPoint=function(a){var b=this.c.distanceToVector(a);a=this.c.getAngleTo(a);b=this.r*this.r/b;return new qlib.Vector2(this.c.x+
Math.cos(a)*b,this.c.y+Math.sin(a)*b)};c.containsPoint=function(a){return this.c.squaredDistanceToVector(a)<this.r*this.r};c.toString=function(){return"[Circle (c="+this.c.toString()+" r="+this.r+")]"};qlib.Circle=f})();window.qlib=window.qlib||{};
(function(){var f=function(){};f.getTangentCircle=function(c,a,b,d){d=null==d?!0:d;c=new qlib.Circle(c.c,c.r+b);a=new qlib.Circle(a.c,a.r+b);a=c.intersect(a);return a.status==qlib.Intersection.INTERSECTION?new qlib.Circle(a.points[d?0:1],b):null};f.getTangentCircles=function(c,a,b){c=new qlib.Circle(c.c,c.r+b);a=new qlib.Circle(a.c,a.r+b);a=c.intersect(a);return a.status==qlib.Intersection.INTERSECTION?[new qlib.Circle(a.points[0],b),new qlib.Circle(a.points[1],b)]:null};f.getSoddyCircles=function(c,
a,b){var d=c.r,h=a.r,g=b.r,d=d*h*g/(d*h+d*g+h*g+2*Math.sqrt(d*h*g*(d+h+g))),h=new qlib.Circle(c.c,c.r+d),g=new qlib.Circle(a.c,a.r+d),h=h.intersect(g);if(h.status==qlib.Intersection.INTERSECTION)h=h.points[b.c.squaredDistanceToVector(h.points[0])<b.c.squaredDistanceToVector(h.points[1])?0:1];else return null;d=new qlib.Circle(h,d);g=new qlib.LineSegment(a.c,b.c);h=g.getClosestPointOnLine(c.c);h=new qlib.LineSegment(c.c,h);h.p2_end=!1;h=h.intersect(c).points[0];g=g.intersect(a).points[0];g=new qlib.LineSegment(g,
h);g.p2_end=!1;var g=g.intersect(c),h=g.points[h.snaps(g.points[0])?1:0],e=new qlib.LineSegment(c.c,b.c),g=e.getClosestPointOnLine(a.c),g=new qlib.LineSegment(a.c,g);g.p2_end=!1;g=g.intersect(a).points[0];e=e.intersect(c).points[0];e=new qlib.LineSegment(e,g);e.p2_end=!1;e=e.intersect(a);g=e.points[g.snaps(e.points[0])?1:0];e=new qlib.LineSegment(c.c,a.c);a=e.getClosestPointOnLine(b.c);a=new qlib.LineSegment(b.c,a);a.p2_end=!1;a=a.intersect(b).points[0];c=e.intersect(c).points[0];c=new qlib.LineSegment(c,
a);c.p2_end=!1;b=c.intersect(b);b=b.points[a.snaps(b.points[0])?1:0];return[d,f.from3Points(h,g,b)]};f.from3Points=function(c,a,b){var d=[1];d[1]=-2*c.x;d[2]=-2*c.y;d[3]=-c.x*c.x-c.y*c.y;d[4]=1;d[5]=-2*a.x;d[6]=-2*a.y;d[7]=-a.x*a.x-a.y*a.y;d[8]=1;d[9]=-2*b.x;d[10]=-2*b.y;d[11]=-b.x*b.x-b.y*b.y;qlib.MathUtils.GLSL(d);return new qlib.Circle(d[7],d[11],Math.sqrt(d[7]*d[7]+d[11]*d[11]-d[3]))};f.getRingByCount=function(c,a,b,d){2>a&&(a=2);b=null==b?0:b;(d=null==d?!0:d)&&3>a&&(a=3);var h=[];d=d?1:-1;var g=
Math.sin(2*Math.PI/(2*a));if(1!=g)for(var g=c.r*g/(1-g*d),e=2*Math.PI/a,p=0;p<a;p++)h.push(new qlib.Circle(c.c.getAddCartesian(b+p*e,c.r+g*d),g));return h};f.areKissingCircles=function(c,a,b){return c.touches(a)&&c.touches(b)&&a.touches(b)};f.apolloniusCircles=function(c,a,b){var d,h=[];d=this.homotheticCenters(c,a);null!=d&&h.push(d[0],d[1]);d=this.homotheticCenters(a,b);null!=d&&h.push(d[0],d[1]);d=this.homotheticCenters(b,c);null!=d&&h.push(d[0],d[1]);if(6!=h.length)return null;for(var g,e,p,f=
0,k=this.radicalCenter(c,a,b),l=[],m=[],r=[],q=[h[1],h[2],h[2],h[5],h[3],h[4],h[1],h[3]],h=0;h<q.length;h+=2)d=c.inversionPointFromPole(q[h],q[h+1]),d=qlib.IntersectionUtils.lineCircleIntersection(d,k,c),null!=d&&(1==d.length?(l.push(d[0]),m.push(d[0])):(p=k.distanceToVector(d[0]),f=k.distanceToVector(d[1]),l.push(p<f?d[0]:d[1]),m.push(p>=f?d[0]:d[1]))),d=a.inversionPointFromPole(q[h],q[h+1]),d=qlib.IntersectionUtils.lineCircleIntersection(d,k,a),null!=d&&(1==d.length?(l.push(d[0]),m.push(d[0])):
(p=k.distanceToVector(d[0]),f=k.distanceToVector(d[1]),l.push(p<f?d[0]:d[1]),m.push(p>=f?d[0]:d[1]))),d=b.inversionPointFromPole(q[h],q[h+1]),d=qlib.IntersectionUtils.lineCircleIntersection(d,k,b),null!=d&&(1==d.length?(l.push(d[0]),m.push(d[0])):(p=k.distanceToVector(d[0]),f=k.distanceToVector(d[1]),l.push(p<f?d[0]:d[1]),m.push(p>=f?d[0]:d[1])));for(h=0;h<l.length;h+=3){switch(h/3|0){case 0:g=new qlib.Triangle(l[h],l[h+1],m[h+2]);e=new qlib.Triangle(m[h],m[h+1],l[h+2]);break;case 1:g=new qlib.Triangle(l[h],
m[h+1],l[h+2]);e=new qlib.Triangle(m[h],l[h+1],m[h+2]);break;case 2:g=new qlib.Triangle(l[h],m[h+1],m[h+2]);e=new qlib.Triangle(m[h],l[h+1],l[h+2]);break;case 3:g=new qlib.Triangle(l[h],l[h+1],l[h+2]),e=new qlib.Triangle(m[h],m[h+1],m[h+2])}c=g.getBoundingCircle();null!=c&&r.push(c);c=e.getBoundingCircle();null!=c&&r.push(c)}return r};f.homotheticCenters=function(c,a){var b=c.c.getAngleTo(a.c)+.5*Math.PI,d=c.c.getAddCartesian(b,c.r),h=a.c.getAddCartesian(b,a.r),g=qlib.IntersectionUtils.lineIntersectLine(c.c,
a.c,d,h,!1,!1),d=c.c.getAddCartesian(b,-c.r),b=qlib.IntersectionUtils.lineIntersectLine(c.c,a.c,d,h,!1,!1);return null==b||null==g?null:[b,g]};f.radicalLine=function(c,a,b){b=null==b?-1:b;var d=c.r,h=a.r,g=c.c.distanceToVector(a.c);a=c.c.getAngleTo(a.c);d=(g*g+d*d-h*h)/(2*g);0>b&&(b=d);c=new qlib.Vector2(c.c.x+Math.cos(a)*d,c.c.y+Math.sin(a)*d);return[new qlib.Vector2(c.x+Math.cos(a+Math.PI/2)*b,c.y+Math.sin(a+Math.PI/2)*b),new qlib.Vector2(c.x+Math.cos(a-Math.PI/2)*b,c.y+Math.sin(a-Math.PI/2)*b)]};
f.radicalCenter=function(c,a,b){a=this.radicalLine(c,a);c=this.radicalLine(c,b);return qlib.IntersectionUtils.lineIntersectLine(a[0],a[1],c[0],c[1],!1,!1)};qlib.CircleUtils=f})();window.qlib=window.qlib||{};
(function(){var f=function(){this.points=[];this.dirty=!1;this.centroid=new qlib.Vector2};f.fromArray=function(a){for(var b=new qlib.ConvexPolygon,d=0;d<a.length;d++)b.points.push(a[d]);b.updateConvexHull();return b};var c=f.prototype=new qlib.GeometricShape;c.type="ConvexPolygon";c.updateConvexHull=function(){this.dirty=!1;var a=this.points;a.sort(this.vectorSort);if(!(3>a.length)){var b=a.length,d=[],h=0,g=-1,e,c,f,k,l;c=a[0].x;for(e=1;e<b&&a[e].x==c;e++);c=e-1;if(c==b-1)b=a[0],d[++g]=b,a[c].y!=
b.y&&(d[++g]=a[c]),d[++g]=b;else{var m,h=b-1;f=a[b-1].x;for(e=b-2;0<=e&&a[e].x==f;e--);m=e+1;d[++g]=a[0];e=c;f=a[0];for(k=a[m];++e<=m;)if(b=a[e],!(0<=b.isLeft(f,k)&&e<m)){for(;0<g&&!(0<b.isLeft(d[g-1],d[g]));)g--;d[++g]=b}k=a[h];l=a[c];h!=m&&(d[++g]=k);h=g;for(e=m;--e>=c;)if(b=a[e],!(0<=b.isLeft(k,l)&&e>c)){for(;g>h&&!(0<b.isLeft(d[g-1],d[g]));)g--;d[++g]=b}0!=c&&(d[++g]=f);this.points=d.slice(0,g);this.updateBoundingRect()}}};c.vectorSort=function(a,b){if(a.x<b.x)return-1;if(a.x>b.x)return 1;if(a.x==
b.x){if(a.y<b.y)return-1;if(a.y>b.y)return 1}return 0};c.updateBoundingRect=function(){for(var a=this.points,b=a[0],d=b.x,h=d,g=b.y,e=g,c=1;c<a.length;c++)b=a[c],b.x<d?d=b.x:b.x>h&&(h=b.x),b.y<g?g=b.y:b.y>e&&(e=b.y);this._boundingRect=new qlib.Rectangle(d,g,h-d,e-g)};c.rotate=function(a,b){null==b&&(b=this.getCentroid());var d=this.points,h;for(h in d)d[h].rotateAround(a,b);this.dirty=!0;return this};c.scale=function(a,b,d){null==d&&(d=this.getCentroid());var h=this.points,g;for(g in h)h[g].minus(d).multiplyXY(a,
b).plus(d);this.dirty=!0;return this};c.translate=function(a){var b=this.points,d;for(d in b)b[d].plus(a);this.dirty=!0;return this};c.getCentroid=function(){if(this.dirty){this.updateConvexHull();for(var a=0,b=0,d=0,h,g,e,c=this.points,f=0;f<c.length;f++)h=c[f],g=c[(f+1)%c.length],d+=e=h.x*g.y-g.x*h.y,a+=(h.x+g.x)*e,b+=(h.y+g.y)*e;e=0!=d?1/(3*d):0;this.centroid.x=a*e;this.centroid.y=b*e}return this.centroid};c.draw=function(a){this.dirty&&this.updateConvexHull();var b=this.points;if(0<b.length){a.moveTo(b[b.length-
1].x,b[b.length-1].y);for(var d=0;d<b.length;d++)a.lineTo(b[d].x,b[d].y)}};qlib.ConvexPolygon=f})();window.qlib=window.qlib||{};
(function(){var f=function(a,b,d,h){this.initialize(a,b,d,h)},c=f.prototype;c.type="CoonsPatch";c.initialize=function(a,b,d,h){this.bound_top=a;this.bound_right=b;this.bound_bottom=d;this.bound_left=h};c.getMesh=function(a,b){for(var d=1/(a-1),h=1/(b-1),g=[],e=this.bound_bottom.getPoint(0),c=this.bound_top.getPoint(1),f=this.bound_top.getPoint(0),k=this.bound_bottom.getPoint(1),l=e.x,e=e.y,m=k.x,k=k.y,r=f.x,f=f.y,q=c.x,c=c.y,n,w,B,D,s,t,x,A=0,C=0;C<b;C+=1){B=1-A;t=this.bound_left.getPoint(A);x=this.bound_right.getPoint(B);
for(var A=A+h,F=n=0;F<a;F+=1)w=1-n,D=this.bound_bottom.getPoint(n),s=this.bound_top.getPoint(n),g.push(new qlib.Vector2(A*D.x+B*s.x+w*t.x+n*x.x-w*A*l-n*A*m-w*B*r-n*B*q,A*D.y+B*s.y+w*t.y+n*x.y-w*A*e-n*A*k-w*B*f-n*B*c)),n+=d}return g};c.getHeightMesh=function(a,b,d){var h=1/(a-1),g=1/(b-1),e=[],c=this.bound_bottom,f=this.bound_top,k=this.bound_left,l=this.bound_right,m=c.getPoint(0),r=f.getPoint(1),q=f.getPoint(0),n=c.getPoint(1),w=m.x,m=m.y,B=n.x,n=n.y,D=q.x,q=q.y,s=r.x,r=r.y,t=new qlib.LineSegment(d[0],
d[1]),x=new qlib.LineSegment(d[0],d[3]),A=new qlib.LineSegment(d[2],d[1]);d=new qlib.LineSegment(d[3],d[2]);for(var C,F,G,E,I,H,L,z,J,y,K,M=0,N=0;N<b;N+=1){G=1-M;H=k.getPoint(M);L=l.getPoint(G);y=x.getPoint(M);K=A.getPoint(G);for(var M=M+g,O=C=0;O<a;O+=1)F=1-C,E=c.getPoint(C),I=f.getPoint(C),z=d.getPoint(C),J=t.getPoint(C),e.push(M*E.x+G*I.x+F*H.x+C*L.x-F*M*w-C*M*B-F*G*D-C*G*s-(M*z.x+G*J.x+F*y.x+C*K.x-F*M*w-C*M*B-F*G*D-C*G*s)+(M*E.y+G*I.y+F*H.y+C*L.y-F*M*m-C*M*n-F*G*q-C*G*r-(M*z.y+G*J.y+F*y.y+C*K.y-
F*M*m-C*M*n-F*G*q-C*G*r))),C+=h}return{cols:a,rows:b,heights:e}};c.getPoint=function(a,b){var d=1-a,h=1-b,g=this.bound_bottom.getPoint(0),e=this.bound_top.getPoint(1),c=this.bound_top.getPoint(0),f=this.bound_bottom.getPoint(1),k=this.bound_bottom.getPoint(a),l=this.bound_top.getPoint(a),m=this.bound_left.getPoint(h),r=this.bound_right.getPoint(b);return new qlib.Vector2(h*k.x+b*l.x+d*m.x+a*r.x-d*h*g.x-a*h*f.x-d*b*c.x-a*b*e.x,h*k.y+b*l.y+d*m.y+a*r.y-d*h*g.y-a*h*f.y-d*b*c.y-a*b*e.y)};c.toString=function(){return"CoonsPatch"};
qlib.CoonsPatch=f})();window.qlib=window.qlib||{};
(function(){var f=function(a,b,d,h){this.initialize(a,b,d,h)},c=f.prototype;c.type="FunctionPatch";c.initialize=function(a,b,d,h){this.function_top=a;this.function_right=b;this.function_bottom=d;this.function_left=h;if(a(0)instanceof Array){if(a(0).length!=b(0).length||d(0).length!=h(0).length||a(0).length!=h(0).length)throw"FunctionPatch: provided boundary functions return arrays of different length!";this.getMesh=this._getMeshAsArray}};c.getMesh=function(a,b){for(var d=1/(a-1),h=1/(b-1),g=[],e=
.5*(this.function_top(0)+this.function_left(0)),c=.5*(this.function_bottom(1)+this.function_right(1)),f=.5*(this.function_top(1)+this.function_right(0)),k=.5*(this.function_bottom(0)+this.function_left(1)),l,m,r,q,n,w,B,D=0,s=0;s<b;s+=1){r=1-D;w=this.function_left(D);B=this.function_right(D);for(var D=D+h,t=l=0;t<a;t+=1)m=1-l,q=this.function_top(l),n=this.function_bottom(l),g.push(r*q+D*n+m*w+l*B-m*r*e-m*D*k-l*r*f-l*D*c),l+=d}return{cols:a,rows:b,values:g}};c._getMeshAsArray=function(a,b){for(var d=
1/(a-1),h=1/(b-1),g=[],e=this.function_top,c=this.function_bottom,f=this.function_left,k=this.function_right,l=e(0),m=e(1),r=f(0),q=f(1),n=c(0),w=c(1),B=k(0),D=k(1),s=l.length,l=[.5*(l[0]+r[0]),.5*(l[1]+r[1]),.5*(l[2]+r[2])],w=[.5*(w[0]+D[0]),.5*(w[1]+D[1]),.5*(w[2]+D[2])],m=[.5*(m[0]+B[0]),.5*(m[1]+B[1]),.5*(m[2]+B[2])],q=[.5*(n[0]+q[0]),.5*(n[1]+q[1]),.5*(n[2]+q[2])],t,x,A,C=0,F=0;F<b;F+=1){D=1-C;x=f(C);A=k(C);for(var C=C+h,G=n=0;G<a;G+=1){B=1-n;r=e(n);t=c(n);for(var E=[],I=0;I<s;I++)E[I]=D*r[I]+
C*t[I]+B*x[I]+n*A[I]-B*D*l[I]-B*C*q[I]-n*D*m[I]-n*C*w[I];g.push(E);n+=d}}return{cols:a,rows:b,values:g}};c.getPoint=function(a,b){var d=1-a,h=1-b,g=.5*(this.function_top(0)+this.function_left(0)),e=.5*(this.function_bottom(1)+this.function_right(1)),c=.5*(this.function_top(1)+this.function_right(0)),f=.5*(this.function_bottom(0)+this.function_left(1)),k=this.function_top(a),l=this.function_bottom(a),m=this.function_left(b),r=this.function_right(b);return h*k+b*l+d*m+a*r-d*h*g-a*h*f-d*b*c-a*b*e};c.toString=
function(){return"FunctionPatch"};qlib.FunctionPatch=f})();window.qlib=window.qlib||{};
(function(){var f=function(){this.status=qlib.Intersection.NO_INTERSECTION;this.points=[]};f.SQUARED_SNAP_DISTANCE=1E-15;f.INTERSECTION="INTERSECTION";f.NO_INTERSECTION="NO INTERSECTION";f.COINCIDENT="COINCIDENT";f.PARALLEL="PARALLEL";f.INSIDE="INSIDE";f.OUTSIDE="OUTSIDE";f.TANGENT="TANGENT";f.intersect=function(a,b){switch(a.type+b.type){case "CircleCircle":return(new qlib.Intersection).circle_circle(a,b);case "Bezier2Bezier2":return(new qlib.Intersection).bezier2_bezier2(a,b);case "Bezier2LineSegment":return(new qlib.Intersection).bezier2_line(a,
b);case "LineSegmentBezier2":return(new qlib.Intersection).bezier2_line(b,a);case "Bezier2Ellipse":return(new qlib.Intersection).bezier2_ellipse(a,b);case "EllipseBezier2":return(new qlib.Intersection).bezier2_ellipse(b,a);case "LineSegmentLineSegment":return(new qlib.Intersection).line_line(a,b);case "EllipseLineSegment":return(new qlib.Intersection).ellipse_line(a,b);case "LineSegmentEllipse":return(new qlib.Intersection).ellipse_line(b,a);case "EllipseEllipse":return(new qlib.Intersection).ellipse_ellipse(a,
b);case "CircleLineSegment":return(new qlib.Intersection).circle_line(a,b);case "LineSegmentCircle":return(new qlib.Intersection).circle_line(b,a);case "Bezier2Bezier3":return(new qlib.Intersection).bezier2_bezier3(a,b);case "Bezier3Bezier2":return(new qlib.Intersection).bezier2_bezier3(b,a);case "Bezier3Bezier3":return(new qlib.Intersection).bezier3_bezier3(b,a);case "Bezier3LineSegment":return(new qlib.Intersection).bezier3_line(a,b);case "LineSegmentBezier3":return(new qlib.Intersection).bezier3_line(b,
a);case "TriangleLineSegment":return(new qlib.Intersection).line_triangle(b,a);case "LineSegmentTriangle":return(new qlib.Intersection).line_triangle(a,b);case "PolygonLineSegment":return(new qlib.Intersection).line_polygon(b,a);case "LineSegmentPolygon":return(new qlib.Intersection).line_polygon(a,b);case "ConvexPolygonLineSegment":return(new qlib.Intersection).line_convexPolygon(b,a);case "ConvexPolygonConvexPolygon":return(new qlib.Intersection).convexPolygon_convexPolygon(b,a);case "LineSegmentConvexPolygon":return(new qlib.Intersection).line_convexPolygon(a,
b);case "LineSegmentMixedPath":return(new qlib.Intersection).line_mixedPath(a,b);case "MixedPathLineSegment":return(new qlib.Intersection).line_mixedPath(b,a);case "LineSegmentLinearPath":return(new qlib.Intersection).line_linearPath(a,b);case "LinearPathLineSegment":return(new qlib.Intersection).line_linearPath(b,a);case "Bezier2MixedPath":return(new qlib.Intersection).bezier2_mixedPath(a,b);case "MixedPathBezier2":return(new qlib.Intersection).bezier2_mixedPath(b,a);case "Bezier3MixedPath":return(new qlib.Intersection).bezier3_mixedPath(a,
b);case "MixedPathBezier3":return(new qlib.Intersection).bezier3_mixedPath(b,a);case "PolygonPolygon":return(new qlib.Intersection).polygon_polygon(b,a);case "ConvexPolygonPolygon":return(new qlib.Intersection).convexPolygon_polygon(a,b);case "PolygonConvexPolygon":return(new qlib.Intersection).convexPolygon_polygon(b,a);case "CompoundShapeLineSegment":return(new qlib.Intersection).compoundShape_line(a,b);case "LineSegmentCompoundShape":return(new qlib.Intersection).compoundShape_line(b,a);case "CompoundShapeTriangle":return(new qlib.Intersection).compoundShape_triangle(a,
b);case "TriangleCompoundShape":return(new qlib.Intersection).compoundShape_triangle(b,a);case "CompoundShapePolygon":return(new qlib.Intersection).compoundShape_polygon(a,b);case "PolygonCompoundShape":return(new qlib.Intersection).compoundShape_polygon(b,a);case "CompoundShapeCompoundShape":return(new qlib.Intersection).compoundShape_compoundShape(a,b);case "GeometricCompositeLineSegment":return(new qlib.Intersection).geometricComposite_line(a,b);case "LineSegmentGeometricComposite":return(new qlib.Intersection).geometricComposite_line(b,
a);case "PolygonTriangle":return(new qlib.Intersection).polygon_triangle(a,b);case "TrianglePolygon":return(new qlib.Intersection).polygon_triangle(b,a);case "ConvexPolygonCircle":return(new qlib.Intersection).circle_convexPolygon(b,a);case "CircleConvexPolygon":return(new qlib.Intersection).circle_convexPolygon(a,b);case "PolygonCircle":return(new qlib.Intersection).circle_polygon(b,a);case "CirclePolygon":return(new qlib.Intersection).circle_polygon(a,b)}return null};var c=f.prototype;c.appendPoint=
function(a){for(var b=this.points.length;-1<--b;)if(this.points[b].squaredDistanceToVector(a)<f.SQUARED_SNAP_DISTANCE)return;this.points.push(a)};c.circle_line=function(a,b){var d=(b.p2.x-b.p1.x)*(b.p2.x-b.p1.x)+(b.p2.y-b.p1.y)*(b.p2.y-b.p1.y),h=2*((b.p2.x-b.p1.x)*(b.p1.x-a.c.x)+(b.p2.y-b.p1.y)*(b.p1.y-a.c.y)),g=h*h-4*d*(a.c.x*a.c.x+a.c.y*a.c.y+b.p1.x*b.p1.x+b.p1.y*b.p1.y-2*(a.c.x*b.p1.x+a.c.y*b.p1.y)-a.r*a.r);if(0>g)status=qlib.Intersection.OUTSIDE;else if(0==g)status=qlib.Intersection.TANGENT;else{var e=
Math.sqrt(g),g=(-h+e)/(2*d),d=(-h-e)/(2*d);(0>g&&b.p1_end||1<g&&b.p2_end)&&(0>d&&b.p1_end||1<d&&b.p2_end)?status=0>g&&0>d||1<g&&1<d?qlib.Intersection.OUTSIDE:qlib.Intersection.INSIDE:(status=qlib.Intersection.INTERSECTION,(0<=g||!b.p1_end)&&(1>=g||!b.p2_end)&&this.appendPoint(b.p1.getLerp(b.p2,g)),(0<=d||!b.p1_end)&&(1>=d||!b.p2_end)&&this.appendPoint(b.p1.getLerp(b.p2,d)))}return this};c.circle_circle=function(a,b){var d=a.r+b.r,h=Math.abs(a.r-b.r),g=a.c.distanceToVector(b.c);0==g&&0==h?this.status=
qlib.Intersection.COINCIDENT:g>d?this.status=qlib.Intersection.OUTSIDE:g<h?this.status=qlib.Intersection.INSIDE:(this.status=qlib.Intersection.INTERSECTION,h=(a.r*a.r-b.r*b.r+g*g)/(2*g),h>a.r&&(h=a.r),d=Math.sqrt(a.r*a.r-h*h),h=a.c.getLerp(b.c,h/g),g=d/g,this.appendPoint(new qlib.Vector2(h.x-g*(b.c.y-a.c.y),h.y+g*(b.c.x-a.c.x))),this.appendPoint(new qlib.Vector2(h.x+g*(b.c.y-a.c.y),h.y-g*(b.c.x-a.c.x))));return this};c.bezier2_bezier2=function(a,b){var d=a.p1,h=a.c,g=a.p2,e=b.p1,c=b.c,f=b.p2,k,l;
k=h.getMultiply(-2);g=d.getPlus(k.getPlus(g));k=d.getMultiply(-2);l=h.getMultiply(2);h=k.getPlus(l);d=new qlib.Vector2(d.x,d.y);k=c.getMultiply(-2);f=e.getPlus(k.getPlus(f));k=e.getMultiply(-2);l=c.getMultiply(2);c=k.getPlus(l);e=new qlib.Vector2(e.x,e.y);k=g.x*h.y-h.x*g.y;l=f.x*g.y-g.x*f.y;var m=c.x*g.y-g.x*c.y,r=g.x*(d.y-e.y)+g.y*(-d.x+e.x);k=(new qlib.Polynomial([-l*l,-2*l*m,k*(f.x*h.y-h.x*f.y)-m*m-2*l*r,k*(c.x*h.y-h.x*c.y)-2*m*r,k*(h.x*(d.y-e.y)+h.y*(-d.x+e.x))-r*r])).getRoots();for(l=0;l<k.length;l++)if(m=
k[l],0<=m&&1>=m){var r=(new qlib.Polynomial([-g.x,-h.x,-d.x+e.x+m*c.x+m*m*f.x])).getRoots(),q=(new qlib.Polynomial([-g.y,-h.y,-d.y+e.y+m*c.y+m*m*f.y])).getRoots();if(0<r.length&&0<q.length){var n=0;a:for(;n<r.length;n++){var w=r[n];if(0<=w&&1>=w)for(var B=0;B<q.length;B++)if(1E-4>Math.abs(w-q[B])){this.appendPoint(f.getMultiply(m*m).plus(c.getMultiply(m).plus(e)));break a}}}}0<this.points.length&&(this.status=qlib.Intersection.INTERSECTION);return this};c.bezier2_bezier3=function(a,b){return this.bezier3_bezier3(new qlib.Bezier3(a.p1,
a.c,a.c,a.p2),b)};c.bezier3_bezier3=function(a,b){var d=a.p1,h=a.c1,g=a.c2,e=a.p2,c=b.p1,f=b.c1,k=b.c2,l=b.p2,m,r,q,n,w,B,D,s,t,x;m=-d.x;r=3*h.x;q=-3*g.x;n=m+r+q+e.x;B=-d.y;D=3*h.y;m=-3*g.y;s=B+D+m+e.y;m=3*d.x;r=-6*h.x;q=3*g.x;e=m+r+q;B=3*d.y;D=-6*h.y;m=3*g.y;t=B+D+m;m=-3*d.x;r=3*h.x;g=m+r;w=d.x;B=-3*d.y;D=3*h.y;h=B+D;x=d.y;m=-c.x;r=3*f.x;q=-3*k.x;d=m+r+q+l.x;B=-c.y;D=3*f.y;m=-3*k.y;l=B+D+m+l.y;m=3*c.x;r=-6*f.x;q=3*k.x;q=m+r+q;B=3*c.y;D=-6*f.y;m=3*k.y;k=B+D+m;m=-3*c.x;r=3*f.x;m+=r;r=c.x;B=-3*c.y;
D=3*f.y;f=B+D;c=c.y;B=w*w;D=x*x;var A=g*g,C=g*g*g,F=h*h,G=h*h*h,E=e*e,I=e*e*e,H=t*t,L=t*t*t,z=n*n,J=n*n*n,y=s*s,K=s*s*s,M=r*r,N=c*c,O=m*m,P=f*f,R=q*q,Q=k*k,S=d*d,T=l*l;B=(new qlib.Polynomial([-J*l*l*l+K*d*d*d-3*n*y*S*l+3*z*s*d*T,-6*n*q*y*d*l+6*z*s*k*d*l+3*q*K*S-3*J*k*T-3*n*y*k*S+3*z*q*s*T,-6*m*n*y*d*l-6*n*q*y*k*d+6*z*q*s*k*l+3*m*K*S+3*R*K*d+3*m*z*s*T-3*n*f*y*S-3*n*R*y*l+z*s*d*(6*f*l+3*Q)+J*(-f*T-2*Q*l-l*(2*f*l+Q)),g*t*n*s*d*l-h*e*n*s*d*l+6*m*q*K*d+3*g*e*n*s*T+6*w*n*y*d*l-3*g*e*y*d*l-3*h*t*n*s*S-6*
x*z*s*d*l-6*r*n*y*d*l+3*h*t*z*d*l-2*e*H*n*d*l-6*m*n*q*y*l-6*m*n*y*k*d-6*n*f*q*y*d+6*m*z*s*k*l+2*E*t*s*d*l+q*q*q*K-3*w*K*S+3*x*J*T+3*r*K*S+L*n*S-I*s*T-3*w*z*s*T+3*x*n*y*S-2*g*t*z*T+g*t*y*S-h*e*z*T+2*h*e*y*S+3*r*z*s*T-e*H*s*S-3*c*n*y*S+E*t*n*T-3*n*R*y*k+z*s*d*(6*c*l+6*f*k)+z*q*s*(6*f*l+3*Q)+J*(-2*f*k*l-c*T-k*(2*f*l+Q)-l*(2*c*l+2*f*k)),6*g*e*n*s*k*l+g*t*n*q*s*l+g*t*n*s*k*d-h*e*n*q*s*l-h*e*n*s*k*d-6*h*t*n*q*s*d-6*w*q*K*d+6*r*q*K*d+6*x*J*k*l+2*L*n*q*d-2*I*s*k*l+6*w*n*q*y*l+6*w*n*y*k*d+6*x*n*q*y*d-3*g*
e*q*y*l-3*g*e*y*k*d+2*g*t*q*y*d+4*h*e*q*y*d-6*w*z*s*k*l-6*x*z*q*s*l-6*x*z*s*k*d-4*g*t*z*k*l-6*r*n*q*y*l-6*r*n*y*k*d-2*h*e*z*k*l+3*h*t*z*q*l+3*h*t*z*k*d-2*e*H*n*q*l-2*e*H*n*k*d-2*e*H*q*s*d-6*c*n*q*y*d-6*m*n*f*y*d-6*m*n*q*y*k+6*r*z*s*k*l+2*E*t*n*k*l+2*E*t*q*s*l+2*E*t*s*k*d+3*m*R*K+3*O*K*d-3*n*f*R*y-3*O*n*y*l+z*q*s*(6*c*l+6*f*k)+z*s*d*(6*c*k+3*P)+m*z*s*(6*f*l+3*Q)+J*(-2*c*k*l-l*(2*c*k+P)-f*(2*f*l+Q)-k*(2*c*l+2*f*k)),g*m*t*n*s*l+g*t*n*f*s*d+g*t*n*q*s*k-h*e*m*n*s*l-h*e*n*f*s*d-h*e*n*q*s*k-6*h*m*t*n*s*
d-6*w*m*K*d+6*r*m*K*d+2*m*L*n*d+6*w*m*n*y*l+6*w*n*f*y*d+6*w*n*q*y*k+6*x*m*n*y*d-3*g*e*m*y*l-3*g*e*f*y*d-3*g*e*q*y*k+2*g*m*t*y*d+4*h*e*m*y*d-6*x*m*z*s*l-6*x*z*f*s*d-6*x*z*q*s*k-6*r*m*n*y*l-6*r*n*f*y*d-6*r*n*q*y*k+3*h*m*t*z*l-3*h*t*n*R*s+3*h*t*z*f*d+3*h*t*z*q*k-2*e*m*H*n*l-2*e*m*H*s*d-2*e*H*n*f*d-2*e*H*n*q*k-6*c*m*n*y*d-6*m*n*f*q*y+6*c*z*f*s*d+2*E*m*t*s*l+2*E*t*f*s*d+2*E*t*q*s*k-3*w*R*K+3*r*R*K+3*O*q*K+L*n*R+3*x*n*R*y+g*t*R*y+2*h*e*R*y-e*H*R*s-3*c*n*R*y-3*O*n*y*k+E*t*n*(2*f*l+Q)+g*e*n*s*(6*f*l+3*Q)+
m*z*s*(6*c*l+6*f*k)+I*s*(-2*f*l-Q)+x*J*(6*f*l+3*Q)+h*e*z*(-2*f*l-Q)+g*t*z*(-4*f*l-2*Q)+w*z*s*(-6*f*l-3*Q)+z*q*s*(6*c*k+3*P)+r*z*s*(6*f*l+3*Q)+J*(-2*c*f*l-k*(2*c*k+P)-c*(2*f*l+Q)-f*(2*c*l+2*f*k)),-w*g*t*n*s*l+w*h*e*n*s*l+6*w*h*t*n*s*d-6*x*g*e*n*s*l-x*g*t*n*s*d+x*h*e*n*s*d+g*h*e*t*n*l-g*h*e*t*s*d+g*r*t*n*s*l+g*c*t*n*s*d+g*m*t*n*s*k+g*t*n*f*q*s-r*h*e*n*s*l-6*r*h*t*n*s*d-h*e*c*n*s*d-h*e*m*n*s*k-h*e*n*f*q*s-6*h*m*t*n*q*s-6*w*r*K*d-6*w*m*q*K-2*w*L*n*d+6*r*m*q*K+2*r*L*n*d+2*m*L*n*q+2*x*I*s*l-6*w*x*n*y*d+
3*w*g*e*y*l-2*w*g*t*y*d-4*w*h*e*y*d+3*x*g*e*y*d+6*w*x*z*s*l+6*w*r*n*y*l-3*w*h*t*z*l+2*w*e*H*n*l+2*w*e*H*s*d+6*w*c*n*y*d+6*w*m*n*y*k+6*w*n*f*q*y+4*x*g*t*z*l+6*x*r*n*y*d+2*x*h*e*z*l-3*x*h*t*z*d+2*x*e*H*n*d+6*x*m*n*q*y-3*g*r*e*y*l+2*g*r*t*y*d+g*h*H*n*d-3*g*e*c*y*d-3*g*e*m*y*k-3*g*e*f*q*y+2*g*m*t*q*y+4*r*h*e*y*d+4*h*e*m*q*y-2*w*E*t*s*l-6*x*r*z*s*l-6*x*c*z*s*d-6*x*m*z*s*k-2*x*E*t*n*l-2*x*E*t*s*d-6*x*z*f*q*s-g*h*E*s*l-2*g*F*n*s*d+3*r*h*t*z*l-2*r*e*H*n*l-2*r*e*H*s*d-6*r*c*n*y*d-6*r*m*n*y*k-6*r*n*f*q*y+3*
h*c*t*z*d+3*h*m*t*z*k+3*h*t*z*f*q-2*e*c*H*n*d-2*e*m*H*n*k-2*e*m*H*q*s-2*e*H*n*f*q-6*c*m*n*q*y-F*e*t*n*d+2*r*E*t*s*l+6*c*z*f*q*s+2*A*h*n*s*l+A*e*t*s*l+2*E*c*t*s*d+2*E*m*t*s*k+2*E*t*f*q*s+m*m*m*K+3*B*K*d-3*D*J*l+3*M*K*d+G*z*d-C*y*l-g*F*z*l+A*h*y*d-3*B*n*y*l+3*D*z*s*d-A*H*n*l+F*E*s*d-3*O*n*f*y-3*M*n*y*l+3*N*z*s*d+g*e*n*s*(6*c*l+6*f*k)+I*s*(-2*c*l-2*f*k)+x*J*(6*c*l+6*f*k)+h*e*z*(-2*c*l-2*f*k)+E*t*n*(2*c*l+2*f*k)+g*t*z*(-4*c*l-4*f*k)+w*z*s*(-6*c*l-6*f*k)+r*z*s*(6*c*l+6*f*k)+m*z*s*(6*c*k+3*P)+J*(-2*c*f*
k-N*l-f*(2*c*k+P)-c*(2*c*l+2*f*k)),-w*g*t*n*s*k+w*h*e*n*s*k+6*w*h*t*n*q*s-6*x*g*e*n*s*k-x*g*t*n*q*s+x*h*e*n*q*s+g*h*e*t*n*k-g*h*e*t*q*s+g*r*t*n*s*k+g*c*t*n*q*s+g*m*t*n*f*s-r*h*e*n*s*k-6*r*h*t*n*q*s-h*e*c*n*q*s-h*e*m*n*f*s-6*w*r*q*K-2*w*L*n*q+2*r*L*n*q+2*x*I*s*k-6*w*x*n*q*y+3*w*g*e*y*k-2*w*g*t*q*y-4*w*h*e*q*y+3*x*g*e*q*y+6*w*x*z*s*k+6*w*r*n*y*k-3*w*h*t*z*k+2*w*e*H*n*k+2*w*e*H*q*s+6*w*c*n*q*y+6*w*m*n*f*y+4*x*g*t*z*k+6*x*r*n*q*y+2*x*h*e*z*k-3*x*h*t*z*q+2*x*e*H*n*q-3*g*r*e*y*k+2*g*r*t*q*y+g*h*H*n*q-3*
g*e*c*q*y-3*g*e*m*f*y+4*r*h*e*q*y-2*w*E*t*s*k-6*x*r*z*s*k-6*x*c*z*q*s-6*x*m*z*f*s-2*x*E*t*n*k-2*x*E*t*q*s-g*h*E*s*k-2*g*F*n*q*s+3*r*h*t*z*k-2*r*e*H*n*k-2*r*e*H*q*s-6*r*c*n*q*y-6*r*m*n*f*y+3*h*c*t*z*q+3*h*m*t*z*f-2*e*c*H*n*q-2*e*m*H*n*f-F*e*t*n*q+2*r*E*t*s*k-3*h*O*t*n*s+6*c*m*z*f*s+2*A*h*n*s*k+A*e*t*s*k+2*E*c*t*q*s+2*E*m*t*f*s-3*w*O*K+3*r*O*K+3*B*q*K-3*D*J*k+3*M*q*K+O*L*n+G*z*q-C*y*k+3*x*O*n*y-g*F*z*k+g*O*t*y+2*h*e*O*y+A*h*q*y-e*O*H*s-3*c*O*n*y-3*B*n*y*k+3*D*z*q*s-A*H*n*k+F*E*q*s-3*M*n*y*k+3*N*z*q*
s+E*t*n*(2*c*k+P)+g*e*n*s*(6*c*k+3*P)+I*s*(-2*c*k-P)+x*J*(6*c*k+3*P)+h*e*z*(-2*c*k-P)+g*t*z*(-4*c*k-2*P)+w*z*s*(-6*c*k-3*P)+r*z*s*(6*c*k+3*P)+J*(-2*c*P-N*k-c*(2*c*k+P)),-w*g*t*n*f*s+w*h*e*n*f*s+6*w*h*m*t*n*s-6*x*g*e*n*f*s-x*g*m*t*n*s+x*h*e*m*n*s-g*h*e*m*t*s+g*h*e*t*n*f+g*r*t*n*f*s+6*g*e*c*n*f*s+g*c*m*t*n*s-r*h*e*n*f*s-6*r*h*m*t*n*s-h*e*c*m*n*s-6*w*r*m*K-2*w*m*L*n+6*x*c*J*f+2*r*m*L*n+2*x*I*f*s-2*I*c*f*s-6*w*x*m*n*y+3*w*g*e*f*y-2*w*g*m*t*y-4*w*h*e*m*y+3*x*g*e*m*y+6*w*x*z*f*s+6*w*r*n*f*y-3*w*h*t*z*f+
2*w*e*m*H*s+2*w*e*H*n*f+6*w*c*m*n*y+4*x*g*t*z*f+6*x*r*m*n*y+2*x*h*e*z*f-3*x*h*m*t*z+2*x*e*m*H*n-3*g*r*e*f*y+2*g*r*m*t*y+g*h*m*H*n-3*g*e*c*m*y+4*r*h*e*m*y-6*w*c*z*f*s-2*w*E*t*f*s-6*x*r*z*f*s-6*x*c*m*z*s-2*x*E*m*t*s-2*x*E*t*n*f-g*h*E*f*s-4*g*c*t*z*f-2*g*F*m*n*s+3*r*h*t*z*f-2*r*e*m*H*s-2*r*e*H*n*f-6*r*c*m*n*y-2*h*e*c*z*f+3*h*c*m*t*z-2*e*c*m*H*n-F*e*m*t*n+6*r*c*z*f*s+2*r*E*t*f*s+2*A*h*n*f*s+A*e*t*f*s+2*E*c*m*t*s+2*E*c*t*n*f+3*B*m*K-3*D*J*f+3*M*m*K+G*m*z-C*f*y-3*N*J*f-g*F*z*f+A*h*m*y-3*B*n*f*y+3*D*m*z*
s-A*H*n*f+F*E*m*s-3*M*n*f*y+3*N*m*z*s,w*x*g*t*n*s-w*x*h*e*n*s+w*g*h*e*t*s-x*g*h*e*t*n-w*g*c*t*n*s+6*w*r*h*t*n*s+w*h*e*c*n*s-x*g*r*t*n*s-6*x*g*e*c*n*s+x*r*h*e*n*s-g*r*h*e*t*s+g*h*e*c*t*n+g*r*c*t*n*s-r*h*e*c*n*s-2*w*r*L*n+2*x*I*c*s-3*w*x*g*e*y-6*w*x*r*n*y+3*w*x*h*t*z-2*w*x*e*H*n-2*w*g*r*t*y-w*g*h*H*n+3*w*g*e*c*y-4*w*r*h*e*y+3*x*g*r*e*y+6*w*x*c*z*s+2*w*x*E*t*s+2*w*g*F*n*s+2*w*r*e*H*s+6*w*r*c*n*y-3*w*h*c*t*z+2*w*e*c*H*n+w*F*e*t*n+x*g*h*E*s+4*x*g*c*t*z-3*x*r*h*t*z+2*x*r*e*H*n+2*x*h*e*c*z+g*r*h*H*n-3*g*
r*e*c*y-2*w*E*c*t*s-6*x*r*c*z*s-2*x*r*E*t*s-2*x*A*h*n*s-x*A*e*t*s-2*x*E*c*t*n-2*g*r*F*n*s-g*h*E*c*s+3*r*h*c*t*z-2*r*e*c*H*n-r*F*e*t*n+3*D*g*e*n*s+3*g*e*N*n*s+2*r*E*c*t*s-3*B*h*t*n*s+2*A*h*c*n*s+A*e*c*t*s-3*M*h*t*n*s-w*w*w*K+x*x*x*J+r*r*r*K-c*c*c*J-3*w*M*K-w*G*z+3*B*r*K+x*C*y+3*x*N*J+r*G*z+B*L*n-3*D*c*J-D*I*s+M*L*n-C*c*y-I*N*s-w*A*h*y+x*g*F*z-3*w*D*z*s-w*F*E*s+x*A*H*n-g*F*c*z+3*B*x*n*y+B*g*t*y+2*B*h*e*y-2*D*g*t*z-D*h*e*z+A*r*h*y-3*w*N*z*s+3*x*M*n*y+g*M*t*y-2*g*N*t*z+r*F*E*s-h*e*N*z-B*e*H*s-3*B*c*n*
y+3*D*r*z*s+D*E*t*n-A*c*H*n+2*M*h*e*y+3*r*N*z*s-M*e*H*s-3*M*c*n*y+E*N*t*n])).getRootsInInterval(0,1);for(D=0;D<B.length;D++)if(A=B[D],C=(new qlib.Polynomial([n,e,g,w-r-A*m-A*A*q-A*A*A*d])).getRoots(),F=(new qlib.Polynomial([s,t,h,x-c-A*f-A*A*k-A*A*A*l])).getRoots(),0<C.length&&0<F.length)a:for(G=0;G<C.length;G++)if(E=C[G],0<=E&&1>=E)for(I=0;I<F.length;I++)if(1E-4>Math.abs(E-F[I])){this.appendPoint(new qlib.Vector2(d*A*A*A+q*A*A+m*A+r,l*A*A*A+k*A*A+f*A+c));break a}0<this.points.length&&(this.status=
qlib.Intersection.INTERSECTION);return this};c.bezier3_line=function(a,b){var d=b.p1.getMin(b.p2),h=b.p1.getMax(b.p2),c=b.p1.y-b.p2.y,e=b.p2.x-b.p1.x,f=c*(-a.p1.x+3*(a.c1.x-a.c2.x)+a.p2.x)+e*(-a.p1.y+3*(a.c1.y-a.c2.y)+a.p2.y),u=[],k=(3*c*(a.p1.x-2*a.c1.x+a.c2.x)+3*e*(a.p1.y-2*a.c1.y+a.c2.y))/f,l=(3*c*(a.c1.x-a.p1.x)+3*e*(a.c1.y-a.p1.y))/f,m=l-k*k/3,r=m*m*m/27,e=2*k*k*k/27-k*l/3+(c*a.p1.x+e*a.p1.y+b.p1.x*b.p2.y-b.p2.x*b.p1.y)/f,c=-e/2,f=c*c+r;0<f?(r=Math.sqrt(f),m=c+r,m=0>m?-Math.pow(-m,1/3):Math.pow(m,
1/3),r=c-r,r=0>r?-Math.pow(-r,1/3):Math.pow(r,1/3),u.push(m+r-k/3)):0==f?m||e?(u.push(Math.pow(-4*e,1/3)-k/3),u.push(Math.pow(e/2,1/3)-k/3)):u[0]=-k/3:0>f&&(r=Math.acos(c/Math.sqrt(-r))/3,m=2*Math.sqrt(-m/3),u.push(m*Math.cos(r)-k/3),u.push(m*Math.cos(r+2*Math.PI/3)-k/3),u.push(m*Math.cos(r-2*Math.PI/3)-k/3));for(;null!=(k=u.pop());)0<=k&&1>=k&&(e=a.p1.x+k*(a.c1.x-a.p1.x),c=a.p1.y+k*(a.c1.y-a.p1.y),m=a.c1.x+k*(a.c2.x-a.c1.x),r=a.c1.y+k*(a.c2.y-a.c1.y),e+=k*(m-e),c+=k*(r-c),k=new qlib.Vector2(e+k*
(m+k*(a.c2.x+k*(a.p2.x-a.c2.x)-m)-e),c+k*(r+k*(a.c2.y+k*(a.p2.y-a.c2.y)-r)-c)),k.x>=d.x&&k.y>=d.y&&k.x<=h.x&&k.y<=h.y&&this.appendPoint(k));0<this.points.length&&(this.status=qlib.Intersection.INTERSECTION);return this};c.line_line=function(a,b){var d=a.p1.y-b.p1.y,h=a.p1.x-b.p1.x,c=b.p2.x-b.p1.x,e=b.p2.y-b.p1.y,f=a.p2.x-a.p1.x,u=a.p2.y-a.p1.y,k=c*d-e*h,d=f*d-u*h,c=e*f-c*u;0!=c?(k/=c,c=d/c,0<=k&&1>=k&&0<=c&&1>=c&&(this.points[0]=new qlib.Vector2(a.p1.x+k*f,a.p1.y+k*u),this.status=qlib.Intersection.INTERSECTION)):
this.status=0==k||0==d?qlib.Intersection.COINCIDENT:qlib.Intersection.PARALLEL;return this};c.line_polygon=function(a,b){for(var d,h=0;h<b.pointCount;h++)d=a.intersect(b.getSide(h)),d.status==qlib.Intersection.INTERSECTION?(this.status=qlib.Intersection.INTERSECTION,this.appendPoint(d.points[0])):this.status==qlib.Intersection.NO_INTERSECTION&&(this.status=d.status);return this};c.line_triangle=function(a,b){for(var d,h=0;3>h;h++)d=a.intersect(b.getSide(h)),d.status==qlib.Intersection.INTERSECTION?
(this.status=qlib.Intersection.INTERSECTION,this.appendPoint(d.points[0])):this.status==qlib.Intersection.NO_INTERSECTION&&(this.status=d.status);return this};c.line_mixedPath=function(a,b){var d=qlib.Polygon.fromRectangle(b.getBoundingRect(!0)).intersect(a);if(d.status==qlib.Intersection.NO_INTERSECTION)return this.status=d.status,this;for(var h=0;h<b.segmentCount;h++)if(d=a.intersect(b.getSegment(h)),d.status==qlib.Intersection.INTERSECTION)for(var c=0;c<d.points.length;c++)this.appendPoint(d.points[c]);
0<this.points.length&&(this.status=qlib.Intersection.INTERSECTION);return this};c.line_linearPath=function(a,b){var d=qlib.Polygon.fromRectangle(b.getBoundingRect(!0)).intersect(a);if(d.status==qlib.Intersection.NO_INTERSECTION)return this.status=d.status,this;for(var h=0;h<b.segmentCount;h++)if(d=a.intersect(b.getSegment(h)),d.status==qlib.Intersection.INTERSECTION)for(var c=0;c<d.points.length;c++)this.appendPoint(d.points[c]);0<this.points.length&&(this.status=qlib.Intersection.INTERSECTION);return this};
c.bezier2_mixedPath=function(a,b){for(var d,h=0;h<b.segmentCount;h++)if(d=a.intersect(b.getSegment(h)),d.status==qlib.Intersection.INTERSECTION){this.status=qlib.Intersection.INTERSECTION;for(var c=0;c<d.points.length;c++)this.appendPoint(d.points[c])}else this.status==qlib.Intersection.NO_INTERSECTION&&(this.status=d.status);return this};c.bezier3_mixedPath=function(a,b){for(var d,h=0;h<b.segmentCount;h++)if(d=a.intersect(b.getSegment(h)),d.status==qlib.Intersection.INTERSECTION){this.status=qlib.Intersection.INTERSECTION;
for(var c=0;c<d.points.length;c++)this.appendPoint(d.points[c])}else this.status==qlib.Intersection.NO_INTERSECTION&&(this.status=d.status);return this};c.bezier2_line=function(a,b){for(var d=b.p1.getMin(b.p2),h=b.p1.getMax(b.p2),c=b.p1.y-b.p2.y,e=b.p2.x-b.p1.x,c=(new qlib.Polynomial([c*(a.p1.x-2*a.c.x+a.p2.x)+e*(a.p1.y-2*a.c.y+a.p2.y),c*(-2*a.p1.x+2*a.c.x)+e*(-2*a.p1.y+2*a.c.y),c*a.p1.x+e*a.p1.y+(b.p1.x*b.p2.y-b.p2.x*b.p1.y)])).getRoots();null!=(e=c.pop());)if(0<=e&&1>=e){var p=a.p1.x+e*(a.c.x-a.p1.x),
u=a.p1.y+e*(a.c.y-a.p1.y),p=p+e*(a.c.x+e*(a.p2.x-a.c.x)-p),e=u+e*(a.c.y+e*(a.p2.y-a.c.y)-u);b.p1.x==b.p2.x?d.y<=e&&e<=h.y&&this.appendPoint(new qlib.Vector2(p,e)):b.p1.y==b.p1.y?d.x<=p&&p<=h.x&&this.appendPoint(new qlib.Vector2(p,e)):p>=d.x&&p<=h.x&&e>=d.y&&e<=h.y&&this.appendPoint(new qlib.Vector2(p,e))}0<this.points.length&&(this.status=f.INTERSECTION);return this};c.draw=function(a,b){for(var d=0;d<this.points.length;d++)this.points[d].draw(a,b)};c.toString=function(){return"Intersection: "+this.status};
qlib.Intersection=f})();window.qlib=window.qlib||{};
(function(){var f=function(){};f.circlesIntersection=function(c,a){var b=c.r,d=a.r,h=c.c.distanceToVector(a.c);if(h>b+d)return null;var g=(h*h-d*d+b*b)/(2*h),b=1/h*Math.sqrt((-h+d-b)*(-h-d+b)*(-h+d+b)*(h+d+b))*.5;if(0>=b)return null;d=c.c.getAngleTo(a.c);return[new qlib.Vector2(c.c.x+Math.cos(d)*g+Math.cos(d+halfPi)*b,c.c.y+Math.sin(d)*g+Math.sin(d+halfPi)*b),new qlib.Vector2(c.c.x+Math.cos(d)*g+Math.cos(d-halfPi)*b,c.c.y+Math.sin(d)*g+Math.sin(d-halfPi)*b)]};f.lineCircleIntersection=function(c,a,
b){var d=new qlib.Vector2(c.x-b.c.x,c.y-b.c.y),h=new qlib.Vector2(a.x-b.c.x,a.y-b.c.y),g=b.r;a=h.x-d.x;c=h.y-d.y;var e=Math.sqrt(a*a+c*c),e=e*e,d=d.x*h.y-h.x*d.y,g=g*g*e-d*d;if(0>g)return null;var h=Math.sqrt(g),f=[new qlib.Vector2((d*c+(0>c?-1:1)*a*h)/e+b.c.x,(-d*a+(0>c?-c:c)*h)/e+b.c.y)];if(0==g)return f;0<g&&f.push(new qlib.Vector2((d*c-(0>c?-1:1)*a*h)/e+b.c.x,(-d*a-(0>c?-c:c)*h)/e+b.c.y));return f};f.segmentCircleIntersection=function(c,a,b){var d=[],h,g,e;g=new qlib.Vector2(a.x-c.x,a.y-c.y);
h=g.x*g.x+g.y*g.y;g=2*(g.x*(c.x-b.c.x)+g.y*(c.y-b.c.y));e=b.c.x*b.c.x+b.c.y*b.c.y;e+=c.x*c.x+c.y*c.y;e-=2*(b.c.x*c.x+b.c.y*c.y);e-=b.r*b.r;e=g*g-4*h*e;if((0>h?-h:h)<Number.MIN_VALUE||0>e)return null;b=(-g+Math.sqrt(e))/(2*h);h=(-g-Math.sqrt(e))/(2*h);if((0>b||1<b)&&(0>h||1<h))return null;g=new qlib.Vector2(c.x+(a.x-c.x)*b,c.y+(a.y-c.y)*b);c=new qlib.Vector2(c.x+(a.x-c.x)*h,c.y+(a.y-c.y)*h);return 0<b&&1>b&&(0>h||1<h)?(d.push(g),d):0<h&&1>h&&(0>b||1<b)?(d.push(c),d):0<b&&1>b&&0<h&&1>h?(b==h?d.push(g):
d.push(g,c),d):null};f.lineIntersectLine=function(c,a,b,d,h,g){h=null==h?!0:h;g=null==g?!0:g;var e,f,u,k,l,m;e=a.y-c.y;u=c.x-a.x;f=d.y-b.y;k=b.x-d.x;var r=e*k-f*u;if(0==r)return null;l=a.x*c.y-c.x*a.y;m=d.x*b.y-b.x*d.y;var q=new qlib.Vector2;q.x=(u*m-k*l)/r;q.y=(f*l-e*m)/r;c.x==a.x?q.x=c.x:b.x==d.x&&(q.x=b.x);c.y==a.y?q.y=c.y:b.y==d.y&&(q.y=b.y);return h&&((c.x<a.x?q.x<c.x||q.x>a.x:q.x>c.x||q.x<a.x)||(c.y<a.y?q.y<c.y||q.y>a.y:q.y>c.y||q.y<a.y))||g&&((b.x<d.x?q.x<b.x||q.x>d.x:q.x>b.x||q.x<d.x)||(b.y<
d.y?q.y<b.y||q.y>d.y:q.y>b.y||q.y<d.y))?null:q};qlib.IntersectionUtils=f})();window.qlib=window.qlib||{};
(function(){function f(a,b,d){this.obj=a;this.right=this.left=null;this.parent=d;this.dimension=b}function c(a){this.content=[];this.scoreFunction=a}c.prototype={push:function(a){this.content.push(a);this.bubbleUp(this.content.length-1)},pop:function(){var a=this.content[0],b=this.content.pop();0<this.content.length&&(this.content[0]=b,this.sinkDown(0));return a},peek:function(){return this.content[0]},remove:function(a){for(var b=this.content.length,d=0;d<b;d++)if(this.content[d]==a){var h=this.content.pop();
d!=b-1&&(this.content[d]=h,this.scoreFunction(h)<this.scoreFunction(a)?this.bubbleUp(d):this.sinkDown(d));return}throw Error("Node not found.");},size:function(){return this.content.length},bubbleUp:function(a){for(var b=this.content[a];0<a;){var d=Math.floor((a+1)/2)-1,h=this.content[d];if(this.scoreFunction(b)<this.scoreFunction(h))this.content[d]=b,this.content[a]=h,a=d;else break}},sinkDown:function(a){for(var b=this.content.length,d=this.content[a],h=this.scoreFunction(d);;){var c=2*(a+1),e=
c-1,f=null;if(e<b){var u=this.scoreFunction(this.content[e]);u<h&&(f=e)}c<b&&this.scoreFunction(this.content[c])<(null==f?h:u)&&(f=c);if(null!=f)this.content[a]=this.content[f],this.content[f]=d,a=f;else break}}};qlib.KDTree=function(a,b,d){function h(a,b,c){var g=b%d.length,e;if(0===a.length)return null;if(1===a.length)return new f(a[0],g,c);a.sort(function(a,b){return a[d[g]]-b[d[g]]});e=Math.floor(a.length/2);c=new f(a[e],g,c);c.left=h(a.slice(0,e),b+1,c);c.right=h(a.slice(e+1),b+1,c);return c}
function g(a){function b(a){a.left&&(a.left.parent=a,b(a.left));a.right&&(a.right.parent=a,b(a.right))}e.root=a;b(e.root)}var e=this;Array.isArray(a)?this.root=h(a,0,null):g(a,b,d);this.toJSON=function(a){a||(a=this.root);var b=new f(a.obj,a.dimension,null);a.left&&(b.left=e.toJSON(a.left));a.right&&(b.right=e.toJSON(a.right));return b};this.insert=function(a){function b(h,c){if(null===h)return c;var g=d[h.dimension];return a[g]<h.obj[g]?b(h.left,h):b(h.right,h)}var h=b(this.root,null),c,g;null===
h?this.root=new f(a,0,null):(c=new f(a,(h.dimension+1)%d.length,h),g=d[h.dimension],a[g]<h.obj[g]?h.left=c:h.right=c)};this.remove=function(a){function b(h){if(null===h)return null;if(h.obj===a)return h;var c=d[h.dimension];return a[c]<h.obj[c]?b(h.left,h):b(h.right,h)}function h(a){function b(a,h){var c,g,e,f,p;if(null===a)return null;c=d[h];if(a.dimension===h)return null!==a.right?b(a.right,h):a;g=a.obj[c];e=b(a.left,h);f=b(a.right,h);p=a;null!==e&&e.obj[c]>g&&(p=e);null!==f&&f.obj[c]>p.obj[c]&&
(p=f);return p}function c(a,b){var h,g,e,f,p;if(null===a)return null;h=d[b];if(a.dimension===b)return null!==a.left?c(a.left,b):a;g=a.obj[h];e=c(a.left,b);f=c(a.right,b);p=a;null!==e&&e.obj[h]<g&&(p=e);null!==f&&f.obj[h]<p.obj[h]&&(p=f);return p}var g,f;null===a.left&&null===a.right?null===a.parent?e.root=null:(g=d[a.parent.dimension],a.obj[g]<a.parent.obj[g]?a.parent.left=null:a.parent.right=null):(g=null!==a.left?b(a.left,a.dimension):c(a.right,a.dimension),f=g.obj,h(g),a.obj=f)}var c;c=b(e.root);
null!==c&&h(c)};this.nearest=function(a,h,g){function f(c){var g;g=d[c.dimension];var e=b(a,c.obj),k={},m;for(m=0;m<d.length;m+=1)k[d[m]]=m===c.dimension?a[d[m]]:c.obj[d[m]];k=b(k,c.obj);if(null===c.right&&null===c.left){if(r.size()<h||e<r.peek()[1])r.push([c,e]),r.size()>h&&r.pop()}else{g=null===c.right?c.left:null===c.left?c.right:a[g]<c.obj[g]?c.left:c.right;f(g);if(r.size()<h||e<r.peek()[1])r.push([c,e]),r.size()>h&&r.pop();if(r.size()<h||Math.abs(k)<r.peek()[1])c=g===c.left?c.right:c.left,null!==
c&&f(c)}}var m,r;r=new c(function(a){return-a[1]});if(g)for(m=0;m<h;m+=1)r.push([null,g]);f(e.root);g=[];for(m=0;m<h;m+=1)r.content[m][0]&&g.push([r.content[m][0].obj,r.content[m][1]]);return g};this.balanceFactor=function(){function a(b){return null===b?0:Math.max(a(b.left),a(b.right))+1}function b(a){return null===a?0:b(a.left)+b(a.right)+1}return a(e.root)/(Math.log(b(e.root))/Math.log(2))}}})();this.qlib=this.qlib||{};
(function(){var f=function(){this.initialize()};f.fromArray=function(a,b){null==b&&(b=!1);for(var d=new qlib.LinearPath,h=0;h<a.length;h++)d.addPoint(b?a[h].clone():a[h]);return d};f.SMOOTH_PATH_RELATIVE_EDGEWISE=0;f.SMOOTH_PATH_ABSOLUTE_EDGEWISE=1;f.SMOOTH_PATH_RELATIVE_MINIMUM=2;f.SMOOTH_PATH_ABSOLUTE_MINIMUM=3;var c=f.prototype=new qlib.GeometricShape;c.type="LinearPath";c.initialize=function(){this.points=[];this.distances=[];this.totalLength=0;this.dirty=!1};c.__defineGetter__("segmentCount",
function(){return this.points.length});c.addPoint=function(a,b){if(0<this.points.length&&this.points[this.points.length-1].equals(a))return!1;null==b&&(b=!0);this.points.push(b?a.clone():a);if(1<this.points.length){var d=a.distanceToVector(this.points[this.points.length-2]);if(0<d)this.distances.push(d),this.totalLength+=d;else return this.points.pop(),!1}return this.dirty=!0};c.getSmoothPath=function(a,b,d){null==b&&(b=0);null==d&&(d=!1);if(0>b||3<b)return!1;for(var h=[],c,e=Number.MAX_VALUE,p,u,
k=0;k<this.points.length-(d?0:1);k++)switch(c=this.getSegment(k),h.push(c),b){case f.SMOOTH_PATH_RELATIVE_MINIMUM:case f.SMOOTH_PATH_ABSOLUTE_MINIMUM:e=Math.min(e,c.length)}switch(b){case f.SMOOTH_PATH_RELATIVE_MINIMUM:e=.5*e*a;break;case f.SMOOTH_PATH_ABSOLUTE_MINIMUM:e=Math.min(.5*e,a)}var l=new qlib.MixedPath;0<h.length&&(d||l.addPoint(h[0].getPoint(0)));for(k=0;k<h.length;k++)if(c=h[k],0<c.length){switch(b){case f.SMOOTH_PATH_RELATIVE_EDGEWISE:e=.5*c.length*a;break;case f.SMOOTH_PATH_ABSOLUTE_EDGEWISE:e=
Math.min(.5*c.length,a)}p=c.getPoint(e/c.length);u=c.getPoint(1-e/c.length);l.addPoint(p);p.equals(u)||l.addPoint(u);l.addControlPoint(c.p2.clone())}0<h.length&&(d||l.addPoint(h[h.length-1].getPoint(1)));l.closed=d;return l};c.getSegment=function(a){a=(a%this.points.length+this.points.length)%this.points.length;return new qlib.LineSegment(this.points[a],this.points[(a+1)%this.points.length])};c.getBoundingRect=function(){for(var a=this.points[0],b=a.x,d=b,h=a.y,c=h,e=1;e<this.points.length;e++)a=
this.points[e],a.x<b?b=a.x:a.x>d&&(d=a.x),a.y<h?h=a.y:a.y>c&&(c=a.y);return new qlib.Rectangle(b,h,d-b,c-h)};qlib.LinearPath=f})();this.qlib=this.qlib||{};
(function(){var f=function(){this.initialize(arguments)},c=f.prototype=new qlib.GeometricShape;c.type="LineSegment";c.initialize=function(a){0==a.length?(this.p1=new qlib.Vector2,this.p2=new qlib.Vector2):"number"===typeof a[0]?(this.p1=new qlib.Vector2(a[0],a[1]),this.p2="number"===typeof a[2]?new qlib.Vector2(a[2],a[3]):a[2]):(this.p1=a[0],this.p2="number"===typeof a[1]?new qlib.Vector2(a[1],a[2]):a[1]);this.p2_end=this.p1_end=!0};c.getPoint=function(a){return this.p1.getLerp(this.p2,a)};c.getNormal=
function(){return(new qlib.Vector2(this.p1,this.p2)).getNormal()};c.getNormalAtPoint=function(){return this.getNormal()};c.scale=function(a,b,d){null==d&&(d=this.p1.getLerp(this.p2,.5));this.p1.minus(d).multiplyXY(a,b).plus(d);this.p2.minus(d).multiplyXY(a,b).plus(d);return this};c.rotate=function(a,b){null==b&&(b=this.p1.getLerp(this.p2,.5));this.p1.rotateAround(a,b);this.p2.rotateAround(a,b);return this};c.getClosestT=function(a){var b=this.p2.x-this.p1.x,d=this.p2.y-this.p1.y,h=b*b+d*d;return 0==
h?0:((a.x-this.p1.x)*b+(a.y-this.p1.y)*d)/h};c.getClosestPointOnLine=function(a){var b=this.p2.x-this.p1.x,d=this.p2.y-this.p1.y;a=(a.x-this.p1.x)*b+(a.y-this.p1.y)*d;b=b*b+d*d;return 0===b?new qlib.Vector2(this.p1):this.p1.getLerp(this.p2,a/b)};c.squaredDistanceToPoint=function(a){var b=new qlib.Vector2(this.p1,this.p2),d=new qlib.Vector2(this.p1,a),h=b.dot(d);if(0>=h)return d.dot(d);b=b.dot(b);return h>=b?(a=new qlib.Vector2(a,this.p2),a.dot(a)):d.dot(d)-h*h/b};c.getSplitAtT=function(a,b){null==
b&&(b=!0);var d=[];0!=a&&1!=a||d.push(b?this.clone():this);if(0>=a||1<=a)return d;var h=this.getPoint(a);d.push(new qlib.LineSegment(b?this.p1.clone():this.p1,h));d.push(new qlib.LineSegment(b?h.clone():h,b?this.p2.clone():this.p2));return d};c.getMirrorPoint=function(a){var b=this.p2.x-this.p1.x,d=this.p2.y-this.p1.y,h=b*b+d*d;return 0===h?a.getMirror(this.p1):a.getMirror(this.p1.getLerp(this.p2,((a.x-this.p1.x)*b+(a.y-this.p1.y)*d)/h))};c.mirrorPoint=function(a){var b=this.p2.x-this.p1.x,d=this.p2.y-
this.p1.y,h=b*b+d*d;return 0===h?a.mirror(this.p1):a.mirror(this.p1.getLerp(this.p2,((a.x-this.p1.x)*b+(a.y-this.p1.y)*d)/h))};c.isLeft=function(a){return(this.p2.x-this.p1.x)*(a.y-this.p1.y)-(a.x-this.p1.x)*(this.p2.y-this.p1.y)};c.getSlope=function(){return(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x)};c.getIntercept=function(){return this.p1.y-this.getSlope()*this.p1.x};c.getIntersection=function(a,b,d){null==b&&(b=!1);null==d&&(b=!1);var h=[],c=(a.p2.x-a.p1.x)*(this.p1.y-a.p1.y)-(a.p2.y-a.p1.y)*
(this.p1.x-a.p1.x),e=(this.p2.x-this.p1.x)*(this.p1.y-a.p1.y)-(this.p2.y-this.p1.y)*(this.p1.x-a.p1.x),f=(a.p2.y-a.p1.y)*(this.p2.x-this.p1.x)-(a.p2.x-a.p1.x)*(this.p2.y-this.p1.y);if(0!=f){a=c/f;e/=f;if(b&&(0>a||1<a||0>e||1<e)||d&&0<=a&&1>=a&&0<=e&&1>=e)return h;h.push(new qlib.Vector2(this.p1.x+a*(this.p2.x-this.p1.x),this.p1.y+a*(this.p2.y-this.p1.y)))}else b&&(this.contains(a.p1)&&h.push(a.p1.clone()),this.contains(a.p2)&&h.push(a.p2.clone()),a.contains(this.p1)&&h.push(this.p1.clone()),a.contains(this.p2)&&
h.push(this.p2.clone()));return h};c.getClosestPoint=function(a){var b=this.p2.x-this.p1.x,d=this.p2.y-this.p1.y;a=(a.x-this.p1.x)*b+(a.y-this.p1.y)*d;if(0>=a)return new qlib.Vector2(this.p1);b=b*b+d*d;return a>=b?new qlib.Vector2(this.p2):0===b?new qlib.Vector2(this.p1):this.p1.getLerp(this.p2,a/b)};c.getBoundingRect=function(){var a=this.p1.getMin(this.p2),b=this.p1.getMax(this.p2).minus(a);return new qlib.Rectangle(a.x,a.y,b.x,b.y)};c.getParallel=function(a){a=(new qlib.Vector2(this.p1,this.p2)).getNormal().multiply(a);
return new qlib.LineSegment(this.p1.getPlus(a),this.p2.getPlus(a))};c.moveToStart=function(a,b){a.moveTo(this.p1.x+(null!=b?b.x:0),this.p1.y+(null!=b?b.y:0))};c.moveToEnd=function(a,b){a.moveTo(this.p2.x+(null!=b?b.x:0),this.p2.y+(null!=b?b.y:0))};c.draw=function(a,b){a.moveTo(this.p1.x+(null!=b?b.x:0),this.p1.y+(null!=b?b.y:0));a.lineTo(this.p2.x+(null!=b?b.x:0),this.p2.y+(null!=b?b.y:0))};c.drawTo=function(a,b){a.lineTo(this.p2.x+(null!=b?b.x:0),this.p2.y+(null!=b?b.y:0))};c.drawExtras=function(a,
b,d){var h=this.getParallel(10);null==d?(a.moveTo(this.p1.x,this.p1.y),a.lineTo(h.p1.x,h.p1.y),a.moveTo(this.p2.x,this.p2.y),a.lineTo(h.p2.x,h.p2.y)):(a.moveTo(this.p1.x+d.x,this.p1.y+d.y),a.lineTo(h.p1.x+d.x,h.p1.y+d.y),a.moveTo(this.p2.x+d.x,this.p2.y+d.y),a.lineTo(h.p2.x+d.x,h.p2.y+d.y));h=this.getParallel(5);h.draw(a,d);b=b||1;this.p1.draw(a,b,d);this.p2.draw(a,b,d)};c.__defineGetter__("angle",function(){return this.p1.getAngleTo(this.p2)});c.__defineGetter__("length",function(){return this.p1.distanceToVector(this.p2)});
c.clone=function(a){return!0===a?new f(this.p1.x,this.p1.y,this.p2.x,this.p2.y):new f(this.p1,this.p2)};c.toString=function(){return"LineSegment"};f.fromPointAndAngleAndLength=function(a,b,d,h){return h?new qlib.LineSegment(a.getAddCartesian(b,.5*-d),a.getAddCartesian(b,.5*d)):new qlib.LineSegment(a,a.getAddCartesian(b,d))};qlib.LineSegment=f})();window.qlib=window.qlib||{};
(function(){var f=function(a,b,d,h,c,e){this.initialize(a,b,d,h,c,e)},c=f.prototype;f.identity=null;f.DEG_TO_RAD=Math.PI/180;c.a=1;c.b=0;c.c=0;c.d=1;c.tx=0;c.ty=0;c.alpha=1;c.shadow=null;c.compositeOperation=null;c.initialize=function(a,b,d,h,c,e){null!=a&&(this.a=a);this.b=b||0;this.c=d||0;null!=h&&(this.d=h);this.tx=c||0;this.ty=e||0;return this};c.prepend=function(a,b,d,h,c,e){var f=this.tx;if(1!=a||0!=b||0!=d||1!=h){var u=this.a,k=this.c;this.a=u*a+this.b*d;this.b=u*b+this.b*h;this.c=k*a+this.d*
d;this.d=k*b+this.d*h}this.tx=f*a+this.ty*d+c;this.ty=f*b+this.ty*h+e;return this};c.append=function(a,b,d,h,c,e){var f=this.a,u=this.b,k=this.c,l=this.d;this.a=a*f+b*k;this.b=a*u+b*l;this.c=d*f+h*k;this.d=d*u+h*l;this.tx=c*f+e*k+this.tx;this.ty=c*u+e*l+this.ty;return this};c.prependMatrix=function(a){this.prepend(a.a,a.b,a.c,a.d,a.tx,a.ty);this.prependProperties(a.alpha,a.shadow,a.compositeOperation);return this};c.appendMatrix=function(a){this.append(a.a,a.b,a.c,a.d,a.tx,a.ty);this.appendProperties(a.alpha,
a.shadow,a.compositeOperation);return this};c.prependArray=function(a){this.prepend(a[0],a[1],a[2],a[3],a[4],a[5]);return this};c.appendArray=function(a){this.append(a[0],a[1],a[2],a[3],a[4],a[5]);return this};c.prependTransform=function(a,b,d,h,c,e,p,u,k){if(c%360){var l=c*f.DEG_TO_RAD;c=Math.cos(l);l=Math.sin(l)}else c=1,l=0;if(u||k)this.tx-=u,this.ty-=k;e||p?(e*=f.DEG_TO_RAD,p*=f.DEG_TO_RAD,this.prepend(c*d,l*d,-l*h,c*h,0,0),this.prepend(Math.cos(p),Math.sin(p),-Math.sin(e),Math.cos(e),a,b)):this.prepend(c*
d,l*d,-l*h,c*h,a,b);return this};c.appendTransform=function(a,b,d,h,c,e,p,u,k){if(c%360){var l=c*f.DEG_TO_RAD;c=Math.cos(l);l=Math.sin(l)}else c=1,l=0;e||p?(e*=f.DEG_TO_RAD,p*=f.DEG_TO_RAD,this.append(Math.cos(p),Math.sin(p),-Math.sin(e),Math.cos(e),a,b),this.append(c*d,l*d,-l*h,c*h,0,0)):this.append(c*d,l*d,-l*h,c*h,a,b);if(u||k)this.tx-=u*this.a+k*this.c,this.ty-=u*this.b+k*this.d;return this};c.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);var d=this.a,h=this.c,c=this.tx;this.a=d*b-this.b*
a;this.b=d*a+this.b*b;this.c=h*b-this.d*a;this.d=h*a+this.d*b;this.tx=c*b-this.ty*a;this.ty=c*a+this.ty*b;return this};c.skew=function(a,b){a*=f.DEG_TO_RAD;b*=f.DEG_TO_RAD;this.append(Math.cos(b),Math.sin(b),-Math.sin(a),Math.cos(a),0,0);return this};c.scale=function(a,b){this.a*=a;this.d*=b;this.c*=a;this.b*=b;this.tx*=a;this.ty*=b;return this};c.translate=function(a,b){this.tx+=a;this.ty+=b;return this};c.identity=function(){this.alpha=this.a=this.d=1;this.b=this.c=this.tx=this.ty=0;this.shadow=
this.compositeOperation=null;return this};c.invert=function(){var a=this.a,b=this.b,d=this.c,h=this.d,c=this.tx,e=a*h-b*d;this.a=h/e;this.b=-b/e;this.c=-d/e;this.d=a/e;this.tx=(d*this.ty-h*c)/e;this.ty=-(a*this.ty-b*c)/e;return this};c.isIdentity=function(){return 0==this.tx&&0==this.ty&&1==this.a&&0==this.b&&0==this.c&&1==this.d};c.decompose=function(a){null==a&&(a={});a.x=this.tx;a.y=this.ty;a.scaleX=Math.sqrt(this.a*this.a+this.b*this.b);a.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var b=Math.atan(-this.c/
this.a),d=Math.acos(this.a/a.scaleX)/f.DEG_TO_RAD;a.rotation=90<d&&0<b||90>d&&0>b?360-d:d;b=Math.atan2(-this.c,this.d);d=Math.atan2(this.b,this.a);b==d?a.skewX=a.skewY=0:(a.skewX=b/f.DEG_TO_RAD,a.skewY=d/f.DEG_TO_RAD);return a};c.reinitialize=function(a,b,d,h,c,e,f,u,k){this.initialize(a,b,d,h,c,e);this.alpha=f||1;this.shadow=u;this.compositeOperation=k;return this};c.appendProperties=function(a,b,d){this.alpha*=a;this.shadow=b||this.shadow;this.compositeOperation=d||this.compositeOperation;return this};
c.prependProperties=function(a,b,d){this.alpha*=a;this.shadow=this.shadow||b;this.compositeOperation=this.compositeOperation||d;return this};c.clone=function(){var a=new f(this.a,this.b,this.c,this.d,this.tx,this.ty);a.shadow=this.shadow;a.alpha=this.alpha;a.compositeOperation=this.compositeOperation;return a};c.toString=function(){return"[Matrix (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"};f.identity=new f(1,0,0,1,0,0);qlib.Matrix=f})();
window.qlib=window.qlib||{};
(function(){var f=function(a){this.rawData=a?f.create(a):f.create([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},c=f.prototype;c.rawData=null;c.determinant=function(){return f.determinant(this.rawData)};c.append=function(a){f.multiply(this.rawData,a.rawData)};c.appendRotation=function(a,b,d){a=a*Math.PI/180;if(d){var c=d.clone().negate();this.appendTranslation(c.x,c.y,c.z)}b=b.clone().negate();f.rotate(this.rawData,a,[b.x,b.y,b.z]);d&&this.appendTranslation(d.x,d.y,d.z)};c.appendScale=function(a,b,d){f.scale(this.rawData,
[a,b,d])};c.appendTranslation=function(a,b,d){this.append(f.createTranslateMatrix(a,b,d))};c.clone=function(){return new f(this.rawData)};c.identity=function(){f.identity(this.rawData)};c.invert=function(){f.inverse(this.rawData)};c.prepend=function(a){f.multiply(a.rawData,this.rawData,this.rawData)};c.prependScale=function(a,b,d){this.prepend(f.createScaleMatrix(a,b,d))};c.prependTranslation=function(a,b,d){this.prepend(f.createTranslateMatrix(a,b,d))};c.transformVector=function(a){a=f.multiplyVec3(f.transpose(this.rawData,
f.create()),[a.x,a.y,a.z]);return new qlib.Vector3(a[0],a[1],a[2])};c.transpose=function(){f.transpose(this.rawData)};f.createTranslateMatrix=function(a,b,d){return new f([1,0,0,a,0,1,0,b,0,0,1,d,0,0,0,1])};f.createScaleMatrix=function(a,b,d){return new f([a,0,0,0,0,b,0,0,0,0,d,0,0,0,0,1])};f.create=function(a){var b=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],
b[14]=a[14],b[15]=a[15]);return b};f.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};f.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};f.transpose=function(a,b){if(!b||a==b){var d=a[1],c=a[2],g=a[3],e=a[6],f=a[7],u=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];
a[4]=d;a[6]=a[9];a[7]=a[13];a[8]=c;a[9]=e;a[11]=a[14];a[12]=g;a[13]=f;a[14]=u;return a}b[0]=a[0];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=a[1];b[5]=a[5];b[6]=a[9];b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b};f.determinant=function(a){var b=a[0],d=a[1],c=a[2],g=a[3],e=a[4],f=a[5],u=a[6],k=a[7],l=a[8],m=a[9],r=a[10],q=a[11],n=a[12],w=a[13],B=a[14];a=a[15];return n*m*u*g-l*w*u*g-n*f*r*g+e*w*r*g+l*f*B*g-e*m*B*g-n*m*c*k+l*w*c*k+n*d*r*k-b*w*r*
k-l*d*B*k+b*m*B*k+n*f*c*q-e*w*c*q-n*d*u*q+b*w*u*q+e*d*B*q-b*f*B*q-l*f*c*a+e*m*c*a+l*d*u*a-b*m*u*a-e*d*r*a+b*f*r*a};f.inverse=function(a,b){b||(b=a);var d=a[0],c=a[1],g=a[2],e=a[3],f=a[4],u=a[5],k=a[6],l=a[7],m=a[8],r=a[9],q=a[10],n=a[11],w=a[12],B=a[13],D=a[14],s=a[15],t=d*u-c*f,x=d*k-g*f,A=d*l-e*f,C=c*k-g*u,F=c*l-e*u,G=g*l-e*k,E=m*B-r*w,I=m*D-q*w,H=m*s-n*w,L=r*D-q*B,z=r*s-n*B,J=q*s-n*D,y=1/(t*J-x*z+A*L+C*H-F*I+G*E);b[0]=(u*J-k*z+l*L)*y;b[1]=(-c*J+g*z-e*L)*y;b[2]=(B*G-D*F+s*C)*y;b[3]=(-r*G+q*F-n*
C)*y;b[4]=(-f*J+k*H-l*I)*y;b[5]=(d*J-g*H+e*I)*y;b[6]=(-w*G+D*A-s*x)*y;b[7]=(m*G-q*A+n*x)*y;b[8]=(f*z-u*H+l*E)*y;b[9]=(-d*z+c*H-e*E)*y;b[10]=(w*F-B*A+s*t)*y;b[11]=(-m*F+r*A-n*t)*y;b[12]=(-f*L+u*I-k*E)*y;b[13]=(d*L-c*I+g*E)*y;b[14]=(-w*C+B*x-D*t)*y;b[15]=(m*C-r*x+q*t)*y;return b};f.toRotationMat=function(a,b){b||(b=f.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};f.toMat3=
function(a,b){b||(b=[1,0,0,0,1,0,0,0,1]);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};f.toInverseMat3=function(a,b){var d=a[0],c=a[1],g=a[2],e=a[4],f=a[5],u=a[6],k=a[8],l=a[9],m=a[10],r=m*f-u*l,q=-m*e+u*k,n=l*e-f*k,w=d*r+c*q+g*n;if(!w)return null;w=1/w;b||(b=mat3.create());b[0]=r*w;b[1]=(-m*c+g*l)*w;b[2]=(u*c-g*f)*w;b[3]=q*w;b[4]=(m*d-g*k)*w;b[5]=(-u*d+g*e)*w;b[6]=n*w;b[7]=(-l*d+c*k)*w;b[8]=(f*d-c*e)*w;return b};f.multiply=function(a,b,d){d||
(d=a);var c=a[0],g=a[1],e=a[2],f=a[3],u=a[4],k=a[5],l=a[6],m=a[7],r=a[8],q=a[9],n=a[10],w=a[11],B=a[12],D=a[13],s=a[14];a=a[15];var t=b[0],x=b[1],A=b[2],C=b[3],F=b[4],G=b[5],E=b[6],I=b[7],H=b[8],L=b[9],z=b[10],J=b[11],y=b[12],K=b[13],M=b[14];b=b[15];d[0]=t*c+x*u+A*r+C*B;d[1]=t*g+x*k+A*q+C*D;d[2]=t*e+x*l+A*n+C*s;d[3]=t*f+x*m+A*w+C*a;d[4]=F*c+G*u+E*r+I*B;d[5]=F*g+G*k+E*q+I*D;d[6]=F*e+G*l+E*n+I*s;d[7]=F*f+G*m+E*w+I*a;d[8]=H*c+L*u+z*r+J*B;d[9]=H*g+L*k+z*q+J*D;d[10]=H*e+L*l+z*n+J*s;d[11]=H*f+L*m+z*w+J*
a;d[12]=y*c+K*u+M*r+b*B;d[13]=y*g+K*k+M*q+b*D;d[14]=y*e+K*l+M*n+b*s;d[15]=y*f+K*m+M*w+b*a;return d};f.multiplyVec3=function(a,b,d){d||(d=b);var c=b[0],g=b[1];b=b[2];d[0]=a[0]*c+a[4]*g+a[8]*b+a[12];d[1]=a[1]*c+a[5]*g+a[9]*b+a[13];d[2]=a[2]*c+a[6]*g+a[10]*b+a[14];return d};f.multiplyVec4=function(a,b,d){d||(d=b);var c=b[0],g=b[1],e=b[2];b=b[3];d[0]=a[0]*c+a[4]*g+a[8]*e+a[12]*b;d[1]=a[1]*c+a[5]*g+a[9]*e+a[13]*b;d[2]=a[2]*c+a[6]*g+a[10]*e+a[14]*b;d[4]=a[4]*c+a[7]*g+a[11]*e+a[15]*b;return d};f.translate=
function(a,b,d){var c=b[0],g=b[1];b=b[2];if(!d||a==d)return a[12]=a[0]*c+a[4]*g+a[8]*b+a[12],a[13]=a[1]*c+a[5]*g+a[9]*b+a[13],a[14]=a[2]*c+a[6]*g+a[10]*b+a[14],a[15]=a[3]*c+a[7]*g+a[11]*b+a[15],a;var e=a[0],f=a[1],u=a[2],k=a[3],l=a[4],m=a[5],r=a[6],q=a[7],n=a[8],w=a[9],B=a[10],D=a[11];d[0]=e;d[1]=f;d[2]=u;d[3]=k;d[4]=l;d[5]=m;d[6]=r;d[7]=q;d[8]=n;d[9]=w;d[10]=B;d[11]=D;d[12]=e*c+l*g+n*b+a[12];d[13]=f*c+m*g+w*b+a[13];d[14]=u*c+r*g+B*b+a[14];d[15]=k*c+q*g+D*b+a[15];return d};f.scale=function(a,b,d){var c=
b[0],g=b[1];b=b[2];if(!d||a==d)return a[0]*=c,a[1]*=c,a[2]*=c,a[3]*=c,a[4]*=g,a[5]*=g,a[6]*=g,a[7]*=g,a[8]*=b,a[9]*=b,a[10]*=b,a[11]*=b,a;d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;d[3]=a[3]*c;d[4]=a[4]*g;d[5]=a[5]*g;d[6]=a[6]*g;d[7]=a[7]*g;d[8]=a[8]*b;d[9]=a[9]*b;d[10]=a[10]*b;d[11]=a[11]*b;d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15];return d};f.rotate=function(a,b,d,c){var g=d[0],e=d[1];d=d[2];var f=Math.sqrt(g*g+e*e+d*d);if(!f)return null;1!=f&&(f=1/f,g*=f,e*=f,d*=f);var u=Math.sin(b),k=Math.cos(b),
l=1-k;b=a[0];var f=a[1],m=a[2],r=a[3],q=a[4],n=a[5],w=a[6],B=a[7],D=a[8],s=a[9],t=a[10],x=a[11],A=g*g*l+k,C=e*g*l+d*u,F=d*g*l-e*u,G=g*e*l-d*u,E=e*e*l+k,I=d*e*l+g*u,H=g*d*l+e*u,g=e*d*l-g*u,e=d*d*l+k;c?a!=c&&(c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[0]=b*A+q*C+D*F;c[1]=f*A+n*C+s*F;c[2]=m*A+w*C+t*F;c[3]=r*A+B*C+x*F;c[4]=b*G+q*E+D*I;c[5]=f*G+n*E+s*I;c[6]=m*G+w*E+t*I;c[7]=r*G+B*E+x*I;c[8]=b*H+q*g+D*e;c[9]=f*H+n*g+s*e;c[10]=m*H+w*g+t*e;c[11]=r*H+B*g+x*e;return c};f.rotateX=function(a,b,d){var c=
Math.sin(b);b=Math.cos(b);var g=a[4],e=a[5],f=a[6],u=a[7],k=a[8],l=a[9],m=a[10],r=a[11];d?a!=d&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[4]=g*b+k*c;d[5]=e*b+l*c;d[6]=f*b+m*c;d[7]=u*b+r*c;d[8]=g*-c+k*b;d[9]=e*-c+l*b;d[10]=f*-c+m*b;d[11]=u*-c+r*b;return d};f.rotateY=function(a,b,d){var c=Math.sin(b);b=Math.cos(b);var g=a[0],e=a[1],f=a[2],u=a[3],k=a[8],l=a[9],m=a[10],r=a[11];d?a!=d&&(d[4]=a[4],d[5]=a[5],d[6]=a[6],d[7]=a[7],d[12]=a[12],d[13]=a[13],
d[14]=a[14],d[15]=a[15]):d=a;d[0]=g*b+k*-c;d[1]=e*b+l*-c;d[2]=f*b+m*-c;d[3]=u*b+r*-c;d[8]=g*c+k*b;d[9]=e*c+l*b;d[10]=f*c+m*b;d[11]=u*c+r*b;return d};f.rotateZ=function(a,b,d){var c=Math.sin(b);b=Math.cos(b);var g=a[0],e=a[1],f=a[2],u=a[3],k=a[4],l=a[5],m=a[6],r=a[7];d?a!=d&&(d[8]=a[8],d[9]=a[9],d[10]=a[10],d[11]=a[11],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[0]=g*b+k*c;d[1]=e*b+l*c;d[2]=f*b+m*c;d[3]=u*b+r*c;d[4]=g*-c+k*b;d[5]=e*-c+l*b;d[6]=f*-c+m*b;d[7]=u*-c+r*b;return d};f.frustum=
function(a,b,d,c,g,e,p){p||(p=f.create());var u=b-a,k=c-d,l=e-g;p[0]=2*g/u;p[1]=0;p[2]=0;p[3]=0;p[4]=0;p[5]=2*g/k;p[6]=0;p[7]=0;p[8]=(b+a)/u;p[9]=(c+d)/k;p[10]=-(e+g)/l;p[11]=-1;p[12]=0;p[13]=0;p[14]=-(e*g*2)/l;p[15]=0;return p};f.perspective=function(a,b,d,c,g){a=d*Math.tan(a*Math.PI/360);b*=a;return f.frustum(-b,b,-a,a,d,c,g)};f.ortho=function(a,b,d,c,g,e,p){p||(p=f.create());var u=b-a,k=c-d,l=e-g;p[0]=2/u;p[1]=0;p[2]=0;p[3]=0;p[4]=0;p[5]=2/k;p[6]=0;p[7]=0;p[8]=0;p[9]=0;p[10]=-2/l;p[11]=0;p[12]=
-(a+b)/u;p[13]=-(c+d)/k;p[14]=-(e+g)/l;p[15]=1;return p};f.lookAt=function(a,b,d,c){c||(c=f.create());var g=a[0],e=a[1];a=a[2];var p=d[0],u=d[1],k=d[2];d=b[1];var l=b[2];if(g==b[0]&&e==d&&a==l)return f.identity(c);var m,r,q,n;d=g-b[0];l=e-b[1];b=a-b[2];n=1/Math.sqrt(d*d+l*l+b*b);d*=n;l*=n;b*=n;m=u*b-k*l;k=k*d-p*b;p=p*l-u*d;(n=Math.sqrt(m*m+k*k+p*p))?(n=1/n,m*=n,k*=n,p*=n):p=k=m=0;u=l*p-b*k;r=b*m-d*p;q=d*k-l*m;(n=Math.sqrt(u*u+r*r+q*q))?(n=1/n,u*=n,r*=n,q*=n):q=r=u=0;c[0]=m;c[1]=u;c[2]=d;c[3]=0;c[4]=
k;c[5]=r;c[6]=l;c[7]=0;c[8]=p;c[9]=q;c[10]=b;c[11]=0;c[12]=-(m*g+k*e+p*a);c[13]=-(u*g+r*e+q*a);c[14]=-(d*g+l*e+b*a);c[15]=1;return c};f.decompose=function(a){if(0==a[15])return!1;for(var b=0;16>b;b++)a[b]/=a[15];for(var d=f.create(a),b=0;3>b;b++)d[4*b+3]=0;d[15]=1;if(0==f.determinant(d))return!1;var b=[],c=[0,0,0,1],g=new qlib.Vector3,e=[new qlib.Vector3,new qlib.Vector3,new qlib.Vector3],p=new qlib.Vector3,u=new qlib.Vector3;if(0!=a[3]||0!=a[7]||0!=a[11]){b[0]=a[3];b[1]=a[7];b[2]=a[11];b[3]=a[15];
var d=f.inverse(d),k=new qlib.Matrix3D;f.transpose(d,k);f.multiplyVec4(k,b,c)}g.x=a[12];g.y=a[13];g.z=a[14];e[0].x=a[0];e[0].y=a[1];e[0].z=a[2];e[1].x=a[4];e[1].y=a[5];e[1].z=a[6];e[2].x=a[8];e[2].y=a[9];e[2].z=a[10];p.x=e[0].length();e[0].normalize();u.x=e[0].dot(e[1]);e[1]=combine(e[1],e[0],1,-u.x);p.y=e[1].length();e[1].normalize();u[0]/=p[1];u.y=e[0].dot(e[2]);e[2]=combine(e[2],e[0],1,-u.y);u.z=e[1].dot(e[2]);e[2]=combine(e[2],e[1],1,-u.z);p.z=e[2].length();e[2].normalize();u.y/=p.z;u.z/=p.z;
a=e[1].cross(e[2]);if(0>e[0].dot(a))for(b=0;3>b;b++)p[b]*=-1,e[4*b+0]*=-1,e[4*b+1]*=-1,e[4*b+2]*=-1;quaternion[0]=.5*Math.sqrt(max(1+e[0][0]-e[1][1]-e[2][2],0));quaternion[1]=.5*Math.sqrt(max(1-e[0][0]+e[1][1]-e[2][2],0));quaternion[2]=.5*Math.sqrt(max(1-e[0][0]-e[1][1]+e[2][2],0));quaternion[3]=.5*Math.sqrt(max(1+e[0][0]+e[1][1]+e[2][2],0));e[9]>e[1][2]&&(quaternion[0]=-quaternion[0]);e[2]>e[2][0]&&(quaternion[1]=-quaternion[1]);e[4]>e[0][1]&&(quaternion[2]=-quaternion[2]);return!0};this.combine=
function(a,b,d){return new Vector4(b*this.x+d*a.x,b*this.y+d*a.y,b*this.z+d*a.z)};f.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"};qlib.Matrix3D=f})();this.qlib=this.qlib||{};
(function(){var f=function(){this.initialize(arguments)},c=f.prototype=new qlib.GeometricShape;f.LINEARIZE_APPROXIMATE=0;f.LINEARIZE_COMPLETE=1;f.LINEARIZE_UNDERSHOOT=2;f.LINEARIZE_OVERSHOOT=3;f.LINEARIZE_CENTER=4;f.fromLinearPath=function(a,b){for(var d=new qlib.MixedPath,c=0;c<a.pointCount;c++)d.addPoint(b?a.points[c].clone():a.points[c]);d.updateSegments();return d};f.getRoundedRect=function(a,b,d,c){c=Math.min(c,.5*Math.min(b,d));0>c&&(c=0);var g=new qlib.MixedPath;b*=.5;d*=.5;var e=b-c,f=d-c,
u=Math.cos(-.785398163)*c,k=Math.sin(-.785398163)*c,l=.2761423749*c,m=Math.cos(-2.35619449)*l,r=Math.sin(-2.35619449)*l;g.addPoint(new qlib.Vector2(a.x+e,a.y-d));g.addControlPoint(new qlib.Vector2(a.x+e+l,a.y-d));g.addControlPoint(new qlib.Vector2(a.x+e+u+m,a.y-f+k+r));g.addPoint(new qlib.Vector2(a.x+e+u,a.y-f+k));g.addControlPoint(new qlib.Vector2(a.x+e+u-m,a.y-f+k-r));g.addControlPoint(new qlib.Vector2(a.x+b,a.y-f-l));g.addPoint(new qlib.Vector2(a.x+b,a.y-f));c<d&&g.addPoint(new qlib.Vector2(a.x+
b,a.y+f));g.addControlPoint(new qlib.Vector2(a.x+b,a.y+f+l));g.addControlPoint(new qlib.Vector2(a.x+e+u-m,a.y+f-k+r));g.addPoint(new qlib.Vector2(a.x+e+u,a.y+f-k));g.addControlPoint(new qlib.Vector2(a.x+e+u+m,a.y+f-k-r));g.addControlPoint(new qlib.Vector2(a.x+e+l,a.y+d));g.addPoint(new qlib.Vector2(a.x+e,a.y+d));c<b&&g.addPoint(new qlib.Vector2(a.x-e,a.y+d));g.addControlPoint(new qlib.Vector2(a.x-e-l,a.y+d));g.addControlPoint(new qlib.Vector2(a.x-e-u-m,a.y+f-k-r));g.addPoint(new qlib.Vector2(a.x-
e-u,a.y+f-k));g.addControlPoint(new qlib.Vector2(a.x-e-u+m,a.y+f-k+r));g.addControlPoint(new qlib.Vector2(a.x-b,a.y+f+l));g.addPoint(new qlib.Vector2(a.x-b,a.y+f));c<d&&g.addPoint(new qlib.Vector2(a.x-b,a.y-f));g.addControlPoint(new qlib.Vector2(a.x-b,a.y-f-l));g.addControlPoint(new qlib.Vector2(a.x-e-u+m,a.y-f+k-r));g.addPoint(new qlib.Vector2(a.x-e-u,a.y-f+k));g.addControlPoint(new qlib.Vector2(a.x-e-u-m,a.y-f+k+r));g.addControlPoint(new qlib.Vector2(a.x-e-l,a.y-d));c<b&&g.addPoint(new qlib.Vector2(a.x-
e,a.y-d));g.closed=!0;return g};f.getRectangle=function(a,b,d,c){var g=new qlib.MixedPath;g.addPoint(new qlib.Vector2(a,b));g.addPoint(new qlib.Vector2(a+d,b));g.addPoint(new qlib.Vector2(a+d,b+c));g.addPoint(new qlib.Vector2(a,b+c));g.closed=!0;return g};f.fromString=function(a){var b=new qlib.MixedPath;a=a.split(";");b.closed="closed"==a[0];a=a[1].split(",");for(var d,c,g=0;g<a.length;g++)d=a[g].split("|"),c=new qlib.Vector2(parseFloat(d[0]),parseFloat(d[1])),3==d.length?b.addControlPoint(c,!1):
b.addPoint(c,!1);b.updateSegments();return b};c.type="MixedPath";c.initialize=function(a){this.points=[];this.segments=[];this.isValid=this._closed=!1;this.dirty=!0};c.addPoint=function(a,b){this.dirty=!0;a=new qlib.MixedPathPoint(a,!1);this.points.push(a);b&&this.updateSegments();return a};c.addControlPoint=function(a,b){this.dirty=!0;a=new qlib.MixedPathPoint(a,!0);this.points.push(a);b&&this.updateSegments();return a};c.insertPointAt=function(a,b,d){this.dirty=!0;a=new qlib.MixedPathPoint(a,!1);
this.points.splice(b,0,a);d&&this.updateSegments();return a};c.insertControlPointAt=function(a,b,d){this.dirty=!0;a=new qlib.MixedPathPoint(a,!0);this.points.splice(b,0,a);d&&this.updateSegments();return a};c.deletePoint=function(a){for(var b=this.points.length;-1<--b;)if(this.points[b]==a)return this.points.splice(b,1),this.updateSegments();return this.isValid};c.deletePointAt=function(a){if(a!=this.points.length)return this.isValid;this.points.splice(a,1);return this.updateSegments()};c.fixIndex=
function(a){return(a%this.points.length+this.points.length)%this.points.length|0};c.getPointAt=function(a){return this.points[this.fixIndex(a)]};c.getIndexOfPoint=function(a){return this.points.indexOf(a)};c.updatePointAt=function(a,b){this.points[this.fixIndex(a)]=b;return this.updateSegments()};c.__defineGetter__("centroid",function(){return this.toLinearPath(3).centroid});c.__defineGetter__("length",function(){this.dirty&&this.updateSegments();for(var a=0,b=this.segments.length;-1<--b;)a+=this.segments[b].length;
return a});c.__defineGetter__("closed",function(){return this._closed});c.__defineSetter__("closed",function(a){this._closed=a;return this.updateSegments()});c.__defineGetter__("cornerCount",function(){return this.dirty&&!this.updateSegments()?0:this.segments.length+(this._closed?0:1)});c.__defineGetter__("segmentCount",function(){return this.dirty&&!this.updateSegments()?0:this.segments.length});c.__defineGetter__("pointCount",function(){return this.points.length});c.getPoint=function(a){this.dirty&&
this.updateSegments();a=a||0;if(!this.isValid||!this._closed&&(0>a||1<a))return null;this._closed?a=(a%1+1)%1:1<a?a=1:0>a&&(a=0);for(var b=0,d=0;d<this.segments.length;d++){if(a<=this.t_toSegments[d])return a=0!=this.t_toSegments[d]-b?(a-b)/(this.t_toSegments[d]-b):0,this.segments[d].getPoint(a);b=this.t_toSegments[d]}return null};c.getNormalAt=function(a,b){this.dirty&&this.updateSegments();if(!this.isValid||!this._closed&&(0>a||1<a))return null;this._closed?a=(a%1+1)%1:1<a?a=1:0>a&&(a=0);for(var d=
0,c=0;c<this.segments.length;c++){if(a<=this.t_toSegments[c])return d=0!=this.t_toSegments[c]-d?(a-d)/(this.t_toSegments[c]-d):0,this.segments[c].getNormalAt(d);d=this.t_toSegments[c]}return null};c.getPointAt_offset=function(a){this.dirty&&this.updateSegments();if(!this.isValid||!this._closed&&(0>a||a>this.totalLength))return null;a=(a%this.totalLength+this.totalLength)%this.totalLength;for(var b=0,d=0;d<this.segments.length;d++){if(a<=length_toSegments[d])return this.segments[d].getPointAtOffset(a-
b);b=length_toSegments[d]}return null};c.line2Bezier3=function(a,b){for(var d,c=0;c<this.points.length;c++)if(this.points[c]==a){if(this.points[c].isControlPoint||this.points[c+1].isControlPoint||this.points[c+1]!=b)return null;d=c;break}else if(this.points[c]==b){if(this.points[c].isControlPoint||this.points[c+1].isControlPoint||this.points[c+1]!=a)return null;d=c;break}this.points.splice(d+1,0,new qlib.MixedPathPoint(this.points[d].getLerp(this.points[d+1],.333),!0),new qlib.MixedPathPoint(this.points[d].getLerp(this.points[d+
1],.666),!0));this.updateSegments();return[this.points[d+1],this.points[d+2]]};c.hasPoint=function(a){for(var b=this.points.length;-1<--b;)if(a.squaredDistanceToVector(this.points[b])<SNAP_DISTANCE*SNAP_DISTANCE)return!0;return!1};c.isValidPath=function(){if(2>this.points.length)return!1;for(var a=0,b=this.points.length+(this._closed?1:0);-1<--b;)if(this.points[b%this.points.length].isControlPoint?a++:a=0,3==a)return!1;return!0};c.getClosestPathPoint=function(a){if(0==this.points.length)return null;
for(var b=this.points[0].squaredDistanceToVector(a),d,c=this.points.length;0<--c;)d=this.points[c].squaredDistanceToVector(a),d<b&&(b=d,closest=this.points[c]);return closest};c.getClosestCorner=function(a){if(0==this.points.length)return null;for(var b=this.getCorner(0),d=b.squaredDistanceToVector(a),c=b,g,e=this.cornerCount;0<--e;)b=this.getCorner(e),g=b.squaredDistanceToVector(a),g<d&&(d=g,c=b);return c};c.getNeighbours=function(a){for(var b=[],d=0;d<this.points.length;d++)if(this.points[d]==a)return 0<
d-1&&(this.points[d-1].isControlPoint||b.push(this.points[d-1])),d+1<this.points.length&&(this.points[d+1].isControlPoint||b.push(this.points[d+1])),b;return null};c.getClosestPoint=function(a){this.dirty&&this.updateSegments();for(var b=this.segments[0].getClosestPoint(a),d=b.squaredDistanceToVector(a),c,g,e=1;e<this.segments.length;e++)g=this.segments[e].getClosestPoint(a),c=g.squaredDistanceToVector(a),c<d&&(d=c,b=g);return b};c.getClosestT=function(a){this.dirty&&this.updateSegments();for(var b=
this.segments[0].getClosestPoint(a).squaredDistanceToVector(a),d=0,c,g=1;g<this.segments.length;g++)c=this.segments[g].getClosestPoint(a),c=c.squaredDistanceToVector(a),c<b&&(b=c,d=g);a=this.segments[d].getClosestT(a);b=0<d?this.t_toSegments[d-1]:0;return a=b+a*(this.t_toSegments[d]-b)};c.updateSegments=function(){this.dirty=!1;this.segments=[];if(!(this.isValid=this.isValidPath()))return!1;for(var a=this.points.length+(this._closed?0:-1),b=0;this.points[b].isControlPoint;)b++;var d=this.points[b],
c=[];for(c.push(d);0<a;){b++;d=this.points[b%this.points.length];c.push(d);if(!d.isControlPoint)switch(c.length){case 2:c[0].snaps(c[1])&&2!=this.points.length||this.segments.push(new qlib.LineSegment(c[0],c[1]));c.shift();break;case 3:this.segments.push(new qlib.Bezier2(c[0],c[1],c[2]));c.shift();c.shift();break;case 4:this.segments.push(new qlib.Bezier3(c[0],c[1],c[2],c[3])),c.shift(),c.shift(),c.shift()}a--}this.updateLookupTables();return!0};c.getAngleAtCorner=function(a){if(this.dirty&&!this.updateSegments())return 0;
var b;if(this._closed)b=this.segments[(a+this.segments.length-1)%this.segments.length];else{if(0==a||a==this.segments.length)return 0;b=this.segments[a-1]}a=this.segments[a];var d,c,g;"LineSegment"==b.type?(d=b.p1,c=b.p2):"Bezier2"==b.type?(d=b.c,c=b.p2):"Bezier3"==b.type&&(d=b.c2,c=b.p2);"LineSegment"==a.type?g=a.p2:"Bezier2"==a.type?g=a.c:"Bezier3"==a.type&&(g=a.c1);return c.cornerAngle(g,d)};c.getCorner=function(a){if(this.dirty&&!this.updateSegments())return null;if(this._closed)a=(a%cornerCount+
cornerCount)%cornerCount;else if(0>a)a=0;else if(a>=cornerCount)return this.segments[this.segments.length-1].p2;return this.segments[a].p1};c.getSegment=function(a){if(this.dirty&&!this.updateSegments())return null;a%=this.segments.length;0>a&&(a+=this.segments.length);return this.segments[a]};c.toLinearPath=function(a,b){if(this.dirty&&!this.updateSegments())return null;var d=new qlib.LinearPath,c=this.length;if(0==c)return d;var g=c/a,e,p=0;b=b||f.LINEARIZE_APPROXIMATE;if(b!=f.LINEARIZE_APPROXIMATE){var u=
g*a;e=u/c/g;b==f.LINEARIZE_CENTER&&(p=.5*(1-u/c))}else e=0<g?1/g:c;b==f.LINEARIZE_CENTER&&0!=p&&d.addPoint(this.getPoint(0));for(c=0;c<=g;c++)d.addPoint(this.getPoint(p+c*e));b==f.LINEARIZE_OVERSHOOT?(g=d.points[d.points.length-1],e=this.getPoint(1),d.addPoint(e.minus(g).newLength(a).plus(g))):(b==f.LINEARIZE_CENTER&&0!=p||b==f.LINEARIZE_COMPLETE&&1!=(c-1)*e)&&d.addPoint(this.getPoint(1));this._closed&&d.addPoint(this.segments[0].getPoint(0));return d};c.toPolygon=function(a){if(this.dirty&&!this.updateSegments())return null;
var b=new qlib.Polygon,d,c,g,e;a=a||3;for(var f=0;f<this.segments.length;f++)if(d=this.segments[f],"LineSegment"==d.type)b.addPoint(d.p1.clone());else for(g=d.length/a,g--,e=0;e<g;e+=1)c=e/g,b.addPoint(d.getPoint(c));return b};c.getBoundingRect=function(a){if(this.dirty&&!this.updateSegments())return null;var b,d,c;null==a&&(a=!0);if(a){if(0==this.segments.length)return null;var g=this.segments[0];b=g.getBoundingRect();for(a=1;a<this.segments.length;a++)b=b.union(this.segments[a].getBoundingRect())}else{var e=
this.segments[0].getPoint(0).clone(),f=this.segments[0].getPoint(0).clone();for(a=0;a<this.segments.length;a++)if(g=this.segments[a],"LineSegment"==g.type)c=g.getPoint(0),e.min(c),f.max(c),c=g.getPoint(1),e.min(c),f.max(c);else for(d=g.length/1,d--,b=0;b<d;b+=1)c=g.getPoint(b/d),e.min(c),f.max(c);f.minus(e);return new qlib.Rectangle(e.x,e.y,f.x,f.y)}return b};c.translate=function(a){for(var b=this.points,d=b.length;-1<--d;)b[d].plus(a);return this};c.rotate=function(a,b){null==b&&(b=this.centroid);
for(var d=this.points,c=d.length;-1<--c;)d[c].rotateAround(a,b);return this};c.scale=function(a,b,d){null==d&&(d=this.centroid);for(var c=this.points,g=c.length;-1<--g;)c[g].minus(d).multiplyXY(a,b).plus(d);this.dirty=!0;return this};c.getNormalAtPoint=function(a){return this.toLinearPath(1).getNormalAtPoint(a)};c.updateLookupTables=function(){this.t_toSegments=[];this.length_toSegments=[];for(var a=this.totalLength=0;a<this.segments.length;a++)this.totalLength+=this.segments[a].length,this.length_toSegments[a]=
this.totalLength;for(a=this.segments.length;-1<--a;)this.t_toSegments[a]=this.length_toSegments[a]/this.totalLength};c.appendPath=function(a){this.points=this.points.concat(a.points);this.dirty=!0};c.isInside=function(a,b){var d=this.getBoundingRect(!0);return 0!=(new qlib.LineSegment(a,new qlib.Vector2(d.x-1,d.y-1))).intersect(this).points.length%2};c.clone=function(a){null==a&&(a=!0);for(var b=new qlib.MixedPath,d=0;d<this.points.length;d++)a?b.points.push(new qlib.MixedPathPoint(new qlib.Vector2(this.points[d].x,
this.points[d].y),this.points[d].isControlPoint)):b.points.push(this.points[d]);b.closed=this._closed;b.updateSegments();return b};c.shiftStartCorner=function(a){if(this._closed&&this.isValid){var b;if(0<a)for(;0<a;)b=this.points.shift(),this.points.push(b),b.isControlPoint||a--;else for(;0>a;)b=this.points.pop(),this.points.unshift(b),b.isControlPoint||a++;this.updateSegments()}};c.getSplitAtT=function(a,b){null==b&&(b=!0);var d=[];if(0>=a||1<=a)return d;this.dirty&&this.updateSegments();if(!this.isValid)return d;
for(var c=new qlib.MixedPath,g=new qlib.MixedPath,e=0,f=0;f<this.segments.length;f++){if(a<=this.t_toSegments[f]){e=0!=this.t_toSegments[f]-e?(a-e)/(this.t_toSegments[f]-e):0;0==e?(c.addPoint(b?this.segments[f].p1.clone():this.segments[f].p1),g.addPoint(b?this.segments[f].p1.clone():this.segments[f].p1),"Bezier2"==this.segments[f].type?g.addControlPoint(b?this.segments[f].c.clone():Bezier2(this.segments[f]).c):"Bezier3"==this.segments[f].type&&(g.addControlPoint(b?this.segments[f].c1.clone():this.segments[f].c1),
g.addControlPoint(b?this.segments[f].c2.clone():this.segments[f].c2)),g.addPoint(b?this.segments[f].p2.clone():this.segments[f].p2)):1==e?(c.addPoint(b?this.segments[f].p1.clone():this.segments[f].p1),"Bezier2"==this.segments[f].type?c.addControlPoint(b?this.segments[f].c.clone():this.segments[f].c):"Bezier3"==this.segments[f].type&&(c.addControlPoint(b?this.segments[f].c1.clone():this.segments[f].c1),c.addControlPoint(b?this.segments[f].c2.clone():this.segments[f].c2)),c.addPoint(b?this.segments[f].p2.clone():
this.segments[f].p2),g.addPoint(b?this.segments[f].p2.clone():this.segments[f].p2)):"LineSegment"==this.segments[f].type?(e=this.segments[f].getSplitAtT(e,b),c.addPoint(e[0].p1),c.addPoint(e[0].p2),g.addPoint(e[1].p1),g.addPoint(e[1].p2)):"Bezier2"==this.segments[f].type?(e=this.segments[f].getSplitAtT(e,b),c.addPoint(e[0].p1),c.addControlPoint(e[0].c),c.addPoint(e[0].p2),g.addPoint(e[1].p1),g.addControlPoint(e[1].c),g.addPoint(e[1].p2)):"Bezier3"==this.segments[f].type&&(e=this.segments[f].getSplitAtT(e,
b),c.addPoint(e[0].p1),c.addControlPoint(e[0].c1),c.addControlPoint(e[0].c2),c.addPoint(e[0].p2),g.addPoint(e[1].p1),g.addControlPoint(e[1].c1),g.addControlPoint(e[1].c2),g.addControlPoint(e[1].p2));for(;++f<this.segments.length;)"Bezier2"==this.segments[f].type?g.addControlPoint(b?this.segments[f].c.clone():this.segments[f].c):"Bezier3"==this.segments[f].type&&(g.addControlPoint(b?this.segments[f].c1.clone():this.segments[f].c1),g.addControlPoint(b?this.segments[f].c2.clone():this.segments[f].c2)),
g.addPoint(b?this.segments[f].p2.clone():this.segments[f].p2);c.closed=!1;g.closed=!1;d.push(c,g);break}else c.addPoint(b?this.segments[f].p1.clone():this.segments[f].p1),"Bezier2"==this.segments[f].type?c.addControlPoint(b?this.segments[f].c.clone():this.segments[f].c):"Bezier3"==this.segments[f].type&&(c.addControlPoint(b?this.segments[f].c1.clone():this.segments[f].c1),c.addControlPoint(b?this.segments[f].c2.clone():this.segments[f].c2));e=this.t_toSegments[f]}return d};c.draw=function(a,b){this.dirty&&
this.updateSegments();if(this.isValid){this.segments[0].moveToStart(a,b);for(var d=0;d<this.segments.length;d++)this.segments[d].drawTo(a,b)}};c.drawExtras=function(a,b,d){this.dirty&&this.updateSegments();if(this.isValid)for(var c=0;c<this.segments.length;c++)"LineSegment"!=this.segments[c].type&&this.segments[c].drawExtras(a,b||1,d);for(c=0;c<this.points.length;c++)this.points[c].isControlPoint?this.points[c].drawCircle(a,3,d):this.points[c].drawRect(a,3,d)};c.exportDraw=function(a){this.dirty&&
this.updateSegments();if(this.isValid){this.segments[0].exportMoveToStart(a);for(var b=0;b<this.segments.length;b++)this.segments[b].exportDrawTo(a)}};c.getSplitsAtTs=function(a,b){null==b&&(b=!0);a.sort(function(a,b){return a<b?-1:a>b?1:0});for(var d=this,c=0,g=[],e=0;e<a.length;e++){var f=d.getSplitAtT((a[e]-c)/(1-c),b);0<f.length&&(g.push(f[0]),d=2==f.length?f[1]:f[0]);c=a[e]}2==f.length&&g.push(f[1]);this._closed&&1<g.length&&(d=g.shift(),g[g.length-1].appendPath(d));return g};c.getSplitAtT=function(a,
b){null==b&&(b=!0);var d=[];if(0>=a||1<=a)return d;this.dirty&&this.updateSegments();if(!this.isValid)return d;for(var c=new qlib.MixedPath,g=new qlib.MixedPath,e=0,f=0;f<this.segments.length;f++){if(a<=this.t_toSegments[f]){e=0!=this.t_toSegments[f]-e?(a-e)/(this.t_toSegments[f]-e):0;0==e?"LineSegment"==this.segments[f].type?(c.addPoint(b?this.segments[f].p1.clone():this.segments[f].p1),g.addPoint(b?this.segments[f].p1.clone():this.segments[f].p1),g.addPoint(b?this.segments[f].p2.clone():this.segments[f].p2)):
"Bezier2"==this.segments[f].type?(c.addPoint(b?this.segments[f].p1.clone():this.segments[f].p1),g.addPoint(b?this.segments[f].p1.clone():this.segments[f].p1),g.addControlPoint(b?this.segments[f].c.clone():this.segments[f].c),g.addPoint(b?this.segments[f].p2.clone():this.segments[f].p2)):"Bezier3"==this.segments[f].type&&(c.addPoint(b?this.segments[f].p1.clone():this.segments[f].p1),g.addPoint(b?this.segments[f].p1.clone():this.segments[f].p1),g.addControlPoint(b?this.segments[f].c1.clone():this.segments[f].c1),
g.addControlPoint(b?this.segments[f].c2.clone():this.segments[f].c2),g.addPoint(b?this.segments[f].p2.clone():this.segments[f].p2)):1==e?"LineSegment"==this.segments[f].type?(c.addPoint(b?this.segments[f].p1.clone():LineSegment(this.segments[f]).p1),c.addPoint(b?this.segments[f].p2.clone():LineSegment(this.segments[f]).p2),g.addPoint(b?this.segments[f].p2.clone():LineSegment(this.segments[f]).p2)):"Bezier2"==this.segments[f].type?(c.addPoint(b?this.segments[f].p1.clone():this.segments[f].p1),c.addControlPoint(b?
this.segments[f].c.clone():this.segments[f].c),c.addPoint(b?this.segments[f].p2.clone():this.segments[f].p2),g.addPoint(b?this.segments[f].p2.clone():this.segments[f].p2)):"Bezier3"==this.segments[f].type&&(c.addPoint(b?this.segments[f].p1.clone():this.segments[f].p1),c.addControlPoint(b?this.segments[f].c1.clone():this.segments[f].c1),c.addControlPoint(b?this.segments[f].c2.clone():this.segments[f].c2),c.addPoint(b?this.segments[f].p2.clone():this.segments[f].p2),g.addPoint(b?this.segments[f].p2.clone():
this.segments[f].p2)):"LineSegment"==this.segments[f].type?(e=this.segments[f].getSplitAtT(e,b),c.addPoint(e[0].p1),c.addPoint(e[0].p2),g.addPoint(e[1].p1),g.addPoint(e[1].p2)):"Bezier2"==this.segments[f].type?(e=this.segments[f].getSplitAtT(e,b),c.addPoint(e[0].p1),c.addControlPoint(e[0].c),c.addPoint(e[0].p2),g.addPoint(e[1].p1),g.addControlPoint(e[1].c),g.addPoint(e[1].p2)):"Bezier3"==this.segments[f].type&&(e=this.segments[f].getSplitAtT(e,b),c.addPoint(e[0].p1),c.addControlPoint(e[0].c1),c.addControlPoint(e[0].c2),
c.addPoint(e[0].p2),g.addPoint(e[1].p1),g.addControlPoint(e[1].c1),g.addControlPoint(e[1].c2),g.addControlPoint(e[1].p2));for(;++f<this.segments.length;)"LineSegment"==this.segments[f].type?g.addPoint(b?this.segments[f].p2.clone():this.segments[f].p2):"Bezier2"==this.segments[f].type?(g.addControlPoint(b?this.segments[f].c.clone():this.segments[f].c),g.addPoint(b?this.segments[f].p2.clone():this.segments[f].p2)):"Bezier3"==this.segments[f].type&&(g.addControlPoint(b?this.segments[f].c1.clone():this.segments[f].c1),
g.addControlPoint(b?this.segments[f].c2.clone():this.segments[f].c2),g.addPoint(b?this.segments[f].p2.clone():this.segments[f].p2));c.closed=!1;g.closed=!1;d.push(c,g);break}else"LineSegment"==this.segments[f].type?c.addPoint(b?this.segments[f].p1.clone():this.segments[f].p1):"Bezier2"==this.segments[f].type?(c.addPoint(b?this.segments[f].p1.clone():this.segments[f].p1),c.addControlPoint(b?this.segments[f].c.clone():this.segments[f].c)):"Bezier3"==this.segments[f].type&&(c.addPoint(b?this.segments[f].p1.clone():
this.segments[f].p1),c.addControlPoint(b?this.segments[f].c1.clone():this.segments[f].c1),c.addControlPoint(b?this.segments[f].c2.clone():this.segments[f].c2));e=this.t_toSegments[f]}return d};c.toLinearPath=function(a,b){null==b&&(b=f.LINEARIZE_APPROXIMATE);this.dirty&&this.updateSegments();var d=new qlib.LinearPath,c=this.length;if(0==c)return d;var g=c/a,e,p=0;if(b!=f.LINEARIZE_APPROXIMATE){var u=g*a;e=u/c/g;b==f.LINEARIZE_CENTER&&(p=.5*(1-u/c))}else e=0<g?1/g:c;b==f.LINEARIZE_CENTER&&0!=p&&d.addPoint(this.getPoint(0));
for(c=0;c<=g;c++)d.addPoint(this.getPoint(p+c*e));b==f.LINEARIZE_OVERSHOOT?(g=d.points[d.points.length-1],e=this.getPoint(1),d.addPoint(e.minus(g).newLength(a).plus(g))):(b==f.LINEARIZE_CENTER&&0!=p||b==f.LINEARIZE_COMPLETE&&1!=(c-1)*e)&&d.addPoint(this.getPoint(1));this._closed&&d.addPoint(this.segments[0].getPoint(0));return d};c.getArea=function(a){return this.toPolygon(a||3).area};c.get_obb=function(a){return toPolygon(a||3).get_obb()};c.toString=function(){for(var a=[],b=0;b<this.points.length;b++)a[b]=
this.points[b].toString();return(this._closed?"closed":"open")+";"+a.join(",")};qlib.MixedPath=f})();window.qlib=window.qlib||{};(function(){var f=function(a,b){this.initialize(a,b)},c=f.prototype=new qlib.Vector2;c.type="MixedPathPoint";c.initialize=function(a,b){qlib.Vector2.prototype.initialize.call(this,[a]);this.isControlPoint=b||!1};c.toString=function(){return this.x+"|"+this.y+(this.isControlPoint?"|c":"")};qlib.MixedPathPoint=f})();window.qlib=window.qlib||{};
(function(){var f=function(a,b){this.initialize(a,b)},c=f.prototype;c.initialize=function(a,b){this.x=a||0;this.y=b||0;this.__defineGetter__("length",function(){return Math.sqrt(this.x*this.x+this.y*this.y)})};c.add=function(a){return new qlib.Point(this.x+a.x,this.y+a.y)};c.clone=function(){return new qlib.Point(this.x,this.y)};c.equals=function(a){return this.x==a.x&&this.y==a.y};c.normalize=function(a){a/=this.length;this.x*=a;this.y*=a};c.offset=function(a,b){this.x+=a;this.y+=b};c.subtract=function(a){return new qlib.Point(this.x-
a.x,this.y=a.y)};c.toString=function(){return"qlib.Point("+this.x+","+this.y+")"};f.distance=function(a,b){var d=p2.x-p1.x,c=p2.y-p1.y;return Math.sqrt(d*d+c*c)};f.interpolate=function(a,b,d){a=new qlib.Point;a.x=p1.x+d*(p2.x-p1.x);a.y=p1.y+d*(p2.y-p1.y);return a};f.polar=function(a,b){return new qlib.Point(a*Math.cos(b),a*Math.sin(b))};qlib.Point=f})();window.qlib=window.qlib||{};
(function(){var f=function(){this.initialize(arguments)},c=f.prototype=new qlib.GeometricShape;c.type="Polygon";f.NON_CONVEX_CCW="NON_CONVEX_CCW";f.NON_CONVEX_CW="NON_CONVEX_CW";f.NON_CONVEX_DEGENERATE="NON_CONVEX_DEGENERATE";f.CONVEX_DEGENERATE="CONVEX_DEGENERATE";f.CONVEX_CCW="CONVEX_CCW";f.CONVEX_CW="CONVEX_CW";f.CCW="CCW";f.CW="CW";f.DEGENERATE="DEGENERATE";f.CACHE_SIZE=200;f.SNAP_DISTANCE=1E-8;f.TREE_BALANCE_TRIGGER=20;f.fromArray=function(a,b){for(var d=new qlib.Polygon,c=0;c<a.length;c++)d.addPoint(b?
a[c].getClone():a[c]);return d};f.fromRectangle=function(a){return f.fromArray([new qlib.Vector2(a.x,a.y),new qlib.Vector2(a.x+a.width,a.y),new qlib.Vector2(a.x+a.width,a.y+a.height),new qlib.Vector2(a.x,a.y+a.height)])};f.getRectangle=function(a,b,d,c){return f.fromArray([new qlib.Vector2(a,b),new qlib.Vector2(a+d,b),new qlib.Vector2(a+d,b+c),new qlib.Vector2(a,b+c)])};f.getRegularPolygon=function(a,b,d,c){var g=2*Math.PI/b;a=.5*a/Math.sin(.5*g);null==d&&(d=new qlib.Vector2);c=c||0;for(var e=[],
p=0;p<b;p++)e.push(new qlib.Vector2(d.x+a*Math.cos(c+p*g),d.y+a*Math.sin(c+p*g)));return f.fromArray(e)};f.getCircle=function(a,b,d){return(new qlib.Circle(a,b)).toPolygon(d||2)};f.getRegularCenteredPolygon=function(a,b,d,c){var g=2*Math.PI/b;null==d&&(d=new qlib.Vector2);c=c||0;for(var e=[],p=0;p<b;p++)e.push(new qlib.Vector2(d.x+a*Math.cos(c+p*g),d.y+a*Math.sin(c+p*g)));return f.fromArray(e)};f.getCenteredStar=function(a,b,d,c,g){d*=2;var e=2*Math.PI/d;null==c&&(c=new qlib.Vector2);g=g||0;for(var p=
[],u=0;u<d;u++){var k=0==u%2?a:b;p.push(new qlib.Vector2(c.x+k*Math.cos(g+u*e),c.y+k*Math.sin(g+u*e)))}return f.fromArray(p)};c.initialize=function(){this.points=[];this.tree=new qlib.KDTree([],this.treeDistance,["x","y"])};c.addSegment=function(a){this.addPoint(a.p1);this.addPoint(a.p2)};c.addPoint=function(a){if(null!=a)return this.dirty=!0,this.points.push(a),this.tree.insert(a),this.rebalanceTree(),a};c.treeDistance=function(a,b){var d;return(d=a.x-b.x)*d+(d=a.y-b.y)*d};c.fixIndex=function(a){return(a%
this.points.length+this.points.length)%this.points.length|0};c.addPointAt=function(a,b){if(null!=b)return this.dirty=!0,a=this.fixIndex(a),this.points.splice(a+1,0,b),this.tree.insert(b),this.rebalanceTree(),b};c.removePointAt=function(a){this.dirty=!0;a=this.fixIndex(a);var b=this.points[a];this.tree.remove(b);this.points.splice(a,1);this.rebalanceTree();return b};c.updatePointInTreeAt=function(a){a=this.getPointAt(a);this.tree.remove(a);this.tree.insert(a);this.dirty=!0;this.rebalanceTree()};c.rebalanceTree=
function(){var a=this.tree.balanceFactor();a!=Number.POSITIVE_INFINITY&&a>f.TREE_BALANCE_TRIGGER&&(this.tree=new qlib.KDTree(this.points.concat(),this.treeDistance,["x","y"]))};c.getPointAt=function(a){return this.points[this.fixIndex(a)]};c.getPoint=function(a){if(0>=a||1==this.points.length)return this.points[0];if(1<=a)return this.points[this.points.length-1];this.dirty&&this.update();var b=this.t_cache[a*f.CACHE_SIZE|0];for(a=a*this.length-this.l_cache[a*f.CACHE_SIZE|0];a>this.distances[b++]&&
b<this.distances.length;)a-=this.distances[b-1];b--;return this.points[b].getLerp(this.points[(b+1)%this.pointCount],a/this.distances[b])};c.addPointAtClosestSide=function(a){2<this.points.length?this.addPointAt(this.getClosestSideIndex(a)+1,a):this.addPoint(a)};c.shiftIndices=function(a){a%=this.points.length;if(0!=a){var b;if(0<a)for(b=0;b<a;b++)this.points.unshift(this.points.pop());else for(b=0;b<-a;b++)this.points.push(this.points.shift())}};c.getNormalAtIndex=function(a,b){b=b||1;var d=this.getPointAt(a-
1),c=this.getPointAt(a),g=this.getPointAt(a+1);return g.getMinus(c).newLength(d.distanceToVector(c)).plus(c).lerp(d,.5).minus(c).newLength(-g.windingDirection(d,c)*b)};c.getNormalAt=function(a,b){0>=a?a=0:1<=a&&(a=1);this.dirty&&this.update();b=b||3;for(var d=this.t_cache[a*f.CACHE_SIZE|0],c=this.points[d].getClone(),g=this.points[d].getClone(),e=1,p=1,u=1;u<=b;u++)0<=d-u&&(c.plus(this.points[d-u]),e++),d+u<this.points.length&&(g.plus(this.points[d+u]),p++);c.multiply(1/e);g.multiply(1/p);return c.getMinus(g).normal()};
c.hasPoint=function(a){a=this.tree.nearest({x:a.x,y:a.y},1);return null!=a&&a[0][1]<f.SNAP_DISTANCE*f.SNAP_DISTANCE};c.getIndexOfCorner=function(a){return this.points.indexOf(a)};c.__defineGetter__("area",function(){for(var a=0,b,d,c=0;c<this.points.length;c++)b=this.points[c],d=this.points[(c+1)%this.points.length],a+=b.x*d.y-d.x*b.y;return.5*a});c.__defineGetter__("centroid",function(){if(1==this.points.length)return this.points[0].getClone();if(2==this.points.length)return this.points[0].getLerp(this.points[1],
.5);for(var a=0,b=0,d=0,c,g,e,f=0;f<this.points.length;f++)c=this.points[f],g=this.points[(f+1)%this.points.length],d+=e=c.x*g.y-g.x*c.y,a+=(c.x+g.x)*e,b+=(c.y+g.y)*e;e=1/(3*d);return new qlib.Vector2(a*e,b*e)});c.getSplit=function(a,b){var d=this.pointCount;if(a<b)var c=a,g=b;else c=b,g=a;if(4>this.points.length||2>Math.abs(a-b)||(g+1)%d==c)return[];var e=this.points.concat(),d=f.fromArray(e.slice(c,g+1));e.splice(c+1,g-c-1);c=f.fromArray(e);return[d,c]};c.__defineGetter__("classification",function(){this.dirty&&
this.update();return this.__classification});c.__defineGetter__("selfIntersects",function(){this.dirty&&this.update();return this.__selfIntersects});c.__defineGetter__("length",function(){return this.circumference});c.__defineGetter__("circumference",function(){for(var a=0,b=0;b<this.points.length;b++)a+=this.getSide(b).length;return a});c.__defineGetter__("pointCount",function(){return this.points.length});c.__defineGetter__("windingDirection",function(){this.dirty&&this.update();return this.__windingDirection});
c.__defineGetter__("majorAngle",function(){for(var a=this.centroid,b=0,d=0,c=0,g=this.points.length;-1<--g;)var e=this.points[g],b=b+Math.pow(e.x-a.x,2),d=d+Math.pow(e.y-a.y,2),c=c+(e.x-a.x)*(e.y-a.y);a=2*c;c=b-d+Math.sqrt(Math.pow(b-d,2)+Math.pow(2*c,2));return 0==a&&0==c?b>=d?0:.5*Math.PI:Math.atan2(a,c)});c.clone=function(a){null==a&&(a=!0);if(a){a=[];for(var b=0;b<this.points.length;b++)a.push(this.points[b].getClone());return f.fromArray(a)}return f.fromArray(this.points)};c.getPointAtOffset=
function(a){a%=1;0>a&&(a+=1);for(var b,d=this.circumference,c,g=0;g<this.points.length;g++)if(b=this.getSide(g),c=b.length/d,a>c)a-=c;else return b.getPoint(a/c);return null};c.getSide=function(a){a=this.fixIndex(a);return new qlib.LineSegment(this.points[a],this.points[(a+1)%this.points.length])};c.squaredDistanceToPoint=function(a){for(var b=this.getSide(0).getClosestPoint(a).squaredDistanceToVector(a),d,c=1;c<this.points.length;c++)d=this.getSide(c).getClosestPoint(a).squaredDistanceToVector(a),
d<b&&(b=d);return b};c.getClosestPoint=function(a){for(var b=this.getSide(0).getClosestPoint(a),d=b.squaredDistanceToVector(a),c,g,e=1;e<this.points.length;e++)g=this.getSide(e).getClosestPoint(a),c=g.squaredDistanceToVector(a),c<d&&(d=c,b=g);return b};c.distanceToVector2=function(a){for(var b=this.getSide(0).getClosestPoint(a).squaredDistanceToVector(a),d,c=1;c<this.points.length;c++)d=this.getSide(c).getClosestPoint(a),d=d.squaredDistanceToVector(a),d<b&&(b=d);return Math.sqrt(b)};c.getClosestCorner=
function(a){if(0==this.pointCount)return null;a=this.tree.nearest(a,1);return null!=a?a[0][0]:null};c.getClosestCornerIndex=function(a){if(0==this.pointCount)return-1;a=this.tree.nearest(a,1);return null!=a?this.getIndexOfCorner(a[0][0]):-1};c.subdivide=function(a){for(var b=0;b<this.points.length;b++){var d=this.points[b],c=this.points[(b+1)%this.points.length],g=d.distanceToVector(c);if(g>a)for(var e=g=1/Math.floor(g/a);1>e;)b++,this.points.splice(b,0,d.getLerp(c,e)),e+=g}this.dirty=!0};c.getClosestSideIndex=
function(a){for(var b=0,d=this.getSide(b).getClosestPoint(a).squaredDistanceToVector(a),c,g=1;g<this.points.length;g++)c=this.getSide(g).getClosestPoint(a),c=c.squaredDistanceToVector(a),c<d&&(d=c,b=g);return b};c.getClosestSide=function(a){return this.getSide(this.getClosestSideIndex(a))};c.getClosestConnectionToLine=function(a){var b=this.getSide(0).getShortestConnectionToLine(a),d;if(0==b.length)return b;for(var c=1;c<this.points.length;c++)if(d=this.getSide(c).getShortestConnectionToLine(a),d.length<
b.length){if(0==b.length)break;b=d}return b};c.distanceToLine=function(a){return this.getClosestConnectionToLine(a).length};c.getSmallestAngle=function(){for(var a=10,b,d=0;d<this.points.length;d++)b=this.getPointAt(d),b=(this.getPointAt(d-1).getMinus(b).angleBetween(this.getPointAt(d+1).getMinus(b))+2*Math.PI)%(2*Math.PI),b<a&&(a=b);return a};c.convexHull=function(a){return qlib.ConvexPolygon.fromArray(this.points,a)};c.getOffsetPolygon=function(a){for(var b=0<this.area?1:-1,d=new qlib.Polygon,c=
0;c<this.points.length;c++){var g=this.getNormalAtIndex(c,10),g=new qlib.LineSegment(this.points[c].getMinus(g),this.points[c].getPlus(g)),e=this.getSide(c).getParallel(-a*b),g=g.getIntersection(e);0<g.length&&d.addPoint(g[0])}return d};c.getDynamicOffsetPolygon=function(a,b){for(var d=new qlib.Polygon,c=this.length/a|0,g=0;g<c;g++){var e=g/c,f=getPoint(e),u=getNormalAt(e);u.multiply(b(e));d.addPoint(f.getPlus(u))}return d};c.getOffsetPolygons=function(a){var b=this.getOffsetPolygon(Math.abs(a));
a=this.getOffsetPolygon(-Math.abs(a));var c=[];c.push(b);Math.abs(b.area)<Math.abs(a.area)?c.push(a):c.unshift(a);return c};c.update=function(){this.__classification=this.updateClassification();switch(this.__classification){case f.CONVEX_DEGENERATE:case f.NON_CONVEX_DEGENERATE:this.__windingDirection=DEGENERATE;break;case f.CONVEX_CW:case f.NON_CONVEX_CW:this.__windingDirection=CW;break;case f.CONVEX_CCW:case f.NON_CONVEX_CCW:this.__windingDirection=CCW}this.__selfIntersects=this.updateSelfIntersection();
this.calculateIndex();this.dirty=!1};c.updateDistanceTree=function(){this.tree=new qlib.KDTree(this.points.concat(),this.treeDistance,["x","y"])};c.updateClassification=function(){var a,b,c=0,h=0,g=this.pointCount;if(3>this.points.length)return f.CONVEX_DEGENERATE;var e=0,p=this.points[e++],u=this.points[e++],k;for(a=p.compare(u);e<g+2;){k=this.points[e%this.points.length];(b=u.compare(k))==-a&&++c;a=b;if(b=k.windingDirection(p,u)){if(h==-b)return 0<area?f.NON_CONVEX_CCW:f.NON_CONVEX_CW;h=b}p=u;u=
k;e++}return 2<c?h?0<area?f.NON_CONVEX_CCW:f.NON_CONVEX_CW:f.NON_CONVEX_DEGENERATE:0<h?f.CONVEX_CCW:0>h?f.CONVEX_CW:f.CONVEX_DEGENERATE};c.updateSelfIntersection=function(){if(4>this.points.length)return!1;for(var a=this.pointCount,b,c=0;c<a-2;c++){b=this.getSide(c);for(var h=c+2;h<a;h++)if((h+1)%a!=c&&b.crosses(this.getSide(h)))return{lowerIndex:Math.min(c,h),upperIndex:Math.max(c,h),self_intersects:!0}}return!1};c.calculateDistanceIndex=function(){this.distances=[];for(var a=0;a<this.pointCount;a++)this.distances[a]=
this.getSide(a).length};c.calculateIndex=function(){this.t_cache=[];this.l_cache=[];var a=0;this.calculateDistanceIndex();for(var b=0,c=-1,h=0,g=0,e=0;e<this.pointCount;e++){b=f.CACHE_SIZE*a/this.length|0;if(b!=c){if(1<b-c)for(h=this.t_cache[c],g=this.l_cache[c];1<b-c;)this.t_cache[++c]=h,this.l_cache[c]=g;this.t_cache[b]=e;this.l_cache[b]=a;c=b}a+=this.distances[e]}for(;b<f.CACHE_SIZE;)this.t_cache[++b]=h,this.l_cache[b]=g};c.joinNeighbors=function(a){a=a||1;a*=a;for(var b=0;b<this.points.length;b++)this.points[b].snaps(this.points[(b+
1)%this.points.length],a)&&(this.points[b].lerp(this.points[(b+1)%this.points.length],.5),this.points.splice((b+1)%this.points.length,1),b--,this.dirty=!0)};c.getBoundingRect=function(){for(var a=this.points[0],b=a.x,c=b,h=a.y,g=h,e=1;e<this.points.length;e++)a=this.points[e],a.x<b?b=a.x:a.x>c&&(c=a.x),a.y<h?h=a.y:a.y>g&&(g=a.y);return new qlib.Rectangle(b,h,c-b,g-h)};c.isInside=function(a,b){if(3>this.points.length)return!1;null==b&&(b=!0);if(hasPoint(a)||this.getClosestPoint(a).squaredDistanceToVector(a)<
f.SNAP_DISTANCE*f.SNAP_DISTANCE)return b;var c,h=this.points.length,g=this.points.concat();g.push(g[0]);var e=0,h=g.length-1;for(c=0;c<h;c++)(g[c].y<=a.y&&g[c+1].y>a.y||g[c].y>a.y&&g[c+1].y<=a.y)&&a.x<g[c].x+(a.y-g[c].y)/(g[c+1].y-g[c].y)*(g[c+1].x-g[c].x)&&e++;return 0!=e%2};c.getLinearPathSegment=function(a,b,c){null==c&&(c=!0);b=this.fixIndex(b);var h=new qlib.LinearPath;for(a=this.fixIndex(a);a!=b;)h.addPoint(c?this.getPointAt(a).getClone():this.getPointAt(a)),a=(a+1)%this.pointCount;h.addPoint(c?
this.getPointAt(a).getClone():this.getPointAt(a));return h};c.invalidate=function(){this.dirty=!0};c.translate=function(a){for(var b=0;b<this.points.length;b++)this.points[b].plus(a);this.dirty=!0;return this};c.scale=function(a,b,c){null==c&&(c=this.centroid);for(var h=0;h<this.points.length;h++)this.points[h].minus(c).multiplyXY(a,b).plus(c);this.dirty=!0;return this};c.rotate=function(a,b){null==b&&(b=this.centroid);for(var c=0;c<this.points.length;c++)this.points[c].rotateAround(a,b);this.dirty=
!0;return this};c.getBoundingCircle=function(a){a=a||qlib.BoundingCircle.BOUNDINGCIRCLE_EXACT;switch(a){case qlib.BoundingCircle.BOUNDINGCIRCLE_SIMPLE:return qlib.BoundingCircle.boundingCircle1(this.points);case qlib.BoundingCircle.BOUNDINGCIRCLE_EFFICIENT:return qlib.BoundingCircle.boundingCircle2(this.points);case qlib.BoundingCircle.BOUNDINGCIRCLE_EXACT:return qlib.BoundingCircle.boundingCircle3(this.points)}return null};c.detangle=function(){for(var a=[],b=[],c,h,g;!1!=(h=this.selfIntersects);){a.length=
0;c=h.lowerIndex+1;h=h.upperIndex+1;for(g=c;g<h;g++)a.push(this.points[g%this.points.length]);b.length=0;for(g=h;g<this.points.length;g++)b.push(this.points[g]);for(g=0;g<c;g++)b.push(this.points[g]);b.reverse();for(g=0;g<b.length;g++)a.push(b[g]);if(this.points.length!=a.length)throw Error("wrong length");this.points=a.concat();this.dirty=!0}};c.cleanEdges=function(){var a,b,c;do for(a=!0,c=this.pointCount,b=0;b<c;b++)this.getPointAt(b).squaredDistanceToVector(this.getPointAt(b+1))<f.SNAP_DISTANCE*
f.SNAP_DISTANCE&&(this.points.splice(0==(b+1)%c?0:b,2),b=c,a=!1,this.dirty=!0);while(!a)};c.drawIntersectingEdges=function(a){var b;if(b=this.selfIntersects){this.getSide(b.lowerIndex).draw(a);this.getSide(b.upperIndex).draw(a);var c=b.lowerIndex+1;b=b.upperIndex;for(var h=0;h<this.points.length;h++)(h<c||h>b)&&this.getPointAt(h).draw(a,4)}};c.draw=function(a,b){if(0<this.points.length)if(null==b){a.moveTo(this.points[this.points.length-1].x,this.points[this.points.length-1].y);for(var c=0;c<this.points.length;c++)a.lineTo(this.points[c].x,
this.points[c].y)}else for(a.moveTo(this.points[this.points.length-1].x+b.x,this.points[this.points.length-1].y+b.y),c=0;c<this.points.length;c++)a.lineTo(this.points[c].x+b.x,this.points[c].y+b.y)};c.drawExtras=function(a,b,c){for(var h=0;h<this.points.length;h++)this.points[h].draw(a,b,c)};c.toMixedPath=function(a){for(var b=new qlib.MixedPath,c=0;c<this.points.length;c++)b.addPoint(a?points[c].getClone():points[c]);b.closed=!0;return b};c.getCopyOfPoints=function(a){if(a){a=[];for(var b=0;b<points.length;b++)a[b]=
points[b].getClone();return a}return points.concat()};c.setPoints=function(a){this.points=a;this.tree=new qlib.KDTree(this.points.concat(),this.treeDistance,["x","y"]);this.dirty=!0};c.getAngleAt=function(a){return this.getPointAt(a).cornerAngle(this.getPointAt(a-1),this.getPointAt(a+1))};c.reflect=function(a){for(var b=0;b<this.points.length;b++)this.points[b]=a.mirrorPoint(this.points[b]);this.dirty=!0;return this};c.getSlices=function(a){for(var b=[],c=[],h=[],g,e=0;e<this.pointCount;e++)g=this.getSide(e),
g=g.getIntersection(a,!0,!1),1==g.length?(c.push(g[0]),h.push(e)):2==g.length&&(c.push(g[0]),h.push(e),c.push(g[1]),h.push(e));for(;2<c.length;){a=Number.MAX_VALUE;g=-1;for(var f,u,e=c.length;0<--e;){u=c[e];for(var k=e;-1<--k;)f=u.squaredDistanceToVector(c[k]),f<a&&(a=f,g=k)}c.splice(g,1);h.splice(g,1)}if(2==c.length){a=new qlib.Polygon;a.addPoint(c[0]);for(e=h[0]+1;e<h[1];e++)a.addPoint(points[e]);a.addPoint(points[e%points.length]);a.addPoint(c[1]);2<a.pointCount&&b.push(a);a=new qlib.Polygon;a.addPoint(c[1]);
for(e=(h[1]+1)%points.length;e!=h[0];e=(e+1)%points.length)a.addPoint(points[e]);a.addPoint(points[e]);a.addPoint(c[0]);2<a.pointCount&&b.push(a)}else b.push(this);return b};c.getInsidePoint=function(){if(3==this.pointCount)return this.centroid;for(var a=0;a<this.pointCount;a++){var b=(new qlib.Triangle(this.getPointAt(a),this.getPointAt(a+1),this.getPointAt(a+2))).centerOfMass;if(this.isInside(b,!1))return b}return null};c.getBarycentricWeights=function(a){for(var b=0,c=[],h=this.points[this.points.length-
1],g=this.points[0],e=h.x-g.x,f=h.y-g.y,h=0;h<this.points.length;h++){var u=a.x-g.x,k=a.y-g.y,l=e*k-f*u;0>l&&(l*=-1);var e=(e*u+f*k)/l,l=this.points[(h+1)%this.points.length],m=l.x-g.x,f=l.y-g.y,g=m*k-f*u;0>g&&(g*=-1);c[h]=(e+(m*u+f*k)/g)/(u*u+k*k);b+=c[h];g=l;e=-m;f=-f}b=1/b;for(h=0;h<this.points.length;h++)c[h]*=b;return c};c.reverse=function(){this.oints.reverse();this.dirty=!0};c.get_obb=function(){var a=this.majorAngle,b=this.centroid,c,h,g,e,p;p=this.points[0].getRotateAround(-a,b);c=h=p.x;
g=e=p.y;for(var u=1;u<this.points.length;u++)p=this.points[u].getRotateAround(-a,b),p.x<c&&(c=p.x),p.x>h&&(h=p.x),p.y<g&&(g=p.y),p.y>e&&(e=p.y);c=new qlib.Rectangle(c,g,h-c,e-g);h=f.fromRectangle(c);h.rotate(a,centroid);return new qlib.OBB(c,b.getClone(),a,h)};c.toMultiResolutionPolygon=function(a,b){return new qlib.MultiresolutionPolygon(this,a||-1,b||0)};c.toArray=function(a){if(a){a=[];for(var b=0;b<this.points.length;b++)a[b]=this.points[b].clone();return a}return this.points.concat()};c.toString=
function(){return"Polygon.fromArray(["+this.points.toString()+"])"};c.padPointCount=function(a){var b=function(a,b,f){a>h&&(h=a,c=b);return!0};for(this.calculateDistanceIndex();points.length<a;){var c=-1,h=0;this.distances.every(b);this.distances[c]*=.5;this.distances.splice(c+1,0,this.distances[c]);this.addPointAt(c+1,this.getPointAt(c).getLerp(this.getPointAt(c+1),.5))}};qlib.Polygon=f})();window.qlib=window.qlib||{};
(function(){var f=function(){};f.getSmoothPath=function(c,a,b){null==b&&(b=0);return qlib.LinearPath.fromArray(c.toArray(),!0).getSmoothPath(a,b,!0)};qlib.PolygonUtils=f})();window.qlib=window.qlib||{};
(function(){var f=function(){},c=f.prototype;c.calculate=function(a,b,c,h,g){var e;this.parentCircle=a;this.circleCount=Math.max(3,b);this.ratio=c;h=null==h?0:h;g=null==g?0:g;var f=Math.PI/b;e=Math.sin(f);var u=2*a.r,k=(1-e)/(1+e)*u,l=k+(u-k)/2;new qlib.Vector2;this.circles=[];var m=[],r;for(e=0;e<b;e++)r=2*f*e-h+g,m.push(new qlib.Vector2(Math.cos(r+f)*l,Math.sin(r+f)*l)),m.push(new qlib.Vector2(Math.cos(r)*u,Math.sin(r)*u)),m.push(new qlib.Vector2(Math.cos(r)*k,Math.sin(r)*k));this.inverter=new qlib.Vector2(a.r*
c*Math.cos(h),a.r*c*Math.sin(h));c=[];h=[];for(e=0;e<b;e++)g=this.invert(m[3*e]),f=this.invert(m[3*e+1]),u=this.invert(m[3*e+2]),c.push(f),h.push(u),this.circles.push(qlib.CircleUtils.from3Points(g,f,u));this.circles.push(qlib.CircleUtils.from3Points(c[0],c[1],c[2]));this.outerCircle=qlib.CircleUtils.from3Points(h[0],h[1],h[2]);b=a.r/this.outerCircle.r;for(e=0;e<this.circles.length;e++)m=this.circles[e],m.c.minus(this.outerCircle.c),m.c.multiply(b),m.r*=b,m.c.plus(a.c);this.outerCircle.r*=b;this.outerCircle.c.setValue(a.c)};
c.invert=function(a){var b=a.x-this.inverter.x;a=a.y-this.inverter.y;var c=b*b+a*a;0==c&&(c=1/Number.MAX_VALUE);return this.inverter.getPlus(new qlib.Vector2(b/c,a/c))};c.draw=function(a){for(var b=0;b<this.circles.length;b++)this.circles[b].draw(a)};c.toString=function(){return"SteinerCircles"};qlib.SteinerCircles=f})();window.qlib=window.qlib||{};
(function(){var f=function(){this.initialize(arguments)};f.getEquilateralTriangle=function(a,b,c){return new qlib.Triangle(a,b,new qlib.Vector2(a.getAddCartesian(a.getAngleTo(b)+Math.PI/3*(c?-1:1),a.distanceToVector(b))))};f.getCenteredTriangle=function(a,b,c,f,g){g=g||0;var e=-Math.acos((b*b-c*c+f*f)/(2*b*f));if(isNaN(e))return null;c=new qlib.Vector2(0,0);f=new qlib.Vector2(f,0);b=new qlib.Vector2(Math.cos(e)*b,Math.sin(e)*b);b=new qlib.Triangle(c,f,b);c=b.centerOfMass;0!=g&&b.rotate(g);b.translate(a.getMinus(c));
return b};var c=f.prototype=new qlib.GeometricShape;c.type="Triangle";c.initialize=function(a){var b=0;"number"==typeof a[0]?(this.p1=new qlib.Vector2(a[0],a[1]),b+=2):(this.p1=a[0],b++);"number"==typeof a[b]?(this.p2=new qlib.Vector2(a[b],a[b+1]),b+=2):(this.p2=a[b],b++);this.p3="number"==typeof a[b]?new qlib.Vector2(a[b],a[b+1]):a[b]};c.translate=function(a){this.p1.plus(a);this.p2.plus(a);this.p3.plus(a);return this};c.scale=function(a,b,c){null==c&&(c=this.incircleCenter());this.p1.minus(c).multiplyXY(a,
b).plus(c);this.p2.minus(c).multiplyXY(a,b).plus(c);this.p3.minus(c).multiplyXY(a,b).plus(c);return this};c.incircleCenter=function(){var a=this.p2.distanceToVector(this.p3),b=this.p1.distanceToVector(this.p3),c=this.p2.distanceToVector(this.p1),f=a+b+c;return new qlib.Vector2((a*this.p1.x+b*this.p2.x+c*this.p3.x)/f,(a*this.p1.y+b*this.p2.y+c*this.p3.y)/f)};c.centerOfMass=function(){return this.p1.getPlus(this.p2).plus(this.p3).divide(3)};c.getTouchingCornerCircles=function(){var a=this.getSideLength(0),
b=this.getSideLength(1),c=this.getSideLength(2);1E-7>Math.abs(a-b)&&(b=a);1E-7>Math.abs(a-c)&&(c=a);1E-7>Math.abs(b-c)&&(c=b);var f=[];f.push(new qlib.Circle(this.p1.clone(),.5*(b-c+a)));f.push(new qlib.Circle(this.p2.clone(),.5*(c-b+a)));f.push(new qlib.Circle(this.p3.clone(),.5*(b-a+c)));return f};c.getSide=function(a){switch(a){case 0:return new qlib.LineSegment(this.p1,this.p2);case 1:return new qlib.LineSegment(this.p1,this.p3);case 2:return new qlib.LineSegment(this.p2,this.p3)}return null};
c.getSideLength=function(a){switch(a){case 0:return this.p1.distanceToVector(this.p2);case 1:return this.p1.distanceToVector(this.p3);case 2:return this.p2.distanceToVector(this.p3)}return NaN};c.getBoundingCircle=function(){return qlib.CircleUtils.from3Points(this.p1,this.p2,this.p3)};c.getInnerPoint=function(a,b,c){return this.p1.getLerp(this.p2,a).plus(this.p2.getLerp(this.p3,b)).plus(this.p3.getLerp(this.p1,c)).multiply(1/3)};c.getClosestSide=function(a){var b=this.getSide(0),c=b.getClosestPoint(a),
f=a.squaredDistanceToVector(c),g=this.getSide(1),c=g.getClosestPoint(a),c=a.squaredDistanceToVector(c);c<f&&(f=c,b=g);g=this.getSide(2);c=g.getClosestPoint(a);c=a.squaredDistanceToVector(c);c<f&&(b=g);return b};c.getClosestPoint=function(a){var b=this.getSide(0).getClosestPoint(a),c=a.squaredDistanceToVector(b),f=this.getSide(1),g=f.getClosestPoint(a),f=a.squaredDistanceToVector(b);f<c&&(c=f);f=this.getSide(2);b=f.getClosestPoint(a);f=a.squaredDistanceToVector(b);f<c&&(b=g);return b};c.clone=function(a){return!0==
a?new qlib.Triangle(this.p1.clone(),this.p2.clone(),this.p2.clone()):new qlib.Triangle(this.p1,this.p2,this.p3)};c.moveToStart=function(a){a.moveTo(this.p1.x,this.p1.y)};c.draw=function(a){a.moveTo(this.p1.x,this.p1.y);a.lineTo(this.p2.x,this.p2.y);a.lineTo(this.p3.x,this.p3.y);a.lineTo(this.p1.x,this.p1.y)};c.toString=function(){return"Triangle"};qlib.Triangle=f})();window.qlib=window.qlib||{};
(function(){var f=function(){};f.getCenteredTriangle=function(c,a,b,d,f){f=null==f?f:0;var g=-Math.acos((a*a-b*b+d*d)/(2*a*d));if(isNaN(g))return null;b=new qlib.Vector2(0,0);d=new qlib.Vector2(d,0);a=new qlib.Vector2(Math.cos(g)*a,Math.sin(g)*a);a=new qlib.Triangle(b,d,a);b=a.centerOfMass();0!=f&&a.rotate(f);a.translate(c.getMinus(b));return a};f.getEquilateralTriangle=function(c,a,b){b=0==b?!1:b;return new qlib.Triangle(c,a,new qlib.Vector2(c.getAddCartesian(c.angleTo(a)+Math.PI/3*(b?-1:1),c.distanceToVector(a))))};
qlib.TriangleUtils=f})();window.qlib=window.qlib||{};
(function(){var f=function(){this.clear()},c=f.prototype;f.NUM_STANDARD_DEVIATIONS=1.7;f.fromArray=function(a,b){null==b&&(b=!1);var c=new qlib.Vector2Cloud;if(b)for(f=0;f<a.length;f++)c.accumulate(a[f].getClone());else for(var f=0;f<a.length;f++)c.accumulate(a[f]);return c};c.clear=function(){null==this.points?this.points=[]:this.points.length=0;this.sum=new qlib.Vector2;this._centroid=new qlib.Vector2;this.majorAngle=0;this.dirty=this.centroidDirty=!0;this.tree=new qlib.KDTree([],this.distance,
["x","y"]);this.treeDirty=!1};c.accumulate=function(a){this.treeDirty&&(this.tree=new qlib.KDTree(this.points,this.distance,["x","y"]),this.treeDirty=!1);this.points.push(a);this.sum.plus(a);this.tree.insert(a);this.dirty=this.centroidDirty=!0};c.distance=function(a,b){var c;return(c=a.x-b.x)*c+(c=a.y-b.y)*c};c.getPointCount=function(){return this.points.length};c.getCentroid=function(){0<this.points.length&&this.centroidDirty&&(this._centroid=this.sum.getDivide(this.points.length),this.centroidDirty=
!1);return this._centroid};c.compute_covariance_body=function(){if(0!=this.points.length&&this.dirty){this.covariance=new qlib.CovarianceMatrix2;for(var a=this.getCentroid(),b=0;b<this.points.length;b++){var c=this.points[b].getMinus(a);this.covariance.a+=c.x*c.x;this.covariance.b+=c.x*c.y;this.covariance.c+=c.y*c.y}a=2*this.covariance.b;b=this.covariance.a-this.covariance.c+Math.sqrt(Math.pow(this.covariance.a-this.covariance.c,2)+Math.pow(2*this.covariance.b,2));this.majorAngle=0==a&&0==b?this.covariance.a>=
this.covariance.c?0:.5*Math.PI:Math.atan2(a,b);this.covariance.scale(1/this.points.length);this.dirty=!1}};c.getMajorAngle=function(){this.dirty&&this.compute_covariance_body();return this.majorAngle};c.getObb=function(){var a=this.majorAngle,b=this.getCentroid(),c,f,g,e,p=this.points[0].getRotateAround(-a,b);c=f=p.x;g=e=p.y;for(var u=1;u<this.points.length;u++)p=this.points[u].getRotateAround(-a,b),p.x<c&&(c=p.x),p.x>f&&(f=p.x),p.y<g&&(g=p.y),p.y>e&&(e=p.y);b=ConvexPolygon.fromArray([new qlib.Vector2(c,
g),new qlib.Vector2(f,g),new qlib.Vector2(f,e),new qlib.Vector2(c,e)]);b.rotate(a,this.getCentroid());return b};c.getDensity=function(){return this.getObb().area/this.pointCount};c.getSplitClouds=function(a){var b=[];b.push(new qlib.Vector2Cloud,new qlib.Vector2Cloud);for(var c in this.points)b[0>this.points[c].isLeft(a.p1,a.p2)?0:1].accumulate(this.points[c]);return b};c.getClosestPoints=function(a,b,c){this.treeDirty&&(this.tree=new qlib.KDTree(this.points,this.distance,["x","y"]),this.treeDirty=
!1);a=this.tree.nearest(a,b,c);b=[];for(c=0;c<a.length;c++)b.push(a[c][0]);return b};c.drawCovarianceEllipse=function(a,b){this.dirty&&this.compute_covariance_body();null==b&&(b=f.NUM_STANDARD_DEVIATIONS);var c=[],h=[];this.covariance.find_eigenvectors(h,c);var g=Math.sqrt(Math.abs(h[0]))*b,e=Math.sqrt(Math.abs(h[1]))*b,h=c[0],c=c[1];h.multiply(g);c.multiply(e);var p=0,e=Math.cos(p),p=Math.sin(p),e=h.getMultiply(e).plus(c.getMultiply(p)).plus(this.getCentroid());a.moveTo(e.x,e.y);for(g=1;300>g;g++)p=
g/300*Math.PI*2,e=Math.cos(p),p=Math.sin(p),e=h.getMultiply(e).plus(c.getMultiply(p)).plus(this.getCentroid()),a.lineTo(e.x,e.y)};c.rotate=function(a,b){null==b&&(b=this.getCentroid());for(var c in this.points)this.points[c].rotateAround(a,b);this.centroidDirty=this.treeDirty=this.dirty=!0;return this};c.getBoundingRect=function(){if(0==this.points.length)return new qlib.Rectangle;var a,b,c,f;a=b=this.points[0].x;c=f=this.points[0].y;for(var g=0;g<this.points.length;g++){var e=this.points[g];e.x<
a&&(a=e.x);e.x>b&&(b=e.x);e.y<c&&(c=e.y);e.y>f&&(f=e.y)}return new qlib.Rectangle(a,c,b-a+1,f-c+1)};c.convexHull=function(){return qlib.ConvexPolygon.fromArray(this.points)};c.getInnerCloud=function(){for(var a=this.convexHull(),b=this.points.concat(),c=0;c<a.pointCount;c++)for(var f=a.getPointAt(c),g=0;g<b.length;g++)if(b[g]==f){b.splice(g,1);break}return qlib.Vector2Cloud.fromArray(b)};c.draw=function(a,b){for(var c=0;c<this.points.length;c++)this.points[c].draw(a,b)};c.clone=function(a){if(null==
a||a){a=[];for(var b=0;b<this.points.length;b++)a.push(this.points[b].getClone());return qlib.Vector2Cloud.fromArray(a)}return qlib.Vector2Cloud.fromArray(points)};qlib.Vector2Cloud=f})();window.qlib=window.qlib||{};
(function(){var f=function(){this.create(arguments)},c=f.prototype;c.x=0;c.y=0;c.z=0;f.create=function(a){var b=[0,0,0];a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]);return b};f.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};f.add=function(a,b,c){if(!c||a==c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c};f.subtract=function(a,b,c){if(!c||a==c)return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a;c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c};f.negate=
function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b};f.scale=function(a,b,c){if(!c||a==c)return a[0]*=b,a[1]*=b,a[2]*=b,a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c};f.normalize=function(a,b){b||(b=a);var c=a[0],f=a[1],g=a[2],e=Math.sqrt(c*c+f*f+g*g);if(!e)return b[0]=0,b[1]=0,b[2]=0,b;if(1==e)return b[0]=c,b[1]=f,b[2]=g,b;e=1/e;b[0]=c*e;b[1]=f*e;b[2]=g*e;return b};f.cross=function(a,b,c){c||(c=a);var f=a[0],g=a[1];a=a[2];var e=b[0],p=b[1];b=b[2];c[0]=g*b-a*p;c[1]=a*e-f*b;c[2]=f*p-
g*e;return c};f.length=function(a){var b=a[0],c=a[1];a=a[2];return Math.sqrt(b*b+c*c+a*a)};f.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};f.direction=function(a,b,c){c||(c=a);var f=a[0]-b[0],g=a[1]-b[1];a=a[2]-b[2];b=Math.sqrt(f*f+g*g+a*a);if(!b)return c[0]=0,c[1]=0,c[2]=0,c;b=1/b;c[0]=f*b;c[1]=g*b;c[2]=a*b;return c};f.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"};qlib.Vector3=f})();window.qlib=window.qlib||{};
(function(){var f=function(){this.create(arguments)},c=f.prototype;c.x=0;c.y=0;c.z=0;c.w=0;c.create=function(a,b,c,f){this.x=a|0;this.y=b|0;this.z=c|0;this.w=f|0};c.set=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this};c.add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this};c.subtract=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this};c.negate=function(){this.x*=-1;this.y*=-1;this.z*=-1;this.w*=-1;return this};c.scale=function(a){this.x*=
a;this.y*=a;this.z*=a;this.w*=a;return this};c.normalize=function(){var a=this.length;return a?1==a?this:this.scale(1/a):(this.x=this.y=this.z=this.w=0,this)};c.cross=function(a){return new qlib.Vector3D(this.y*v.z-this.z*v.y,this.z*v.x-this.x*v.z,this.x*v.y-this.y*v.x)};c.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};c.dot=function(a){return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w};c.direction=function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;var f=Math.sqrt(b*
b+c*c+a*a);if(!f)return this.x=this.y=this.z=this.w=0,this;f=1/f;this.x=b*f;this.y=c*f;this.z=a*f;return this};c.str=function(a){return"["+this.x+", "+this.y+", "+this.z+", "+this.w+"]"};qlib.Vector3D=f})();window.qlib=window.qlib||{};
(function(){var f=function(){this.reset()},c=f.prototype;c.reset=function(){this.a=this.b=this.c=0};c.invert=function(){var a=1/(this.a*this.c-this.b*this.b),b=new qlib.CovarianceMatrix2;b.a=this.c*a;b.b=-this.b*a;b.c=this.a*a;return b};c.add=function(a){var b=new qlib.CovarianceMatrix2;b.a=this.a+a.a;b.b=this.b+a.b;b.c=this.c+a.c;return b};c.scale=function(a){this.a*=a;this.b*=a;this.c*=a};c.rotate=function(a){var b=Math.sin(a);a=Math.cos(a);var c=-this.a*b*a+this.b*(a*a-b*b)+this.c*b*a,f=this.a*
b*b-2*this.b*b*a+this.c*a*a;this.a=this.a*a*a+2*this.b*b*a+this.c*b*b;this.b=c;this.c=f};c.solve_quadratic_where_discriminant_is_known_to_be_nonnegative=function(a,b,c){var f={num_solutions:0,solutions:[]};if(0==a){if(0==b)return f;f.solutions[0]=-c/b;f.num_solutions=1;return f}var g=b*b-4*a*c;0>g&&(g=0);var e=1;0>b&&(e=-1);var p=0;b=-.5*(b+e*Math.sqrt(g));p++;f.solutions[0]=b/a;0!=b&&(a=c/b,a!=f.solutions[0]&&(p++,f.solutions[1]=a));f.num_solutions=p;return f};c.find_eigenvalues=function(a){var b=
this.solve_quadratic_where_discriminant_is_known_to_be_nonnegative(1,-(this.a+this.c),this.a*this.c-this.b*this.b);1==b.num_solutions&&(b.solutions[1]=b.solutions[0],b.num_solutions=2);a[0]=b.solutions[0];a[1]=b.solutions[1];return b.num_solutions};c.find_eigenvectors=function(a,b){var c=this.find_eigenvalues(a);if(2!=c)throw"Did not get 2 Eigenvalues but "+c;var f=!1;if(1E-7>this.a)f=!0;else{var g=Math.abs(a[1]/a[0]);.9999<g&&1.0001>g&&(f=!0)}if(f)return a[0]=this.a,a[1]=this.a,b[0]=new qlib.Vector2(1,
0),b[1]=new qlib.Vector2(0,1),2;for(f=0;f<c;f++){var e=a[f],g=new qlib.Vector2(-this.b,this.a-e),e=new qlib.Vector2(-(this.c-e),this.b),g=g.getSquaredLength()>e.getSquaredLength()?g:e;g.normalize();b[f]=g}return c};c.move_to_global_coordinates=function(a,b,c){a.a=this.a+b*b;a.b=this.b+b*c;a.c=this.c+c*c};c.move_to_local_coordinates=function(a,b,c){a.a=this.a-b*b;a.b=this.b-b*c;a.c=this.c-c*c};qlib.CovarianceMatrix2=f})();window.qlib=window.qlib||{};
(function(){var f=function(a){this.initialize(a)},c=f.prototype;c.TOLERANCE=1E-6;c.ACCURACY=6;c.interpolate=function(a,b,c,f,g){for(var e=0,p=0,u=Array(c),k=Array(c),l=0,e=Math.abs(g-a[f]),m=0;m<c;m++){var r=Math.abs(g-a[f+m]);r<e&&(l=m,e=r);u[m]=k[m]=b[f+m]}e=b[f+l];l--;for(b=1;b<c;b++){for(m=0;m<c-b;m++){var p=a[f+m]-g,r=a[f+m+b]-g,q=p-r;if(0==q)break;q=(u[m+1]-k[m])/q;k[m]=r*q;u[m]=p*q}p=2*(l+1)<c-b?u[l+1]:k[l--];e+=p}return{y:e,dy:p}};c.initialize=function(a){this.coefs=a.concat().reverse();this.length=
this.coefs.length;this.degree=this.length-1};c.getRoots=function(){var a;this.simplify();switch(this.degree){case 0:a=[];break;case 1:a=this.getLinearRoot();break;case 2:a=this.getQuadraticRoots();break;case 3:a=this.getCubicRoots();break;case 4:a=this.getQuarticRoots();break;default:a=[]}return a};c.simplify=function(){for(var a=this.degree;0<=a;a--)if(Math.abs(this.coefs[a])<=this.TOLERANCE)this.coefs.pop(),this.length--,this.degree--;else break};c.getRootsInInterval=function(a,b){var c=[],f;if(1==
this.degree)f=this.bisection(a,b);else{var g=this.getDerivative().getRootsInInterval(a,b);if(0<g.length){f=this.bisection(a,g[0]);isNaN(f)||c.push(f);for(var e=0;e<=g.length-2;e++)f=this.bisection(g[e],g[e+1]),isNaN(f)||c.push(f);f=this.bisection(g[g.length-1],b)}else f=this.bisection(a,b)}isNaN(f)||c.push(f);return c};c.bisection=function(a,b){var c=this.evaluate(a),f=this.evaluate(b),g=NaN;if(Math.abs(c)<=this.TOLERANCE)g=a;else if(Math.abs(f)<=this.TOLERANCE)g=b;else if(0>=c*f)for(var f=Math.log(b-
a),f=Math.ceil((f+Math.LN10*this.ACCURACY)/Math.LN2),e=0;e<f;e++){var g=.5*(a+b),p=this.evaluate(g);if(Math.abs(p)<=this.TOLERANCE)break;0>p*c?b=g:(a=g,c=p)}return g};c.evaluate=function(a){if(isNaN(a))throw Error("Polynomial.evaluate: parameter must be a number");for(var b=0,c=this.length;-1<--c;)b=b*a+this.coefs[c];return b};c.getDerivative=function(){for(var a=new qlib.Polynomial([]),b=1;b<this.length;b++)a.coefs.push(b*this.coefs[b]);a.length=this.length-1;a.degree=this.length-2;return a};c.getLinearRoot=
function(){var a=[],b=this.coefs[1];0!=b&&a.push(-this.coefs[0]/b);return a};c.getQuadraticRoots=function(){var a=[];if(2==this.degree){var b=this.coefs[2],c=this.coefs[1]/b,b=c*c-this.coefs[0]/b*4;0<b?(b=Math.sqrt(b),a.push(.5*(-c+b)),a.push(.5*(-c-b))):0==b&&a.push(.5*-c)}return a};c.getCubicRoots=function(){var a,b=[];if(3==this.degree){var c=this.coefs[3],f=this.coefs[2]/c,g=this.coefs[1]/c;a=(3*g-f*f)/3;c=(2*f*f*f-9*g*f+this.coefs[0]/c*27)/27;f/=3;g=c*c/4+a*a*a/27;c/=2;Math.abs(g)<=this.TOLERANCE&&
(g=0);if(0<g){var g=Math.sqrt(g),e;a=-c+g;e=0<=a?Math.pow(a,1/3):-Math.pow(-a,1/3);a=-c-g;e=0<=a?e+Math.pow(a,1/3):e-Math.pow(-a,1/3);b.push(e-f)}else 0>g?(a=Math.sqrt(-a/3),g=Math.atan2(Math.sqrt(-g),-c)/3,c=Math.cos(g),g=Math.sin(g),e=Math.sqrt(3),b.push(2*a*c-f),b.push(-a*(c+e*g)-f),b.push(-a*(c-e*g)-f)):(a=0<=c?-Math.pow(c,1/3):Math.pow(-c,1/3),b.push(2*a-f),b.push(-a-f))}return b};c.getQuarticRoots=function(){var a,b,c,f=[];if(4==this.degree){var g=this.coefs[4],e=this.coefs[3]/g;a=this.coefs[2]/
g;c=this.coefs[1]/g;g=this.coefs[0]/g;b=(new qlib.Polynomial([1,-a,e*c-4*g,-e*e*g+4*a*g-c*c])).getCubicRoots()[0];var p=e*e/4-a+b;Math.abs(p)<=this.TOLERANCE&&(p=0);0<p?(g=Math.sqrt(p),b=.75*e*e-g*g-2*a,c=(4*e*a-8*c-e*e*e)/(4*g),a=b+c,c=b-c,Math.abs(a)<=this.TOLERANCE&&(a=0),Math.abs(c)<=this.TOLERANCE&&(c=0),0<=a&&(a=Math.sqrt(a),f.push(-.25*e+.5*(g+a)),f.push(-.25*e+.5*(g-a))),0<=c&&(a=Math.sqrt(c),f.push(-.25*e+.5*(a-g)),f.push(-.25*e-.5*(a+g)))):0>p?trace("ERROR IN getQuarticRoots - discrim: "+
p):(c=b*b-4*g,c>=-this.TOLERANCE&&(0>c&&(c=0),c=2*Math.sqrt(c),b=3*e*e/4-2*a,b+c>=this.TOLERANCE&&(a=Math.sqrt(b+c),f.push(-e/4+a/2),f.push(-e/4-a/2)),b-c>=this.TOLERANCE&&(a=Math.sqrt(b-c),f.push(-e/4+a/2),f.push(-e/4-a/2))))}return f};c.mult=function(a){var b=new qlib.Polynomial([]),c,f;for(c=0;c<=this.degree+a.degree;c++)b.coefs.push(0);for(c=0;c<=this.degree;c++)for(f=0;f<=a.degree;f++)b.coefs[c+f]+=this.coefs[c]*a.coefs[f];return b};c.divide_scalar=function(a){for(var b=0;b<this.length;b++)this.coefs[b]/=
a};qlib.Polynomial=f})();window.qlib=window.qlib||{};(function(){var f=function(){this.seed=1},c=f.prototype;c.next=function(){return this.gen()/2147483647};c.nextRange=function(a,b){return a+(b-a)*this.next()};c.gen=function(){return this.seed=16807*this.seed%2147483647};qlib.PRNG=f})();window.qlib=window.qlib||{};
(function(){var f=function(a){this.rand=a};f.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]];f.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],
[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]];f.F2=.5*(Math.sqrt(3)-1);f.G2=(3-Math.sqrt(3))/6;var c=f.prototype;c.setSeed=function(a){this.p=[];this.rand.seed=a;for(a=0;256>a;a++)this.p[a]=this.rand.nextRange(0,255)|0;this.perm=[];for(a=
0;512>a;a++)this.perm[a]=this.p[a&255]};c.noise=function(a,b){var c,h,g;g=(a+b)*f.F2;var e=a+g|0,p=b+g|0;g=(e+p)*f.G2;c=a-(e-g);var u=b-(p-g),k,l;c>u?(k=1,l=0):(k=0,l=1);h=c-k+f.G2;var m=u-l+f.G2;g=c-1+2*f.G2;var r=u-1+2*f.G2,q=e&255,p=p&255,e=f.grad3[this.perm[q+this.perm[p]]%12];k=f.grad3[this.perm[q+k+this.perm[p+l]]%12];l=f.grad3[this.perm[q+1+this.perm[p+1]]%12];q=.5-c*c-u*u;0>q?c=0:(q*=q,c=q*q*(e[0]*c+e[1]*u));u=.5-h*h-m*m;0>u?h=0:(u*=u,h=u*u*(k[0]*h+k[1]*m));m=.5-g*g-r*r;0>m?g=0:(m*=m,g=m*
m*(l[0]*g+l[1]*r));return 70*(c+h+g)};qlib.SimplexNoise=f})();window.qlib=window.qlib||{};
(function(){var f=function(){this.initialize(arguments)};f.colorScheme="#000 #888 #fff #fff #ff8000 #ffe000 #ffff00 #ffff00".split(" ");var c=null!=window.createjs?f.prototype=new createjs.Container:f.prototype;c.Container_initialize=c.initialize;c.initialize=function(a){this.Container_initialize();this.point=0==a.length?new qlib.Vector2:"number"==typeof a[0]?new qlib.Vector2(a[0],a[1]):a[0];this.grabber=null!=window.createjs?new createjs.Shape:{};this.addChild(this.grabber);this.HANDLE_SIZE=7;this.selected=
this.mouseIsOver=this.mouseIsDown=this.active=!1;this.x=this.point.x;this.y=this.point.y;this.cursor="pointer";this.updateGrabber()};c.setActive=function(a){(this.active=a)?(this.addEventListener("mousedown",function(a){var c=a.target;c.mouseIsDown=!0;c.updateGrabber();var f=c.x-a.stageX,g=c.y-a.stageY;a.addEventListener("mousemove",function(a){c.lastOffset={x:a.stageX+f-c.point.x,y:a.stageY+g-c.point.y};c.point.x=c.x=a.stageX+f;c.point.y=c.y=a.stageY+g;c.dispatchEvent(new qlib.Event("change",c))});
a.addEventListener("mouseup",function(a){c.mouseIsDown=!1;c.updateGrabber()})}),this.addEventListener("mouseover",function(a){a=a.target;a.mouseIsOver=!0;a.updateGrabber()}),this.addEventListener("mouseout",function(a){a=a.target;a.mouseIsOver=!1;a.updateGrabber()})):this.removeEventListener("mousedown")};c.updateGrabber=function(){var a=this.grabber.graphics;a.clear();a.setStrokeStyle(1,"round","round");a.beginStroke("#fff");a.beginFill(f.colorScheme[(this.selected?4:0)|(this.mouseIsDown?2:0)|(this.mouseIsOver?
1:0)]);a.drawRect(.5*-this.HANDLE_SIZE,.5*-this.HANDLE_SIZE,this.HANDLE_SIZE,this.HANDLE_SIZE);a.endFill()};c.setPosition=function(a,b){this.point.x=a;this.point.y=b;this.x=Math.round(a);this.y=Math.round(b)};c.updatePoint=function(a){this.point.x=a.x;this.point.y=a.y;this.x=Math.round(a.x);this.y=Math.round(a.y)};c.updatePositionFromPoint=function(){this.x=Math.round(this.point.x);this.y=Math.round(this.point.y)};c.setPoint=function(a){this.point=a;this.x=Math.round(a.x);this.y=Math.round(a.y)};
c.toString=function(){return"Handle"};qlib.Handle=f})();window.qlib=window.qlib||{};(function(){var f=function(){};f.GLSL=function(c){var a,b,d,f;for(d=0;3>d;d++){a=c[5*d];if(0==a)for(b=d+1;3>b;b++)if(0!=c[4*b+d]){for(f=0;4>f;f++)c[4*d+f]+=c[4*b+f];a=c[5*d];break}if(0!=a)for(f=0;4>f;f++)c[4*d+f]/=a;for(b=0;3>b;b++)if(b!=d)for(a=c[4*b+d],f=0;4>f;f++)c[4*b+f]-=a*c[4*d+f]}};qlib.MathUtils=f})();